{"data":{"site":{"siteMetadata":{"title":"Bee starter","author":"[Your Name]","siteUrl":"https://gatsby-starter-bee.netlify.com","comment":{"disqusShortName":"","utterances":"JaeYeopHan/gatsby-starter-bee"},"sponsor":{"buyMeACoffeeId":"jbee"}}},"markdownRemark":{"id":"1b43dcc6-43c6-5477-ad13-9b0b077065ff","excerpt":"TL;DR; 前端打包中会将多个module打包成一个bundle发给客户端，但是各个module中存在并不会使用到的东西，dead code elimination是一种可以消除这些代码的技术 Tree Shaking是Dead code elimination（简称DCE）的一种实现 Webpack中的tree shaking需要es6的 的支持 Webpack中的tree shaking仅仅能作用与顶层函数、顶层变量、顶层对象，如果定义一个函数集合的Object，如果仅仅只使用了一部分函数，其他的函数仍然会被打进去 什么是Tree Shaking…","html":"<h2 id=\"tldr\"><a href=\"#tldr\" aria-label=\"tldr permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TL;DR;</h2>\n<ul>\n<li>\n<p>前端打包中会将多个module打包成一个bundle发给客户端，但是各个module中存在并不会使用到的东西，dead code elimination是一种可以消除这些代码的技术</p>\n</li>\n<li>\n<p>Tree Shaking是Dead code elimination（简称DCE）的一种实现</p>\n</li>\n<li>\n<p>Webpack中的tree shaking需要es6的<code class=\"language-text\">import/export</code>的支持</p>\n</li>\n<li>\n<p>Webpack中的tree shaking仅仅能作用与顶层函数、顶层变量、顶层对象，如果定义一个函数集合的Object，如果仅仅只使用了一部分函数，其他的函数仍然会被打进去</p>\n<h2 id=\"什么是tree-shaking\"><a href=\"#%E4%BB%80%E4%B9%88%E6%98%AFtree-shaking\" aria-label=\"什么是tree shaking permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>什么是Tree Shaking</h2>\n<p>在前端开发的过程中，一般整个代码会分散在项目的各个模块中，但是在最后在发送给客户端的时候，往往是一个大的bundle文件，各个模块的文件打包成一个JS文件，但是伴随而来的问题就是，某些永远跑不到的代码也会打到最后的bundle文件中，这就无形中增加了bundle的size。\n<code class=\"language-text\">Dead code elimination（简称DCE）</code>是一种可以消除最后编译产物中无用的代码的技术，就以上出现的问题DCE技术可以移除无用的不相关的代码，以达到减小产物size的作用。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> c <span class=\"token operator\">=</span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> c<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> m <span class=\"token operator\">=</span> a <span class=\"token operator\">*</span> b<span class=\"token punctuation\">;</span>  <span class=\"token comment\">// unreachable code</span>\n    <span class=\"token keyword\">return</span> m<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> c <span class=\"token operator\">=</span> a <span class=\"token operator\">*</span> b<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  <span class=\"token comment\">// unreachable code</span>\n        <span class=\"token comment\">// do something</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>以上的代码就是一个典型的可以通过<code class=\"language-text\">DCE</code>消除掉的例子，但是在前端<code class=\"language-text\">webpack</code>中可以消除掉这些永远跑不到的代码，但是存在一个问题就是如果你<code class=\"language-text\">import</code>了一个模块，这个模块暴露出了两个函数，你在运行时只使用了其中一个，那么在最后打包的时候另外一个函数也会被打进去，代码如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// helper.js</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">'foo'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">'bar'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// main.js</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>foo<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./helpers'</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>如上在这种情况下，我们只使用了<code class=\"language-text\">foo</code>函数，没有使用<code class=\"language-text\">bar</code>函数，最后使用<code class=\"language-text\">webpack</code>打包之后，我们不需要<code class=\"language-text\">bar</code>函数的代码，因为没人去调用它，但是<code class=\"language-text\">webpack</code>如果没有配置<code class=\"language-text\">tree shaking</code>的话，<code class=\"language-text\">bar</code>还是会被打进最后的<code class=\"language-text\">bundle</code>。\n<code class=\"language-text\">tree shaking</code>就是一种<code class=\"language-text\">DCE</code>技术，发源于<code class=\"language-text\">Lisp</code>，最早在JS中是在<code class=\"language-text\">google closure</code>中使用，后来<code class=\"language-text\">rollup</code>的作者在<code class=\"language-text\">rollup</code>中引入了<code class=\"language-text\">tree shaking</code>这个技术，同时在<code class=\"language-text\">webpack4</code>中也实现了相应的功能。</p>\n<h2 id=\"tree-shaking的限制\"><a href=\"#tree-shaking%E7%9A%84%E9%99%90%E5%88%B6\" aria-label=\"tree shaking的限制 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tree Shaking的限制</h2>\n<p><code class=\"language-text\">Tree Shaking</code>的原理简单来说，就是程序的执行能够被一颗由函数调用组成的树表示，如果一个函数没有被调用到，那么这个函数就可以被消除掉；但是在<code class=\"language-text\">commonJS</code>中，<code class=\"language-text\">module</code>的加载不是静态的，这时候去做静态语法分析是比较困难的，但是<code class=\"language-text\">es6 moudle</code>的出现，使得这个问题变简单了，所以<code class=\"language-text\">tree shaking</code>的先决条件是你的<code class=\"language-text\">module</code>使用的是<code class=\"language-text\">es6</code>的<code class=\"language-text\">import/export</code>。</p>\n<h2 id=\"tree-shaking在webpack中的使用\"><a href=\"#tree-shaking%E5%9C%A8webpack%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8\" aria-label=\"tree shaking在webpack中的使用 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tree Shaking在Webpack中的使用</h2>\n<p>配置<code class=\"language-text\">webpack babel loader</code>的插件：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"> <span class=\"token punctuation\">{</span>\n         loader<span class=\"token punctuation\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\n         test<span class=\"token punctuation\">:</span> dir_js<span class=\"token punctuation\">,</span>\n         query<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n         <span class=\"token comment\">// presets: ['es2015'],</span>\n\n        <span class=\"token comment\">// All of the plugins of babel-preset-es2015,</span>\n        <span class=\"token comment\">// minus babel-plugin-transform-es2015-modules-commonjs</span>\n        plugins<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token comment\">// 'babel-plugin-transform-es2015-modules-commonjs',</span>\n          <span class=\"token string\">'transform-es2015-template-literals'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'transform-es2015-literals'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'transform-es2015-function-name'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'transform-es2015-arrow-functions'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'transform-es2015-block-scoped-functions'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'transform-es2015-classes'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'transform-es2015-object-super'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'transform-es2015-shorthand-properties'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'transform-es2015-computed-properties'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'transform-es2015-for-of'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'transform-es2015-sticky-regex'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'transform-es2015-unicode-regex'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'check-es2015-constants'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'transform-es2015-spread'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'transform-es2015-parameters'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'transform-es2015-destructuring'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'transform-es2015-block-scoping'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'transform-es2015-typeof-symbol'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">[</span><span class=\"token string\">'transform-regenerator'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">async</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> asyncGenerators<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n   \t\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span></code></pre></div>\n<p>如果要让<code class=\"language-text\">tree shaking</code>起作用，那么将es6插件中的<code class=\"language-text\">babel-plugin-transform-es2015-modules-commonjs</code>去掉，避免打成<code class=\"language-text\">commonJS</code>的包，不然<code class=\"language-text\">tree shaking</code>没用。</p>\n<p>如下我们有以下代码，我们使用<code class=\"language-text\">webpack</code>来编译它们，来看看使用<code class=\"language-text\">tree shaking</code>和不使用的区别：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">\t<span class=\"token comment\">// helper.js</span>\n\t<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'unreachable code'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token string\">'foo'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token string\">'bar'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// main.js</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>foo<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./helpers'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> elem <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'output'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">)</span>\nelem<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`Output: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>使用<code class=\"language-text\">webpack</code>编译后的部分代码：</p>\n<p><span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 549px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 46.63023679417122%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABGElEQVQoz5WR606EMBSE9/2fUH8JkUV6Ly20hVLGQzVxFbOuJBPIOc30G+YyTRMOaa2Rc8G1F1CMwxmHsu/YDwEf7/34uv9cvPcIYQYXAlYbqHaAfmUQPYdRFmlZ6sFHzKphJSRTznkd2PYK9dxgeCI1LQLt8B/Cr8gGpRSsOWOZFwQXkWie3Pgt8m+6TfBp6CGErMOgPVyvYXqDUSkyn/6kuiWvht67GvkgNMbAUyFWWFjOYBirCWJIKNuGLSWsdD6HgLyutbgT4UwU1lrsZCipnK7v0bQv6DoGJjSUkrR3WKmghX5BoIsWYxFjrBAnw4NQkNGxY0yADwNGosz5sWZPkWeSlLIaDm8cgmJGKqaUWsfdQn6W8g56B75Tn0QfeAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"tree shaking webpack0\"\n        title=\"\"\n        src=\"/static/86bd028fa895e0175a630e158eb530d6/2fbf1/tree-shaking-webpack0.png\"\n        srcset=\"/static/86bd028fa895e0175a630e158eb530d6/a2a65/tree-shaking-webpack0.png 148w,\n/static/86bd028fa895e0175a630e158eb530d6/952b1/tree-shaking-webpack0.png 295w,\n/static/86bd028fa895e0175a630e158eb530d6/2fbf1/tree-shaking-webpack0.png 549w\"\n        sizes=\"(max-width: 549px) 100vw, 549px\"\n      />\n  </span></p>\n<p>如上图是在没有启用<code class=\"language-text\">tree-shaking</code>的时候打包之后的<code class=\"language-text\">bundle</code>，这里在最后的<code class=\"language-text\">bundle</code>文件中有没有使用的<code class=\"language-text\">bar</code>函数，下图是使用了<code class=\"language-text\">tree shaking</code>之后打包后的代码：</p>\n<p><span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 380px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 28.947368421052634%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAAAzUlEQVQY042R226DMBBE+f8PbPsQpKQxGJuLU8A2BPCJIZe2Utt0pNH6Yfd4vE6UUvR9T5lp0reM992RJpeIrKbrHOMwx2pxzhFCYNW9/qREa82p/cDIivJV0KQF5U6iCoMqG6SuqU2Hdfb/wFsXQ+dpZYN6OdLmhlMEmn1KX8jHwF+wDZhl+Xbw3mOjif1nNzLagbAszDHZZNd010vDzb8Cq6q6AiNEiILDYY+NK/D+zLe5DcRTJUKI7VNWLTHRNE3M0cvymebr7p49+QLMONSKykdD3gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"tree shaking webpack1\"\n        title=\"\"\n        src=\"/static/3c16a6a29d64fc4b34e873b704d99c2b/c3aa6/tree-shaking-webpack1.png\"\n        srcset=\"/static/3c16a6a29d64fc4b34e873b704d99c2b/d926c/tree-shaking-webpack1.png 148w,\n/static/3c16a6a29d64fc4b34e873b704d99c2b/4a08d/tree-shaking-webpack1.png 295w,\n/static/3c16a6a29d64fc4b34e873b704d99c2b/c3aa6/tree-shaking-webpack1.png 380w\"\n        sizes=\"(max-width: 380px) 100vw, 380px\"\n      />\n  </span></p>\n<p>可以看到在没有<code class=\"language-text\">tree shaking</code>的情况下没有使用的<code class=\"language-text\">bar</code>函数的代码也被打进了最后的<code class=\"language-text\">bundle</code>中，使用了<code class=\"language-text\">tree shaking</code>的将没有使用到的函数消除掉了。</p>\n</li>\n</ul>\n<h2 id=\"tree-shaking真的很美好吗？\"><a href=\"#tree-shaking%E7%9C%9F%E7%9A%84%E5%BE%88%E7%BE%8E%E5%A5%BD%E5%90%97%EF%BC%9F\" aria-label=\"tree shaking真的很美好吗？ permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tree Shaking真的很美好吗？</h2>\n<p>  看到这里你可能觉得<code class=\"language-text\">tree shaking</code>真的很美好，能够帮你把一切在运行时没有使用到的代码消除掉，但是遗憾的是，在实际情况下并没有这么美好，看看下面的例子：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">\t<span class=\"token comment\">// helper.js</span>\n  <span class=\"token comment\">// top level function</span>\n  <span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  \t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      \tconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'unreachable code'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    \n  \t<span class=\"token punctuation\">}</span>\n  \t<span class=\"token keyword\">return</span> <span class=\"token string\">'foo'</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">bar</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  \t<span class=\"token keyword\">return</span> <span class=\"token string\">'bar'</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\t\n  <span class=\"token comment\">// top level object</span>\n\t<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> MyObject <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  \tfooFuncInObj<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      \t<span class=\"token keyword\">return</span> <span class=\"token string\">'foo in obj'</span><span class=\"token punctuation\">;</span>\n  \t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  \tbarFuncInObj<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      \t<span class=\"token keyword\">return</span> <span class=\"token string\">'bar in obj'</span><span class=\"token punctuation\">;</span>\n  \t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\t\n  \n\t<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> MyObject1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  \tfooFuncInObj<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      \t<span class=\"token keyword\">return</span> <span class=\"token string\">'foo in obj'</span><span class=\"token punctuation\">;</span>\n  \t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  \tbarFuncInObj<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      \t<span class=\"token keyword\">return</span> <span class=\"token string\">'bar in obj'</span><span class=\"token punctuation\">;</span>\n  \t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>    \n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\t\n  <span class=\"token comment\">// top level variable</span>\n\t<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> fooVar <span class=\"token operator\">=</span> <span class=\"token string\">\"I'm top level variable foo\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> barVar <span class=\"token operator\">=</span> <span class=\"token string\">\"I'm top level variable bar\"</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> varObj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  \tfoo<span class=\"token punctuation\">:</span> <span class=\"token string\">'variable foo in varObj'</span><span class=\"token punctuation\">,</span>\n      barVar<span class=\"token punctuation\">:</span> <span class=\"token string\">\"variable bar in varObj\"</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> foo<span class=\"token punctuation\">,</span> MyObject<span class=\"token punctuation\">,</span> fooVar<span class=\"token punctuation\">,</span> varObj <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./helpers'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> elem <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'output'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nelem<span class=\"token punctuation\">.</span>innerHTML <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`Output0: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> \\n Output1: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>MyObject<span class=\"token punctuation\">.</span><span class=\"token function\">fooFuncInObj</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> \\n Output2: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>fooVar<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\n Output1: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>varObj<span class=\"token punctuation\">.</span>foo<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>  如果<code class=\"language-text\">tree shaking</code>足够聪明，那么我们这里仅仅调用了<code class=\"language-text\">MyObject</code>下的一个函数，另外一个函数没有使用，同样的我们只使用了<code class=\"language-text\">varObj</code>下的一个变量，另外的变量不应该打到最后的<code class=\"language-text\">bundle</code>里面去，遗憾的是现实情况并不是这样，下图是<code class=\"language-text\">webpack</code>打出来的包：</p>\n<p>  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 443px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 116.70428893905192%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsSAAALEgHS3X78AAADHElEQVQ4y41Va3OrNhD1/29nOp1Jp+23Pr70fur/6LQ3uU3q6+CAsQPYIB4SEg8hwekKJ3ec1k7CzAI20mHPnj3LguUMeZSh3KSowhTpI0NR1ii5QpYLtG0Dd0zTNMdbx2KkReNg0OQEEhyQrhJkcQ4W+ui5+AKGJ8BT4HMvWIzjiF736M2Avu3Q1i3sYGG7FqbrMJ1k9z7AacTQD4jDGId9CkVZyUa/Se0S/TlDqw103SFNGe4/f8Zu+wj/4QFR9IiWS4i4QJ0UKPcMXIjXM7TWfvnhqHdNhypiqAhAFTlUHKOvOGQUQaUpLCXwLsCJFiYxCcJycM6R0eaKshm6AW2l0PEGjVBQjXpnhvRQEEDBCkSrELv7LfaBD7HbEV1qKy9AGe7Q9f388ksCHWtoDY5Xe6b64/FKa94j0MKdeFXC89Yoqwosy4g2w36/R5LsSagUh0NG9TVoswPkLkSbHqCpLG3bzomcydBCSokgCPDp0w0+Xl/j5uYaq9U9EnIRYxzGWOrLFlpwDErCEHWt9f8pn9L012ssl0uE6wDe3QqM1I53DAM1/Wuue0H5FLAoqVVqBb7JUAUp9V0FRZlraqejAOOTIONZ97ggytNMx6k3DMfCu/9GZ9+33HLOKdNEYKqmKRMToCYPS1hVHUOWMCKHrjIYxdHlB3QsQS8KqvvgpIfbfxqLyfwOWfwM7/Z7stuP8FdX8JdX8P7+Bss/v4J/9y02y+8gsp8gwyvkH7+GCH+AqH6BEr8S5geaVr9hegqqYU3IimhLRI9OlL9w+w/F3R/YbD2khz1qWVE2LUWDyVKMCiPts6Ym3mre/xyL0172Vh4B3mNLTglufeS7HPGWoe/1RZWn14aDUgq605AJqUshSnWsq7UXVf3v4F24U0eD1PnYGPNi3E+v9N2lQbtwtw3NvMSPIGhaK7LUoIfZw9PzJMJxsz1xxjnwOcNTyoEfwKfg5GO53YCvlqjJjg0JI3wP/GENSfea2OhazE3+PKleflN6+pYQ7bIs56HgprKhenb0RXRgPa/oPsPQNLOX3XBwMbra4mWG/wJ7KvNSE/YjIgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"tree shaking webpack2\"\n        title=\"\"\n        src=\"/static/f62125eb43456fc624e4d2f525a142c2/c11ce/tree-shaking-webpack2.png\"\n        srcset=\"/static/f62125eb43456fc624e4d2f525a142c2/a04dc/tree-shaking-webpack2.png 148w,\n/static/f62125eb43456fc624e4d2f525a142c2/f11b4/tree-shaking-webpack2.png 295w,\n/static/f62125eb43456fc624e4d2f525a142c2/c11ce/tree-shaking-webpack2.png 443w\"\n        sizes=\"(max-width: 443px) 100vw, 443px\"\n      />\n  </span></p>\n<p>  从上面的代码我们可以有这样的结论，<code class=\"language-text\">webpack</code>的<code class=\"language-text\">tree shaking</code>对顶层函数、顶层变量和顶层对象有作用。</p>\n<h2 id=\"reference\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h2>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Tree_shaking\">https://en.wikipedia.org/wiki/Tree_shaking</a></li>\n<li><a href=\"https://github.com/rauschma/tree-shaking-demo\">https://github.com/rauschma/tree-shaking-demo</a></li>\n<li><a href=\"http://2ality.com/2015/12/webpack-tree-shaking.html\">http://2ality.com/2015/12/webpack-tree-shaking.html</a></li>\n</ul>\n<hr>\n<p><strong><em>兴趣遍地都是，坚持和持之以恒才是稀缺的</em></strong></p>","frontmatter":{"title":"Tree Shaking","date":"December 22, 2018"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2018-12-22-TreeShaking/","previous":{"fields":{"slug":"/2018-12-15-集成Sonarqube到项目/"},"frontmatter":{"title":"集成SonarQube到你的项目中","category":"Tech"}},"next":{"fields":{"slug":"/2018-12-29-Reselect/"},"frontmatter":{"title":"如何使用Reselect做性能优化","category":"React Redux"}}}}