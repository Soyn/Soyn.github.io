{"data":{"site":{"siteMetadata":{"title":"Move fast and break things.","author":"wang yao","siteUrl":"https://gatsby-starter-bee.netlify.com","comment":{"disqusShortName":"","utterances":"Soyn/Soyn.github.io.git"},"sponsor":{"buyMeACoffeeId":"jbee"}}},"markdownRemark":{"id":"e5271095-0807-58e2-81da-eea384fdc8c8","excerpt":"在整个项目的开发过程中，开发人员在编写代码之前，往往会制定相关的代码规范，虽然写完代码之后有code review的过程，但是难免会有code review发现不了的问题，往往一些潜在的bug或者坏味道的代码会出现在项目中,\b这时候如果有一个自动\b检查代码规范的工具，\b就能有效的避免一些问题，SonarQube就是提供了这样一个能力的工具\b，\b刚好前段时间我负责集成SonarQube\u001c的服务到我们项目中，集成的时候遇\b见的一些问题，在这里做一个回顾和总结。 SonarQube是什么？ SonarQube（曾用名Sonar（声纳）…","html":"<p>在整个项目的开发过程中，开发人员在编写代码之前，往往会制定相关的代码规范，虽然写完代码之后有code review的过程，但是难免会有code review发现不了的问题，往往一些潜在的bug或者坏味道的代码会出现在项目中,\b这时候如果有一个自动\b检查代码规范的工具，\b就能有效的避免一些问题，SonarQube就是提供了这样一个能力的工具\b，\b刚好前段时间我负责集成SonarQube\u001c的服务到我们项目中，集成的时候遇\b见的一些问题，在这里做一个回顾和总结。</p>\n<h2 id=\"sonarqube是什么？\"><a href=\"#sonarqube%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F\" aria-label=\"sonarqube是什么？ permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SonarQube是什么？</h2>\n<blockquote>\n<p>SonarQube（曾用名Sonar（声纳）[1]）是一个开源的代码质量管理系统。—维基百科</p>\n</blockquote>\n<p>上面是维基百科的介绍，看SonarQube\b官网的介绍，\bSonarQube就是一个代码质量的检查工具，能够将代码中潜在的bug、坏味道的代码、代码存在的安全漏洞检查出来；SonarQube对主流编程语言\b的的\b支持还是不错的，官方称支持20+的编程语言，如果不是使用太冷门的语言都是可以使用SonarQube的；并且SonarQube\b完全可以集成进你的持续集成工具中，提供了完全自动化的分析。</p>\n<h2 id=\"sonarqube的\b\b架构\"><a href=\"#sonarqube%E7%9A%84%08%08%E6%9E%B6%E6%9E%84\" aria-label=\"sonarqube的\b\b架构 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SonarQube的\b\b架构</h2>\n<p><span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 58.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACFklEQVQoz21TTW/TQBD1b8mP41jEjQMcgBM9UaT2ioSAC9AT7YFresklUkISKUFpiNv4c9exvf6I7cSPmW1iuYGRRvbuzr6Z92bWSL1fSKw+irLEZrNBkiRw579hLm4xN224nsByuUQYhsiyDHmeU1yBoijJC32Hv1VVYTqdwnCmz+APnqAsc6RpQp4iER5SFWFuh1BJBilFk4zBwlAiitbYbrdo22QygZGsPsIcnUPFAkq5+iDbX86zFGEgdHVc2W63ezjPJMJIUPJMx1XbCnVdYzAYwFitXKoi14E72mSr9xf/Z0zb8wWEbUM4NsaTMRzLQRbn6PV6MDqdDq6ufkAEAWzTRGxZ+uLNTRenp2/x/uwdnr94iU9fL/X+hvTyPA+OI0lfiX6/T/+O1lQDPj05wc/ra8RxjA3Rqklctm63izMCu7g4x6s3r/Hh8xcqvdbU2DzPhOM6iKNY6856DodDGAykpESapE0X+auUokYVDdWqyEnnSJ+xduu1RQ3KOEeTZDwew3isT0SZb4lWCd/3IQRpJX1IkoPFl7QuabwOAFrvVtWz2ewBkJvQDmLjCiOic38/pyR/tEarlYW7uymNkU3A1T+Aeg7bm23nYWV6i8WCgMNmeINAUuW+nstjwNFo9Jhy21hLpRJ8+36pA5lqoycBHw91A1junxwDHJzXURRRNYF+dq7r6uHmbh7Oj50Z8Aj9BVIQiZkAzWL8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"SonarQube Architecture\"\n        title=\"\"\n        src=\"/static/cc7b0bfec7e88e244c829fd464e36ed8/e41c6/architecture-integrate.png\"\n        srcset=\"/static/cc7b0bfec7e88e244c829fd464e36ed8/7c8aa/architecture-integrate.png 148w,\n/static/cc7b0bfec7e88e244c829fd464e36ed8/1e920/architecture-integrate.png 295w,\n/static/cc7b0bfec7e88e244c829fd464e36ed8/e41c6/architecture-integrate.png 590w,\n/static/cc7b0bfec7e88e244c829fd464e36ed8/8067e/architecture-integrate.png 885w,\n/static/cc7b0bfec7e88e244c829fd464e36ed8/c6bc3/architecture-integrate.png 900w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n如上是SonarQube各个部分的组件，其实如果要搭建一个完整的SonarQube服务，从整体上来看分成两个\b大的部分，一个\b部分是Sonar Scanner，一个是SonarQube Server；\bSonarQube Scanner负责从SonarQube拉取\b规则，扫墓工程目录下的代码\b，将扫描结果回写给SonarQube Server，Scanner和Server不一定在同一台机器上。如上SonarQube Server在运行时主要由三个\b主要的进程组成：</p>\n<ul>\n<li>Web Server是负责代码质量的报告在UI上的展现，以及在用户界面上对SonarQube实例的配置</li>\n<li>Search Server是依赖于Elasticsearch，提供搜索的能力</li>\n<li>Compute Engine负责处理代码分析的报告，以及将相关数据存入数据库的操作</li>\n</ul>\n<p>SonarQube Server上的数据库存储了\bSonarQube的配置信息（插件、安全设置等信息），以及每一次分析报告的快照；从这里可以看出，SonarQube Server其实就是一个\b配置管理、结果分析查询的服务，SonarQube本身并不参与到项目代码的扫描分析中，扫描分析这一部分的工作是Sonar Scanner负责的，一般是集成到项目中的持续集成工具中的。</p>\n<h2 id=\"安装sonarqube-server\"><a href=\"#%E5%AE%89%E8%A3%85sonarqube-server\" aria-label=\"安装sonarqube server permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>安装SonarQube Server</h2>\n<p>安装SonarQube Server到\bUbuntu，按照<a href=\"https://www.vultr.com/docs/how-to-install-sonarqube-on-ubuntu-16-04\">How to Install SonarQube on Ubuntu 16.04</a>这个链接的步骤，即可安装成功，这里要注意的是，\b以上链接提供的方式存在一个问题就是，\b如果你安装的SonarQube版本是6.7+(推荐装6.7 LTS的版本)，\b\b并且你以root权限启动服务，在6.7的<a href=\"https://docs.sonarqube.org/display/SONARQUBE67/Release+6.6+Upgrade+Notes\">更新</a>中，出于安全的考虑，\b\b不能以root权限启动，这里切成其他非root权限启动即可，但是在切换用户之后，需要将temp目录下的\broot文件清除掉。</p>\n<h2 id=\"集成sonarqube到项目\b中\"><a href=\"#%E9%9B%86%E6%88%90sonarqube%E5%88%B0%E9%A1%B9%E7%9B%AE%08%E4%B8%AD\" aria-label=\"集成sonarqube到项目\b中 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>集成SonarQube到项目\b中</h2>\n<p>在搭建好\bSonarQube Server之后，\b我们\b需要将其集成到我们的工程目录中，\b\b如下图是在整个项目中，SonarQube是怎样工作的：\n<span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 58.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACFklEQVQoz21TTW/TQBD1b8mP41jEjQMcgBM9UaT2ioSAC9AT7YFresklUkISKUFpiNv4c9exvf6I7cSPmW1iuYGRRvbuzr6Z92bWSL1fSKw+irLEZrNBkiRw579hLm4xN224nsByuUQYhsiyDHmeU1yBoijJC32Hv1VVYTqdwnCmz+APnqAsc6RpQp4iER5SFWFuh1BJBilFk4zBwlAiitbYbrdo22QygZGsPsIcnUPFAkq5+iDbX86zFGEgdHVc2W63ezjPJMJIUPJMx1XbCnVdYzAYwFitXKoi14E72mSr9xf/Z0zb8wWEbUM4NsaTMRzLQRbn6PV6MDqdDq6ufkAEAWzTRGxZ+uLNTRenp2/x/uwdnr94iU9fL/X+hvTyPA+OI0lfiX6/T/+O1lQDPj05wc/ra8RxjA3Rqklctm63izMCu7g4x6s3r/Hh8xcqvdbU2DzPhOM6iKNY6856DodDGAykpESapE0X+auUokYVDdWqyEnnSJ+xduu1RQ3KOEeTZDwew3isT0SZb4lWCd/3IQRpJX1IkoPFl7QuabwOAFrvVtWz2ewBkJvQDmLjCiOic38/pyR/tEarlYW7uymNkU3A1T+Aeg7bm23nYWV6i8WCgMNmeINAUuW+nstjwNFo9Jhy21hLpRJ8+36pA5lqoycBHw91A1junxwDHJzXURRRNYF+dq7r6uHmbh7Oj50Z8Aj9BVIQiZkAzWL8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Integrate SonarQube\"\n        title=\"\"\n        src=\"/static/cc7b0bfec7e88e244c829fd464e36ed8/e41c6/architecture-integrate.png\"\n        srcset=\"/static/cc7b0bfec7e88e244c829fd464e36ed8/7c8aa/architecture-integrate.png 148w,\n/static/cc7b0bfec7e88e244c829fd464e36ed8/1e920/architecture-integrate.png 295w,\n/static/cc7b0bfec7e88e244c829fd464e36ed8/e41c6/architecture-integrate.png 590w,\n/static/cc7b0bfec7e88e244c829fd464e36ed8/8067e/architecture-integrate.png 885w,\n/static/cc7b0bfec7e88e244c829fd464e36ed8/c6bc3/architecture-integrate.png 900w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span></p>\n<ul>\n<li>在客户端装上Sonarlint，\bSonarlint会在你写代码的时候，应用Sonarlint的规则\b，检查你当前打开文件</li>\n<li>在你将代码push到SCM上之后，你需要在你的持续集成工具\b上安装Sonar Scanner，然后在项目根目录下运行Scanner</li>\n<li>\bScanner分析\b完代码之后，\b将分析结果写会到\bSonarQube Server（在项目根目录下需要放置Sonar的配置文件），如下：</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">    # must be unique in a given SonarQube instance\n    sonar.projectKey=\b#SonarQube项目的key\n    # this is the name and version displayed in the SonarQube UI. Was mandatory prior to SonarQube 6.1.\n    sonar.projectName=#\bSonarQube项目名\n    # sonar.projectVersion=1.0\n    sonar.host.url=#SonarQube\b搭建的地址\n    # Path is relative to the sonar-project.properties file. Replace &quot;\\&quot; by &quot;/&quot; on Windows.\n    # This property is optional if sonar.modules is set. \n    sonar.sources=#需要分析的代码目录\n    sonar.login=#\b\b在Sonarqube中生成sha5码，让Sonar Scanner有访问权限\n    \n    # Encoding of the source code. Default is default system encoding\n    sonar.sourceEncoding=UTF-8 # 编码格式</code></pre></div>\n<p>如上在项目根目录下新建一个名为<code class=\"language-text\">sonar-project.properties</code>的文件，按照以上的配置即可。</p>\n<h2 id=\"集成\bsonarqube到bitbucket\"><a href=\"#%E9%9B%86%E6%88%90%08sonarqube%E5%88%B0bitbucket\" aria-label=\"集成\bsonarqube到bitbucket permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>集成\bSonarQube到Bitbucket</h2>\n<p>在以上的集成中，存在一个问题就是\b每次SonarQube分析完\b之后，开发人员需要\b自己去SonarQube网站上去查看分析结果，\b\b但是如果这次的代码的提交并没有导致问题\b，那么这次\b查看明显是\b浪费时间，如果每次对于新提交的代码，仅仅在出了问题之后才通知开发，这样能够减少开发人员频繁的去查看SonarQube报告。</p>\n<p>我们组里\b使用的是Bitbucket Cloud做源码的托管，\b这里有一个<a href=\"https://github.com/mibexsoftware/sonar-bitbucket-plugin\">插件</a>，在你发pull request后，SonarQube分析完结果，如果扫描出问题，会将\b有问题的代码及原因以comments的形式写到\b对应的comments上去，非常方便，如果使用Bitbucket\b的话可以使用这个插件。</p>\n<hr>\n<p><strong><em>兴趣遍地都是，坚持和持之以恒才是稀缺的</em></strong></p>","frontmatter":{"title":"集成SonarQube到你的项目中","date":"December 15, 2018"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2018-12-15-集成Sonarqube到项目/","previous":{"fields":{"slug":"/2018-1-05-MyYearOf2018/"},"frontmatter":{"title":"My Year Of 2018","category":"Life"}},"next":{"fields":{"slug":"/2018-12-22-TreeShaking/"},"frontmatter":{"title":"Tree Shaking","category":"Tech"}}}}