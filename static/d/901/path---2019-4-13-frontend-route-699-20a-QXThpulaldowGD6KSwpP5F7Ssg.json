{"data":{"site":{"siteMetadata":{"title":"Bee starter","author":"[Your Name]","siteUrl":"https://gatsby-starter-bee.netlify.com","comment":{"disqusShortName":"","utterances":"JaeYeopHan/gatsby-starter-bee"},"sponsor":{"buyMeACoffeeId":"jbee"}}},"markdownRemark":{"id":"12379993-7124-5a3b-a617-9814c1aa437d","excerpt":"什么是路由？ 路由最一开始是在后端中出现的，我们在访问某些网站的时候经常会见到类似于这样的 :\n  或者  ，这就是 （Server Side Render…","html":"<h2 id=\"什么是路由？\"><a href=\"#%E4%BB%80%E4%B9%88%E6%98%AF%E8%B7%AF%E7%94%B1%EF%BC%9F\" aria-label=\"什么是路由？ permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>什么是路由？</h2>\n<p>路由最一开始是在后端中出现的，我们在访问某些网站的时候经常会见到类似于这样的<code class=\"language-text\">url</code>:\n<code class=\"language-text\">http://www.xxx.com/xxx.php</code> 或者 <code class=\"language-text\">http://www.xxx.com/xxx.html</code>，这就是<code class=\"language-text\">SSR</code>（Server Side Render）服务端渲染，通过后端直接渲染前端页面。这里客户端会发向服务端发请求，服务端解析<code class=\"language-text\">url</code>，根据<code class=\"language-text\">url</code>将需要的资源返回给前端，路由其实就是前端和服务端的一种交互方式，相当于服务端针对于<code class=\"language-text\">不同url</code>的<code class=\"language-text\">switch case</code>，每一类<code class=\"language-text\">case</code>对应一个<code class=\"language-text\">controller</code>。</p>\n<h2 id=\"前端路由\"><a href=\"#%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1\" aria-label=\"前端路由 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前端路由</h2>\n<p>上面介绍了传统意义上的路由，用户在页面上点击的时候触发页面请求，服务端将对应的页面返回回来，这样存在一个问题是，整个页面会重新加载，会产生无意义的白屏页面，用户体验不好。在用户点击访问网站或者<code class=\"language-text\">Web App</code>上的另一个页面的时候，这个时候我们可能仅仅需要的是更新部分视图就可以了，而没有必要去重新加载整个页面，避免无意义的白屏；这个时候前端路由就出现了，页面的跳转和渲染放在前端，后端提供<code class=\"language-text\">API</code>获取数据即可。</p>\n<h2 id=\"前端路由的实现原理\"><a href=\"#%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86\" aria-label=\"前端路由的实现原理 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前端路由的实现原理</h2>\n<p>对于前端路由有两种实现方式，一种是通过<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window/hashchange_event\"><code class=\"language-text\">hashchanged</code></a>；另一种是使用<code class=\"language-text\">HTML5</code>提供的<code class=\"language-text\">history api</code>来做前端路由的处理。\n对于<code class=\"language-text\">hasnchange</code>的实现方式，我们需要监听<code class=\"language-text\">hashchange</code>事件，在浏览器的<code class=\"language-text\">url</code>中改变<code class=\"language-text\">hash</code>不会导致页面发请求，我们在<code class=\"language-text\">hashchange</code>的事件回调中处理页面中<code class=\"language-text\">DOM</code>的刷新。\n<img src=\"http://Soyn.github.io/img/19-4-13-03.jpg\" alt=\"hashchange\">\n在<code class=\"language-text\">html5</code>推出<code class=\"language-text\">pushstate</code>和<code class=\"language-text\">replacestate</code>之后，就可以通过这两个<code class=\"language-text\">api</code>来改变<code class=\"language-text\">url</code>并且不发请求，而且相比于使用<code class=\"language-text\">hash</code>，页面的<code class=\"language-text\">url</code>更加美观，但是通过<code class=\"language-text\">pushstate</code>方式改变了<code class=\"language-text\">url</code>，如果这个时候刷新了页面，服务端会收到请求，这个时候后端没有对应的<code class=\"language-text\">controller</code>来处理，所以在<code class=\"language-text\">pushstate</code>的实现方式下，后端最好对于没有路由的<code class=\"language-text\">url</code>直接返回到主页面。</p>\n<h2 id=\"如何实现一个简单的前端路由\"><a href=\"#%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1\" aria-label=\"如何实现一个简单的前端路由 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>如何实现一个简单的前端路由</h2>\n<p>这里我们来尝试实现一个简单的前端路由，主要的思想就是侦测<code class=\"language-text\">url</code>的变化，解析<code class=\"language-text\">url</code>，调用<code class=\"language-text\">handler</code>，整个路由是一个单例。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> Route <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    routes<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    config<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>root <span class=\"token operator\">=</span> options<span class=\"token punctuation\">.</span>root <span class=\"token operator\">||</span> <span class=\"token string\">'/'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">.</span>mode <span class=\"token operator\">===</span> <span class=\"token string\">'history'</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token keyword\">typeof</span> history<span class=\"token punctuation\">.</span>pushState <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mode <span class=\"token operator\">=</span> <span class=\"token string\">'history'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mode <span class=\"token operator\">=</span> <span class=\"token string\">'hash'</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>基于浏览器的两种实现方式，我们实现路由的时候，提供<code class=\"language-text\">mode</code>的设置，默认是’hash’的实现，这里我们配置了根路径，这里主要是处理在<code class=\"language-text\">pushstate</code>的实现中，<code class=\"language-text\">pushstate</code>导致无法获取到<code class=\"language-text\">url</code>改变的部分的问题：\n<img src=\"http://Soyn.github.io/img/19-4-13-01.png\">\n<img src=\"http://Soyn.github.io/img/19-4-13-02.png\">\n如上图，我们原本的页面在<code class=\"language-text\">https://github.com</code>下，在第一次<code class=\"language-text\">pushstate</code>的时候，没有问题，但是在第二次<code class=\"language-text\">pushstate</code>的时候，和我们期待的<code class=\"language-text\">url</code>并不符合，这会导致的问题是，我们在解析<code class=\"language-text\">url change</code>的部分的时候，会得到错误的结果，所以这里我们指定好根目录，在解析的时候将<code class=\"language-text\">url</code>中根路径剔除掉。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  getFragement<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> fragement <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mode <span class=\"token operator\">===</span> <span class=\"token string\">'history'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      fragement <span class=\"token operator\">=</span> location<span class=\"token punctuation\">.</span>pathname <span class=\"token operator\">+</span> location<span class=\"token punctuation\">.</span>search<span class=\"token punctuation\">;</span>\n      fragement <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">clearSlash</span><span class=\"token punctuation\">(</span>fragement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      fragement <span class=\"token operator\">=</span> fragement<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/\\?(.*)$/'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// replace the query string</span>\n      fragement <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>root <span class=\"token operator\">!==</span> <span class=\"token string\">'/'</span> <span class=\"token operator\">?</span> fragement<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>root<span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> fragement<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      fragement <span class=\"token operator\">=</span> location<span class=\"token punctuation\">.</span>hash<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> fragement<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>上面的代码就是去解析出’url’改变的部分；在<code class=\"language-text\">pushstate</code>的实现中，存在一个问题是，我们在<code class=\"language-text\">url</code>跳转的时候，是调用<code class=\"language-text\">pushstate</code>来改变<code class=\"language-text\">url</code>，但是这并不能触发<code class=\"language-text\">popstate</code>的事件，所以这里我们需要去<code class=\"language-text\">listen url</code>的变化：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  startTimer<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> self <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">internalFn</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      self<span class=\"token punctuation\">.</span>timer <span class=\"token operator\">=</span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>internalFn<span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timer <span class=\"token operator\">=</span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>internalFn<span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  listen<span class=\"token punctuation\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> current <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getFragement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> self <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fn</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>current <span class=\"token operator\">!==</span> self<span class=\"token punctuation\">.</span><span class=\"token function\">getFragement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        current <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span><span class=\"token function\">getFragement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        self<span class=\"token punctuation\">.</span><span class=\"token function\">check</span><span class=\"token punctuation\">(</span>current<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">startTimer</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>完整的代码实现请查看： <a href=\"https://github.com/Soyn/FERoute\">FERoute</a></p>\n<h2 id=\"refrence\"><a href=\"#refrence\" aria-label=\"refrence permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Refrence</h2>\n<ul>\n<li><a href=\"https://www.zhihu.com/question/53064386\">https://www.zhihu.com/question/53064386</a></li>\n<li><a href=\"https://juejin.im/post/5b40c1ede51d4518f140f84b\">https://juejin.im/post/5b40c1ede51d4518f140f84b</a></li>\n<li><a href=\"https://www.zhihu.com/question/63586494\">前端管理路由相比后端有什么优势？ - 知乎</a></li>\n<li><a href=\"http://krasimirtsonev.com/blog/article/deep-dive-into-client-side-routing-navigo-pushstate-hash\">http://krasimirtsonev.com/blog/article/deep-dive-into-client-side-routing-navigo-pushstate-hash</a></li>\n<li><a href=\"https://github.com/SME-FE/sme-router\">GitHub - SME-FE/sme-router: A lightweight router lib that implement with express route style</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/History_API\">https://developer.mozilla.org/en-US/docs/Web/API/History_API</a></li>\n<li><a href=\"https://github.com/krasimir/navigo\">GitHub - krasimir/navigo: A simple vanilla JavaScript router with a fallback for older browsers</a>\n<a href=\"https://medium.com/@wilbo/server-side-vs-client-side-routing-71d710e9227f\">Server-side vs Client-side Routing – Wilbert Schepenaar – Medium</a></li>\n</ul>\n<hr>\n<p><strong><em>兴趣遍地都是，坚持和持之以恒才是稀缺的</em></strong></p>","frontmatter":{"title":"前端路由","date":"April 13, 2019"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2019-4-13-frontend-route/","previous":{"fields":{"slug":"/2019-3-23-StateManager/"},"frontmatter":{"title":"实现一个前端状态管理库","category":"Frontend Javascript ES6"}},"next":{"fields":{"slug":"/2019-4-20-Promise/"},"frontmatter":{"title":"Promise初探","category":"Frontend"}}}}