{"componentChunkName":"component---src-templates-blog-post-js","path":"/2019-3-2-AsyncAndDeferInScript/","result":{"data":{"site":{"siteMetadata":{"title":"Move fast and break things.","author":"wang yao","siteUrl":"http://cuteshilina.com","comment":{"disqusShortName":"","utterances":"Soyn/Soyn.github.io.git"},"sponsor":{"buyMeACoffeeId":"jbee"}}},"markdownRemark":{"id":"da6132bd-19cc-5089-941f-7ad92691b02e","excerpt":"在访问网页的时候，浏览器是如何渲染当前的页面的？浏览器获取到输入（、、）的时候，输入中有的信息，有样式信息，代码，在加载页面的时候，如果的加载和解析太耗时的话，首屏的大量留白是很影响用户体验的，这里我们来看看，对于在页面中的加载对的加载的性能影响。 Script…","html":"<p>在访问网页的时候，浏览器是如何渲染当前的页面的？浏览器获取到输入（<code class=\"language-text\">HTML</code>、<code class=\"language-text\">CSS</code>、<code class=\"language-text\">Javascript</code>）的时候，输入中有<code class=\"language-text\">DOM Tree</code>的信息，有样式信息，<code class=\"language-text\">Javascript</code>代码，在加载页面的时候，如果<code class=\"language-text\">DOM</code>的加载和解析太耗时的话，首屏的大量留白是很影响用户体验的，这里我们来看看，对于<code class=\"language-text\">Scritp</code>在页面中的加载对<code class=\"language-text\">HTML</code>的加载的性能影响。</p>\n<h2 id=\"script在页面中的位置\" style=\"position:relative;\"><a href=\"#script%E5%9C%A8%E9%A1%B5%E9%9D%A2%E4%B8%AD%E7%9A%84%E4%BD%8D%E7%BD%AE\" aria-label=\"script在页面中的位置 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Script在页面中的位置</h2>\n<p><code class=\"language-text\">script</code>标签在页面中放置的位置对于整个页面的加载和功能影响是很大，默认情况下，浏览器在解析<code class=\"language-text\">HTMl</code>页面的时候，遇到<code class=\"language-text\">script</code>标签，如果是<code class=\"language-text\">inline</code>的话，会立即执行<code class=\"language-text\">script</code>标签中的代码，这里就牵扯一个问题，浏览器对<code class=\"language-text\">HTML</code>的解析是按照<code class=\"language-text\">HTML</code>内容的输入顺序执行的，如果<code class=\"language-text\">script</code>在<code class=\"language-text\">head</code>中，如果需要操作<code class=\"language-text\">DOM</code>，这个时候浏览器对文档的解析并没有结束，可能这时候需要的<code class=\"language-text\">DOM</code>并不存在。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./style.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>link</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n      <span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Dom Length: '</span><span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByClassName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test3<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test4<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test5<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>如上，是一个<code class=\"language-text\">inline</code>的<code class=\"language-text\">script</code>，在<code class=\"language-text\">script</code>的代码中去取<code class=\"language-text\">DOM</code>，这个时候浏览器在执行这段代码的时候，浏览器并没有解析到对应的<code class=\"language-text\">DOM</code>。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.78378378378378%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAiElEQVQoz62P3QrDIAyF8/4P6UUjE8qsWFcQ/Dkzll2sIoNtBz7UkJMTaVkYWmus6x0hPBqhY61tdYZzrr9zzkgpIcYIZu6Iz3sPYwxuDaUUaN+bedtwHLEZKoCKWuU8JfcZolJKDxcklHDR2XcxDz1Sew9+icbU+TafNhZoNuBbhi//qr8PfAJr4ifu/q3keAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"inline in head\"\n        title=\"inline in head\"\n        src=\"/static/902439bf615502def2479177dc6495fa/fcda8/inline_in_head.png\"\n        srcset=\"/static/902439bf615502def2479177dc6495fa/12f09/inline_in_head.png 148w,\n/static/902439bf615502def2479177dc6495fa/e4a3f/inline_in_head.png 295w,\n/static/902439bf615502def2479177dc6495fa/fcda8/inline_in_head.png 590w,\n/static/902439bf615502def2479177dc6495fa/242e2/inline_in_head.png 703w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>所以，为了避免这种情况，一般来说，会将script标签放置在<code class=\"language-text\">&lt;/body&gt;</code>标签前，这个时候，所有的<code class=\"language-text\">DOM</code>都解析好了，不存在找不到<code class=\"language-text\">DOM</code>的情况。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./style.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>link</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test3<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test4<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test5<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n      <span class=\"token keyword\">function</span> <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Dom Length: '</span><span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByClassName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token function\">foo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>    \n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.108108108108105%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAd0lEQVQoz7WPzQrEIAyEff/nlNoeBC0UTfyZmhy6S2EPa+nAYET5JmPcumFZHPb9QM4MZgIRjzmrmRmlFNRa1XJPKamJCDFGWGvhvUcIAaa1hjI+9o4pSYgEyykB5vPUB/R/f0vAZgbyC6xA3W2y7tXtDnyqV4EnqGoqZePXZHIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"inline in body\"\n        title=\"inline in body\"\n        src=\"/static/3174ed35b9647e0cf017de6ae37d1855/fcda8/inline_in_body.png\"\n        srcset=\"/static/3174ed35b9647e0cf017de6ae37d1855/12f09/inline_in_body.png 148w,\n/static/3174ed35b9647e0cf017de6ae37d1855/e4a3f/inline_in_body.png 295w,\n/static/3174ed35b9647e0cf017de6ae37d1855/fcda8/inline_in_body.png 590w,\n/static/3174ed35b9647e0cf017de6ae37d1855/d67ca/inline_in_body.png 714w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h2 id=\"外部script的加载对html解析的影响\" style=\"position:relative;\"><a href=\"#%E5%A4%96%E9%83%A8script%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%AF%B9html%E8%A7%A3%E6%9E%90%E7%9A%84%E5%BD%B1%E5%93%8D\" aria-label=\"外部script的加载对html解析的影响 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>外部Script的加载对HTML解析的影响</h2>\n<p>在加载外部的<code class=\"language-text\">script</code>的时候，<code class=\"language-text\">script</code>的加载对于页面的性能影响更加明显，加载外部脚本的时候牵扯发外部的请求去请求脚本，这个时候<code class=\"language-text\">HTML</code>的解析是被阻塞住的，外部<code class=\"language-text\">script</code>加载成功后，马上执行<code class=\"language-text\">script</code>脚本，执行完后，才继续解析剩下的<code class=\"language-text\">HTML</code>。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./style.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>link</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test3<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test4<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test5<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./app.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.16216216216216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABkElEQVQozyWQ2Y7aQBBF+f8fyWM+IcpIhISEJRAFBMx4w7RtsNtt7G4vmJOaycPV7apq1XImS89n7QdswpBNFIlCtnHESnLrIGTlBfwOAuavHj9OnsT+R20pWgURy7f/8eLN+/g7SdKUXFdckoKLuhJFBaFfoMuK6t6QFTW6sqKGxjqRxYmaQuOMwcq7bTtxJ94y6bqOzPQc/Yw/B5/9PmY/naH8iFSVnDOL0h2pyHUDz3HApTFtLQ3vpeQaXC9NB8fw6JmEcqatK1zrcEXO45YwuhrbNHQyceh7ehnav/sDepWhTcH3/YHinnKtruhGUzrNITky+Ttf8/XLgst8jkmu1O0TNyIb1fgXQZDmqNygQkW8nRJ9+8Sv6U9mLzu8U8rRk4vCk6AYuZU1E+Wd8Xc+VsA64eTuFvvOS6XUso0Vb9Ir7mYw2xf08jPHxYZkF2PiHC35vMg464TKCkOlFKXOqUzJUJWM9Z3ef6XbLulOe/rdlm4x46FvPF1Lb3thNTA+HwydQ7jgSsMljzC14R8CfAqYIPt1zAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"extend script in body\"\n        title=\"extend script in body\"\n        src=\"/static/e7fcce1b32423cec4032540a3a637c6e/fcda8/extend_script_in_body.png\"\n        srcset=\"/static/e7fcce1b32423cec4032540a3a637c6e/12f09/extend_script_in_body.png 148w,\n/static/e7fcce1b32423cec4032540a3a637c6e/e4a3f/extend_script_in_body.png 295w,\n/static/e7fcce1b32423cec4032540a3a637c6e/fcda8/extend_script_in_body.png 590w,\n/static/e7fcce1b32423cec4032540a3a637c6e/efc66/extend_script_in_body.png 885w,\n/static/e7fcce1b32423cec4032540a3a637c6e/5a3c9/extend_script_in_body.png 1169w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n从上图的<code class=\"language-text\">profile</code>的图我们可以发现，浏览器在解析<code class=\"language-text\">HTML</code>的时候，默认在解析到<code class=\"language-text\">script</code>标签的时候，会加载对应的<code class=\"language-text\">Javascript</code>代码，加载完成后立即执行，这个过程会将<code class=\"language-text\">HTML</code>解析阻塞住，那有没有办法解决页面阻塞的问题呢？在<code class=\"language-text\">HTML5</code>中引入了<code class=\"language-text\">async</code>和<code class=\"language-text\">defer</code>这两个属性，可以解决<code class=\"language-text\">script</code>加载阻塞页面解析的问题。</p>\n<h2 id=\"script中的async和defer属性\" style=\"position:relative;\"><a href=\"#script%E4%B8%AD%E7%9A%84async%E5%92%8Cdefer%E5%B1%9E%E6%80%A7\" aria-label=\"script中的async和defer属性 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Script中的Async和Defer属性</h2>\n<p>首先我们看看<code class=\"language-text\">MDN</code>对这两个属性的解释：\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZklEQVQoz3VSi3KDIBDM/39i+khTY4hPBEFRjNs9q07bpDezs8AwC7d7h3meIRVjRF3XqAhhbSy076Fdj+n+fee/2jSED9tmGAYURYHPskHb9YjjiFHA82HFvg5h52madrFfgsJlVSFJU+QUdt4vaJ2D77qFZb+tN44/BKV2QZ4gP76gOp9hKOpvGZy6LbBKwd1u8Fm2oMvyheUsFCVm2vXQ8ny/wx2PsKcP2PcT2pXt6QT9+oY+uSBSPF7VjjG9YiTPbP9BUKrRGmVZombrFSGsGZBp6Ku1v2CNgWPL8pG95b+CIpKxFfFQ/JSQsjyHaVuEYUQXhgWBPwoMRCDBPQ1FStGrMz1MLxek9PGSJLjSp89UQeUFzuREZVA8kztyv+VjD2OzaWq2Jj+ra42irJZ5jHFcRmiaIqa4gslKutvIPE1Z2HmOQj+gDSMaH+iRh6FXlp41fEzWDWE48LYLMITr10BWjS8YygWI3CNfOwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"extend async mdn\"\n        title=\"extend async mdn\"\n        src=\"/static/ae9786c7e3b6e7befa12744ad2927e85/fcda8/extend_async_mdn.png\"\n        srcset=\"/static/ae9786c7e3b6e7befa12744ad2927e85/12f09/extend_async_mdn.png 148w,\n/static/ae9786c7e3b6e7befa12744ad2927e85/e4a3f/extend_async_mdn.png 295w,\n/static/ae9786c7e3b6e7befa12744ad2927e85/fcda8/extend_async_mdn.png 590w,\n/static/ae9786c7e3b6e7befa12744ad2927e85/efc66/extend_async_mdn.png 885w,\n/static/ae9786c7e3b6e7befa12744ad2927e85/82b28/extend_async_mdn.png 931w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n如上，是<code class=\"language-text\">async</code>属性对<code class=\"language-text\">script</code>标签的加载和执行的影响：</p>\n<ul>\n<li><code class=\"language-text\">async</code>为<code class=\"language-text\">true</code>的<code class=\"language-text\">script</code>是异步加载和执行的，加载过程不会阻塞浏览器对<code class=\"language-text\">HTML</code>的解析</li>\n<li>有多个<code class=\"language-text\">async</code>为<code class=\"language-text\">true</code>的<code class=\"language-text\">script</code>的执行的顺序是不确定的，执行顺序并不是脚本的引用顺序</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./style.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>link</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test3<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test4<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test5<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">async</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>true</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./app.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><img src=\"./images/async_chrome_profile.png\">\n从上面的<code class=\"language-text\">profile</code>的图可以很明显的看到这个过程，<code class=\"language-text\">Javascript</code>的加载和<code class=\"language-text\">HTML</code>的解析是并行的，并不会阻塞<code class=\"language-text\">HTML</code>的<code class=\"language-text\">parse</code>，但是<code class=\"language-text\">javascript</code>代码的执行的实际这里是无法确定的。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./style.css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>link</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test3<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test4<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>test<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Test5<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">async</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>true</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">async</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>true</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./app.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>如上，我们在这里从<code class=\"language-text\">cdn</code>上引入了<code class=\"language-text\">JQuery</code>的代码，我们来看看这里<code class=\"language-text\">async=true</code>的时候，对<code class=\"language-text\">javascript</code>代码的执行情况的影响。\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.189189189189186%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABkklEQVQozzWS647TMBCF8/4PwNuw4hdCrARdIbQgtrt0m6SJYydNfE2a9mOcCktH53jGc5WLrus4Ht/RWmP6XnSJUh3a9HSdZpgsy7rirMNoQ98P1CdFWbf0w0TTGo7lCWOMxCkK5PiQiCFwuyZSmLjMHm4Ll8WzLkH0zJLcdoeVNWkWe4RZsYaaxTX8P0WMiTlFusMvdHtAq3fa+pWxr5iDJlpFdEq0IblOtCF0O1z1gK0+4cqPBLPjIslmmaRo9Jn69S9v358JZcO8QBRvEg4CP98Is3C64uL1zgmsYIrydoWxbCmfHnGyhiIbTKV4/vqD6ttn1M8datCCCWVGlBQcRi9Jb1uyzFY4Y5TgJE30T194efiA+7OnuD+Cqpkwsvi89GG/p5dqw2AxgvMUtmQbpO2QIfZwrAmHisl63trfm6+IeTRJWJ/XrXoeNyThfiLmIOliGz0ny11Kt16PgjPeL/jrfS29O8tKLhRVfeLUKA5SLX8V6/xWcfJRdLhrQbbbjQPWC8Ldb2WqbJ/ke2X9D7DbYroncthJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"async jquery\"\n        title=\"async jquery\"\n        src=\"/static/47d3dace03f49cb0ff06c0d44049160e/fcda8/async_jquery.png\"\n        srcset=\"/static/47d3dace03f49cb0ff06c0d44049160e/12f09/async_jquery.png 148w,\n/static/47d3dace03f49cb0ff06c0d44049160e/e4a3f/async_jquery.png 295w,\n/static/47d3dace03f49cb0ff06c0d44049160e/fcda8/async_jquery.png 590w,\n/static/47d3dace03f49cb0ff06c0d44049160e/efc66/async_jquery.png 885w,\n/static/47d3dace03f49cb0ff06c0d44049160e/561da/async_jquery.png 969w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n在上面的<code class=\"language-text\">profile</code>的图中，我们可以很明显的看到，<code class=\"language-text\">javascript</code>代码的执行顺序，和<code class=\"language-text\">script</code>的引入顺序并不一致。\n我们接着来看看<code class=\"language-text\">defer</code>属性对<code class=\"language-text\">script</code>标签的影响：\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABN0lEQVQoz5VS2ZKCMBD0//9s9xdcFAGBcCUQEJGjdzoayy2eNlVdPTmmq2cmh23bwFXXNaIoQtu2aJoGxhgXa60dc89YCxsPObfWunhZFqdz8II8UEohz3MoQmK/L4oCWZY5XK4ZklwhSnNkRYVpmjCOI9Z1/Ss4z7NzRhfkqqreTmvhtuueDl8wgr7vnXvifr/vBTUFKVaWTrCmqLSCTgdJXqWKx+OBWUBmVXTG3J3DSZzEX98w5xA6CGBOZwcdnGAvEUwYopV9J/eEDS+OjdzfohgYbtg+BddhgD3+oEsSWHnQCcg2TrCK0yfqD36hrLAUJTYR3JVcSqmlJLBEDkDJMHzM4fizNE2RSnwV5j37zEWttyB7wm/DRDa9kt655r++i/86ngkOrZNh0cxOkExRv//v8nm/aySyYpGuNxYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"extend defer mdn\"\n        title=\"extend defer mdn\"\n        src=\"/static/3ee27e2f2c6c824529cea2ec64ce517b/fcda8/extend_defer_mdn.png\"\n        srcset=\"/static/3ee27e2f2c6c824529cea2ec64ce517b/12f09/extend_defer_mdn.png 148w,\n/static/3ee27e2f2c6c824529cea2ec64ce517b/e4a3f/extend_defer_mdn.png 295w,\n/static/3ee27e2f2c6c824529cea2ec64ce517b/fcda8/extend_defer_mdn.png 590w,\n/static/3ee27e2f2c6c824529cea2ec64ce517b/27b8e/extend_defer_mdn.png 836w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n根据<code class=\"language-text\">MDN</code>的解释，在<code class=\"language-text\">defer</code>属性为<code class=\"language-text\">true</code>的情况下，<code class=\"language-text\">script</code>标签会异步加载，脚本的执行是按照<code class=\"language-text\">script</code>标签在<code class=\"language-text\">HTML</code>中出现顺序执行，等所有的<code class=\"language-text\">script</code>执行完毕之后才会触发<code class=\"language-text\">DOMContentLoaded</code>事件。\n<img src=\"./images/defer_chrome_profile.png\">\n对于<code class=\"language-text\">script</code>的加载和执行，结合文中实际的例子，我们总结一下：</p>\n<ul>\n<li><code class=\"language-text\">script</code>标签默认是同步加载，加载完成之后立即执行</li>\n<li><code class=\"language-text\">async</code>为<code class=\"language-text\">true</code>的时候，<code class=\"language-text\">script</code>的加载是异步的（不会阻塞<code class=\"language-text\">HTML</code>的解析过程），代码的执行顺序不一定是<code class=\"language-text\">script</code>标签出现的顺序。</li>\n<li><code class=\"language-text\">defer</code>的加载和<code class=\"language-text\">async</code>是异步的不会阻塞<code class=\"language-text\">HTML</code>的<code class=\"language-text\">parse</code>，和<code class=\"language-text\">async</code>区别在于，<code class=\"language-text\">defer</code>标签的执行是按照在文档中定义的顺序执行的，在代码执行完毕之后才触发<code class=\"language-text\">DOMContentLoaded</code>，<code class=\"language-text\">async</code>的代码的执行并不对<code class=\"language-text\">DOMContentLoaded</code>有影响（代码的执行可能在<code class=\"language-text\">DOMContentLoaded</code>事件之后，意味着如果在<code class=\"language-text\">async</code>为<code class=\"language-text\">true</code>的脚本中拿不到<code class=\"language-text\">DOMContentLoaded</code>的事件)]</li>\n</ul>\n<h1 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h1>\n<ul>\n<li><a href=\"https://flaviocopes.com/javascript-async-defer/\">Efficiently load JavaScript with defer and async</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script\">The Script element</a></li>\n</ul>\n<hr>\n<p><strong><em>兴趣遍地都是，坚持和持之以恒才是稀缺的</em></strong></p>","frontmatter":{"title":"script在HTML中的加载","date":"March 02, 2019"}}},"pageContext":{"slug":"/2019-3-2-AsyncAndDeferInScript/","previous":{"fields":{"slug":"/2019-2-23-WriteYourOwnAmdLoader/"},"frontmatter":{"title":"自己动手写AMD Loader","category":"Tech"}},"next":{"fields":{"slug":"/2019-3-16-ESModule/"},"frontmatter":{"title":"ES6 Module","category":"Tech"}}}},"staticQueryHashes":["3128451518","96099027"]}