<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Move fast and break things.]]></title><description><![CDATA[Blog posted about ...]]></description><link>http://cuteshilina.com</link><generator>GatsbyJS</generator><lastBuildDate>Sun, 24 Jan 2021 05:10:11 GMT</lastBuildDate><item><title><![CDATA[2019年终总结]]></title><description><![CDATA[Overview 现在是 20 年 3 月，这篇 19 年的年终总结来的有点晚了，19 年这一年,每天还是过着按部就班的生活，工作和生活上并没有让我觉得有惊喜的地方，从离开学校到现在也快 3 年了，在我 21 岁上大三的时候，我曾经写过一篇 在 21 岁的时候写给 2…]]></description><link>http://cuteshilina.com/Life/2019年终总结/</link><guid isPermaLink="false">http://cuteshilina.com/Life/2019年终总结/</guid><pubDate>Sat, 28 Mar 2020 16:04:17 GMT</pubDate><content:encoded>&lt;h1 id=&quot;overview&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#overview&quot; aria-label=&quot;overview permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Overview&lt;/h1&gt;
&lt;p&gt;现在是 20 年 3 月，这篇 19 年的年终总结来的有点晚了，19 年这一年,每天还是过着按部就班的生活，工作和生活上并没有让我觉得有惊喜的地方，从离开学校到现在也快 3 年了，在我 21 岁上大三的时候，我曾经写过一篇 &lt;a href=&quot;https://yaotechs.com/2016-11-26-%E5%86%99%E7%BB%9925%E5%B2%81%E7%9A%84%E8%87%AA%E5%B7%B1/&quot;&gt;在 21 岁的时候写给 25 岁的自己&lt;/a&gt;，在今年 25 岁这个时间节点，去看看几年前的我的自己的期许，是一件很有意思的事。&lt;/p&gt;
&lt;h1 id=&quot;life&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#life&quot; aria-label=&quot;life permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Life&lt;/h1&gt;
&lt;blockquote&gt;
&lt;h2 id=&quot;消费主义&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%B6%88%E8%B4%B9%E4%B8%BB%E4%B9%89&quot; aria-label=&quot;消费主义 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;消费主义&lt;/h2&gt;
&lt;/blockquote&gt;
&lt;p&gt;去年一年在生活上，多了对消费主义的思考，特别是在看了 BBC 纪录片&lt;a href=&quot;https://www.bilibili.com/bangumi/media/md20526/?spm_id_from=666.25.b_6d656469615f6d6f64756c65.2&quot;&gt;无节制消费的元凶&lt;/a&gt;之后，更是反思了自己的消费习惯，生活中玲琅满目的广告，社交网络上各种种草、心水，确实让人很容易陷入消费主义的陷阱，现在网络支付、网络贷款的便利性，让很大不一部分养成了提前消费的习惯，比如，最新款的 iphone，分 24 期，0 利率，每个月仅需 229，每天付出不到 8 块钱，就能获得个人认为最好用的智能手机
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 70.27027027027026%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACeElEQVQ4y22UTUhUURTHXQuCRZoDjjlhsxNHF+7buGwRtHGTQSBEgZsWbcLCPiDJGVwMhBAkSQZO24I2YYrugpyPTJB04pnzPmbm3ffefZ//7r3P95pJL5x33uUcfve88z/3dXieB0mSYFkWzlpBEAhzHAfNRgOmacIwiPBB4MO2bRGL8jr4g6/DwypWV9+jUPiAtUIBKyvvsL6+EYOJYeDHzz0cVn8L+3VQRVM3mBG4nh8f3uG6rtjkcotIpS5jJJNBOn0FE9emMD0zh0ZdE3HL9tA0LDSJiXqTwHZ9YdTxYdo+osJi4EI2h0uDKYyPj2N4ZBg3J2fw4M4jKKoSAqmDP7KGo2OFeTWEMSOmDYO6pyvMMuCFnh6Mjo1hKD2EZ/deIj/3FrJSE3Gep6oqarIMRVFF33gfdV0X72cAs+juPodMZhTJwQHMTs5i7fkylLpyAvRYNZYQgVIqYDbzrcK1f/JCFl1dXRhIJnG+rxefpx5j/+ESJFUOgazxbvBP+cj7vt+2j4Ev5ufR2dmJ/v5+9DLg7et38Wb+NVRNiZXe3NzA9tYWyuUSdna+o1gsinHjo3cKmM/nBTCRSKCv7yKuTtzAren7MIgeAyu7e9jd20eDKW1aNmuDA4e1oA0YlUsIYSeXUSqVhK+UK6iy2YwW/zTC1KybDjTdYlAKYlGmPj0byBtNT5ocrej2hCkBlrdlPP10hFdfa1j8cownHyV8O2iykCdy2oBcNU3ThIq8DZSy+WK3I1QwrJCPi04MGCaNjeedqjCC8nmStQakY5V5HUGboj6OaiqDWGHvnNCiAmLg/z+BeN8Ci+L8dvDx4RW1Gq8+yvkLA7XprLXaJfMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;iphone11&quot;
        title=&quot;iphone11&quot;
        src=&quot;/static/360237120d36c3716ac43820a4cda1f6/fcda8/iphone11.png&quot;
        srcset=&quot;/static/360237120d36c3716ac43820a4cda1f6/12f09/iphone11.png 148w,
/static/360237120d36c3716ac43820a4cda1f6/e4a3f/iphone11.png 295w,
/static/360237120d36c3716ac43820a4cda1f6/fcda8/iphone11.png 590w,
/static/360237120d36c3716ac43820a4cda1f6/efc66/iphone11.png 885w,
/static/360237120d36c3716ac43820a4cda1f6/c83ae/iphone11.png 1180w,
/static/360237120d36c3716ac43820a4cda1f6/df56e/iphone11.png 1188w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
但是大部分人还是高估了自己对消费的控制能力，贷款加杠杆消费，一旦你适应了这一套，两年的时间，你的账户上欠款可不止这一部 iphone 的钱。&lt;/p&gt;
&lt;p&gt;以前我的消费习惯是，比如这个耳机 2000 块，刚好淘宝在做活动，现在只要 1500，还能免息 12 期，每个月只要 100 多块钱，相当于白给，光速下单，等到每个月还款的时候，发现自己一大堆各种奇怪的消费账单，很大一部分东西，买来之后用了几次之后就不用了，但是账单却一直还在，而且这种账单越积越多，提前消费的感觉不得不说确实很爽，用很小的一部分钱就能提前享受到自己一直想要的东西，商家会给你各种各样的 slogan，&lt;code class=&quot;language-text&quot;&gt;你必须要拥有XXX，你就是XXX&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;某某同款&lt;/code&gt;等等。&lt;/p&gt;
&lt;p&gt;难道真的是这样吗？精致的消费主义下，给我带来的更多的是困惑和不安，你用这 1w 块钱的 iphone，你身边的人用着 2000 块钱的小米，到底谁是真的高富帅，谁是真的屌丝。真正有价值的东西，并不是你用什么手机，穿什么衣服，但是裹挟着精致主义、优越感的消费主义，包围着我们所有人。如何找到自己内心真正认同的价值，而不是被外界左右，这才是正确的消费观念，你不需要任何人来告诉你你应该买什么、吃什么、用什么。回头来看，19 年最大的收获，就是重新认识了消费主义，不再让消费主义裹挟着自己，以下是我自己的一些消费习惯：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;坚持储蓄，&lt;code class=&quot;language-text&quot;&gt;钱是赚来的，不是攒来的&lt;/code&gt;这句话相信很多人都听过，也觉得很有道理，其实这句话，对于没有背景，没有资源的人来说，这是最大的骗局。如果你真打算做点事情，启动的资金大部分是自己攒下来的，无论什么时候，攒钱做储蓄，做 plan B，是不会错的选择&lt;/li&gt;
&lt;li&gt;如果你买一件消费品，让你犹豫不觉的时候，你压根不需要，或者你压根就不是它的目标受众&lt;/li&gt;
&lt;li&gt;买东西之前，想想自己已经有的可以替代的，想想在买之后，旧的是不是可以扔掉，如果答案是 NO，就没有必要&lt;/li&gt;
&lt;li&gt;提前消费，除开房车需要贷款外，购买其他的消费品并不需要贷款，现在支付不了，就继续攒钱&lt;/li&gt;
&lt;li&gt;投资、教育、医疗、生产力提升，培养朋友、亲人、恋人之间长期的稳定的关系，才是真正值得投入金钱的地方&lt;/li&gt;
&lt;li&gt;结合自己的实际情况，给自己的各类消费，定一个限制，比如，购买大件电子产品，总价不超过自己资产的 10%&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;h2 id=&quot;定期复盘&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%9A%E6%9C%9F%E5%A4%8D%E7%9B%98&quot; aria-label=&quot;定期复盘 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;定期复盘&lt;/h2&gt;
&lt;/blockquote&gt;
&lt;p&gt;19 年开始做的一件事就是每一个季度，会对上个季度做复盘，总结在上个季度完成哪些事，哪些做得好的地方，哪些做的不好，在下个季度要做哪些事，将全年的长期目标拆解成小的目标，一步一步的去完成。复盘和总结最大的好处就是不断的鞭策自己，让自己不偏离大的目标，同时以旁观者的角度去看问题，才能看的更清楚。&lt;/p&gt;
&lt;h1 id=&quot;旅行&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%97%85%E8%A1%8C&quot; aria-label=&quot;旅行 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;旅行&lt;/h1&gt;
&lt;p&gt;今年和项目组的同事一起去了趟泰国普吉岛团建，人生第一次出国，没想到第一次看见海是在国外，更要命的时候，自己一个从来没有出过国的人，要带着十几个人一起出国，前期的资料的查找、机票、住宿的预定，前前后后，自己也忙了大半个月，所幸，最后并没有出现什么预料之外的情况，这一次搞完这些东西，下一次有机会再出国，基本上就轻车熟路了。&lt;/p&gt;
&lt;p&gt;在去泰国之前，我自己本身对于旅行这件事上并没有太大的兴趣，单纯是觉得旅行跑来跑去，旅行就是从一个景点到另一个景点，没啥收获，但是这次普吉之旅，让我体验到了旅行本身并不在于你看了啥景点，吃了什么东西，最大的意义是和你一起同行的人和旅途中快乐的记忆。现在我的这份工作，给我带来的不仅仅是物质上的回报，更大的收获是身边的人给我带来的影响。&lt;/p&gt;
&lt;h1 id=&quot;阅读&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%98%85%E8%AF%BB&quot; aria-label=&quot;阅读 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;阅读&lt;/h1&gt;
&lt;p&gt;19 年读了十本书左右，其中有一些个人觉得还不错的书，值得拿来说一说。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://book.douban.com/subject/6880158/&quot;&gt;陆犯焉识&lt;/a&gt;，这本书是用公司发的购物卡买的，也是以前看过严歌苓写的《小姨多鹤》，想看看她的其他作品，不得不说，作者对于人物的刻画，情感描述，细腻入微，忘了是从哪里看到的一句话，&lt;code class=&quot;language-text&quot;&gt;时代的一粒尘埃，落在个人头上，就是一座山&lt;/code&gt;，个人认为用这句话来形容这本书，再合适不过了。网络上一部分人说严歌苓就爱搞这种伤痕文学，我持保留意见，因为我们都无法去穿越回那个时代，无法去体会时代的沉重感，如果有这样的作品，来描述那个时代的故事，让人铭记，这就是好的作品，如果一部分人就是要用小众来标榜自己的优越感，那么，键盘在你手上，你随便打字，我并不关心你说了什么。&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://book.douban.com/subject/27608239/&quot;&gt;原则&lt;/a&gt;，这本书是以前听&lt;code class=&quot;language-text&quot;&gt;得意忘形&lt;/code&gt;的时候，博主张潇雨推荐的，这本书的作者是&lt;code class=&quot;language-text&quot;&gt;Ray Dalio&lt;/code&gt;，华尔街大佬，桥水基金创始人，有兴趣的可以了解一下。这本书对个人最大的冲击是，在个人做事、做人的方式建立一套完备、严密的，并且在逻辑上是自洽的系统是多么重要；另外就是，如何保持真诚开放的心态，建立自己一套原则，不断的去在生活中自我验证和改进这一套原则。这本书，现在已经成为畅销书了，网络上一部分人，对畅销书保佑嗤之以鼻的态度，觉得畅销书就是 evil 的，如果一本书写出来，满足了大部分的阅读需求，所有人都能读懂，并且从中学到东西，我是该说是作者写作水平高，能够将复杂的东西，分解剖析，用简单易懂的方式传授给他人，还是作者写的内容本身就是极其浅显易懂，空洞的东西，这种东西，最好判断的就是，看他做的事，站的位置，不要看他说的话，立的 flag，比如，《乖，摸摸头》这种鸡汤文，恰饭不可耻，但你还是得要拿出一个专业的实际的东西给人看，等现在夸你的人，觉得你对的人，长大了，就该骂你了。&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://book.douban.com/subject/26360716/&quot;&gt;The Effective Engineer&lt;/a&gt;，这本书的作者，在硅谷的各大科技公司都做过，写过代码，做过 leader，创过业，从一个科技从业者的视角，去给你介绍，如何变得更有效率。读完之后，很多东西还是老生长谈的问题，但是有一些观点还是很有意思的，比如在评估要做的事的时候，提出了一个计算的公式==&gt; （任务的影响力／花费的时间），这个公式得出来的比值越大，就是当下越值得去做的事，但是这对于底层写程序的执行者，大部分时候，你并没有太大的自由度去决定自己要做的事，作者所在的一些公司都是 Google、FB 一类的顶级公司，就算是底层员工在项目上的话语权还是很大的，国内的情况，还是业务驱动的为多。最主要是作者本身就是 MIT 毕业，进的公司，身边的人都是 top 级别的，出现蠢人的概率极低，但是这本书中的内容，对于程序员个人成长，技能培养，或者是创业组建团队还是有一定帮助的。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;其他的书读书一些个人读完印象不深刻，价值不大的书，没有必要单独拿出来复习了，希望能一直保持持续阅读的习惯，去看见不同的观点，不同的故事，用别人走过的路，见过的东西，转化成自己的远见，来看见未见的东西，希望今年能读更多的好书。&lt;/p&gt;
&lt;h1 id=&quot;工作&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%B7%A5%E4%BD%9C&quot; aria-label=&quot;工作 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;工作&lt;/h1&gt;
&lt;p&gt;现在的工作基本上都是前端的那一票东西，技术栈就是&lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;redux&lt;/code&gt;那一套，从工作到现在，一直在做&lt;code class=&quot;language-text&quot;&gt;BI&lt;/code&gt;的项目，前端这一块的东西，抛开&lt;code class=&quot;language-text&quot;&gt;node.js&lt;/code&gt;，基本上被限制在了浏览器这个沙箱里，真正和计算机底层打交道的机会不多，前端离用户更近，做需求的时候，更多的是从用户用例来考虑，以前在技术研究上存在误区，爱研究那些在自己工作上用不到的东西，想着开眼界，现在看来，研究的技术没有落地的场景，其实就是空中楼阁，写 Demo，读源码，其实自己想要的是能够对当前的工作产生一定影响。&lt;/p&gt;
&lt;p&gt;惭愧的是，一直在做&lt;code class=&quot;language-text&quot;&gt;BI&lt;/code&gt;的项目，其实自己 对于&lt;code class=&quot;language-text&quot;&gt;BI&lt;/code&gt;这一块的领域知识，并没有专门去学习和了解，包括对产品的思考、竞品的研究，只想着写 code，做需求，缺少自己对做的事情的思考，只关心了&lt;code class=&quot;language-text&quot;&gt;How&lt;/code&gt;没有去想一想&lt;code class=&quot;language-text&quot;&gt;Why&lt;/code&gt;，这些东西也是在和领导绩效谈话的时候，领导也指出来的问题。&lt;/p&gt;
&lt;p&gt;工作效率上，领导曾经也在绩效谈话上说过，提升工作效率的问题，自己也留意和改进工作效率上的问题，说实话，评估工作量，本身就是一个概率问题，前期准备的越充分，评估的越准确，100%的正确评估，我很难做到；就目前的工作状态来说，阻碍工作效率的原因，一是提升自己工作的专注力；二是自己的关注点，放大一点，不要集中在自己的一亩三分地。&lt;/p&gt;
&lt;p&gt;如果从大学毕业 22 岁算起，算 60 岁退休，中间有快 40 年的工作时间，职业规划和成长是一个大的话题，工作上确实有不顺心的地方，但是把时间拉长来看，短期内的东西，对整个职业生涯来说，影响微乎其微，在工作中，保证自己的专业能力，不犯业余错误，能得到他人的充分信任和肯定，这是我工作上的长期目标和努力的方向。&lt;/p&gt;
&lt;h1 id=&quot;技术&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%8A%80%E6%9C%AF&quot; aria-label=&quot;技术 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;技术&lt;/h1&gt;
&lt;p&gt;19 年在技术上，还是围绕着前端在学习，说实话，这一年对自己在技术上的成长，是很不满意的。&lt;/p&gt;
&lt;p&gt;因为项目在用&lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt;的关系，业余时间研究了&lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt;的源码，&lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt;的源码太多，面面俱到的看完肯定是不现实的，主要精力放在，一些重点的内容上，看了&lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt;新的基于&lt;code class=&quot;language-text&quot;&gt;fiber&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;diff&lt;/code&gt;算法，顺道看了以下，&lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt;组件刷新的时候，内部的处理过程，看源码还是一个不断坚持的过程，看一遍是没法彻底弄明白的，得反复看，调试，积累到一定程度，突然就通了，看别人写的代码，也是一个学习的过程，主要是学习别人解决问题的方法，但是&lt;strong&gt;&lt;em&gt;读源码不是银弹&lt;/em&gt;&lt;/strong&gt;，自己结合自己的实际情况，自己的工作内容，兴趣点去学习，才是最正确的方式，读源码，更多的是为了解决自己的困惑和问题，基础不足去补基础，领域知识不足，去学习领域知识，比一味的去读源码，头疼医脚，会带来更大的收益。&lt;/p&gt;
&lt;p&gt;另外就是去年偶然发现了&lt;a href=&quot;&quot;&gt;danger.js&lt;/a&gt;这个项目，原因也是项目组内部在做&lt;code class=&quot;language-text&quot;&gt;code review&lt;/code&gt;上的一些痛点，在将&lt;code class=&quot;language-text&quot;&gt;danger&lt;/code&gt;引入到项目中，确实达到了预期的效果，也算是在去年平平淡淡的工作内容上的一些亮点；自己那段时间对这个项目很着迷，看了内部的一些实现，帮助改进了一些问题。参与开源项目其实有时候并没有想象的那么困难，并不是只有大神才能参与，只要有兴趣，修复错误拼写，改进文档，这些看上去不起眼的改动，也是在回馈社区，确实你给开源项目写&lt;code class=&quot;language-text&quot;&gt;code&lt;/code&gt;本身并不会给你带来回报，但是参与开源，本身就是一种回报。&lt;/p&gt;
&lt;p&gt;在技术上，以前觉得影响力越大的、越底层的越厉害，但是现在自己有了对技术的认识，技术是为了解决问题，是为了做出好用的工具和产品服务的，不能把眼光局限在这个语言厉害、那个框架不行的这种东西上；像&lt;code class=&quot;language-text&quot;&gt;Linus&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;fabrice bellard&lt;/code&gt;这种神人，我辈只能仰望，这种现象级别的大牛，并不能作为普遍案例来讲；希望自己在技术上，能少讲些空洞的主义，多研究些实际的问题，即使我下辈子在技术上也没办法达到像&lt;code class=&quot;language-text&quot;&gt;Linus&lt;/code&gt;的高度（也没必要），但是我相信自己能保持这一份态度和见识，我肯定能在行业内做到前面。&lt;/p&gt;
&lt;h1 id=&quot;summary&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#summary&quot; aria-label=&quot;summary permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Summary&lt;/h1&gt;
&lt;p&gt;去年一年，对我自身来说，并没有太大的变化，不论是工作还是生活上，其实心里还是有点气馁的，认为自己能够做得更好，得到更多的认同，特别是回头看看几年前写的文章，我并没有如预期一样，在北上广深的出租屋的深夜中打开我自己写的文章，也没有频繁的跳槽，也没有成为一个能为他人答疑解惑的 mentor，但是我在工作中从最初的不成熟到现在慢慢的成为了一个专业成熟的人。&lt;/p&gt;
&lt;p&gt;感情生活依然还是一个人，身边并没有一个理解和支持你的另一半，身边的同龄人很多都已经迈入婚姻的殿堂，说实话，有时候确实挺羡慕的，遇事有另一个人和你商量和承担，开心快乐的时候有另一个人和你分享，伤心的时候有人安慰；我只是慢一些，运气没那么好而已。&lt;/p&gt;
&lt;p&gt;写下这篇文章的时候，陪伴我整个学生生涯的 NBA 球星科比，永远的离开了这个世界，在我最迷茫无助的时候，我看到了科比坚毅的性格，永远不服输、用实际行动让轻视你的人闭嘴。科比带来给我的影响成为了我性格里的一部分，也支撑我走到现在，我心中那个从不向命运低头的男人，从来也没离开，&lt;code class=&quot;language-text&quot;&gt;Mamba Out，Mamba Never Out&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 19.594594594594593%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA3ElEQVQY0z1Pa2+DMAzs//9fnYDQMgINMFYeamERiEcRfKA8bnHQZul08Tn22adhGNC2LZqmQatQVRVIo7zrun+tKApIKSF/JIbXC33fo65rhQplWWIcR1CcsjRFnufwOIfNGM7nDzjOFUEQ4GJfEAgB0zCQJolm3/NhmQY491TdBrMYmGlhmqZjIHc/9efkfodzdZBlGW6+hzAMtYnruhA3gefjgVzV4vgLURRpQ6HMiuexOV2jB1ITNXzHMVK1LZ2xLMuB9xvzPGNdV51v26Z533esikmn959O8QukAyY289t+WwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;summary&quot;
        title=&quot;summary&quot;
        src=&quot;/static/b8bcae12d17d4855d21f3e680685935c/fcda8/summary.png&quot;
        srcset=&quot;/static/b8bcae12d17d4855d21f3e680685935c/12f09/summary.png 148w,
/static/b8bcae12d17d4855d21f3e680685935c/e4a3f/summary.png 295w,
/static/b8bcae12d17d4855d21f3e680685935c/fcda8/summary.png 590w,
/static/b8bcae12d17d4855d21f3e680685935c/68e9c/summary.png 654w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;上面是我 16 年在我 21 岁的时候对 25 岁的我写的话，从未来看过去，感谢 21 岁的自己，感谢身边的人对我的帮助，未来我会做的更好，人生就是不断的 move on。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;兴趣遍地都是，坚持和持之以恒才是稀缺的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[使用Passive event保证平滑滚动]]></title><description><![CDATA[Problem 我们先来看一个Demo, 在 Demo…]]></description><link>http://cuteshilina.com/平滑滚动/</link><guid isPermaLink="false">http://cuteshilina.com/平滑滚动/</guid><pubDate>Sat, 21 Mar 2020 14:03:29 GMT</pubDate><content:encoded>&lt;h1 id=&quot;problem&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#problem&quot; aria-label=&quot;problem permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Problem&lt;/h1&gt;
&lt;p&gt;我们先来看一个&lt;a href=&quot;https://codepen.io/alnord/pen/bGdjywK&quot;&gt;Demo&lt;/a&gt;, 在 Demo 中，在&lt;code class=&quot;language-text&quot;&gt;touchStart&lt;/code&gt;的事件的&lt;code class=&quot;language-text&quot;&gt;callback&lt;/code&gt;中跑了一段&lt;code class=&quot;language-text&quot;&gt;JS&lt;/code&gt;的循环，打开&lt;code class=&quot;language-text&quot;&gt;Chrome&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;devtools&lt;/code&gt;，切换到移动端的模式，在页面上滑动的时候，可以明显感觉到左边盒子的滚动有明显的延迟和卡顿，而右边的盒子滚动起来却很顺滑；这两个盒子的&lt;code class=&quot;language-text&quot;&gt;touchStart&lt;/code&gt;事件的&lt;code class=&quot;language-text&quot;&gt;callback&lt;/code&gt;跑的循环是一样的，差异在于右边盒子将&lt;code class=&quot;language-text&quot;&gt;passive&lt;/code&gt;置为了&lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;。&lt;/p&gt;
&lt;h1 id=&quot;overview&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#overview&quot; aria-label=&quot;overview permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Overview&lt;/h1&gt;
&lt;p&gt;页面的平滑滚动对于用户体验来说是很重要的，特别是移动端，如果开发人员在&lt;code class=&quot;language-text&quot;&gt;touchstart&lt;/code&gt;或者&lt;code class=&quot;language-text&quot;&gt;touchmove&lt;/code&gt;中执行了涉及&lt;code class=&quot;language-text&quot;&gt;JS&lt;/code&gt;的代码，会影响页面的滚动，原因在于页面的滚动在浏览器中是由另一个线程负责的，在页面滚动的过程中，如果触发了&lt;code class=&quot;language-text&quot;&gt;JS&lt;/code&gt;的执行，这个线程会等待主线程执行完&lt;code class=&quot;language-text&quot;&gt;JS&lt;/code&gt;再触发滚动（因为在事件回调中可能执行&lt;code class=&quot;language-text&quot;&gt;preventDefault&lt;/code&gt;，会将滚动行为停止掉），所以，类似于上面&lt;code class=&quot;language-text&quot;&gt;demo&lt;/code&gt;的代码，左边盒子的&lt;code class=&quot;language-text&quot;&gt;touchstart&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;callback&lt;/code&gt;执行了耗时的&lt;code class=&quot;language-text&quot;&gt;JS&lt;/code&gt;计算，页面的滚动在等待&lt;code class=&quot;language-text&quot;&gt;JS&lt;/code&gt;的执行完成，用户体验上就会感到卡顿。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; test &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;test&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; test1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;test1&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
test&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addEventListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;touchstart&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10000000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; j &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; j &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; j &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

test1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addEventListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&apos;touchstart&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token parameter&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; sum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10000000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; j &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; j &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; j &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; passive&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1 id=&quot;solution&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#solution&quot; aria-label=&quot;solution permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Solution&lt;/h1&gt;
&lt;p&gt;在 DOM 的事件绑定中，我们使用&lt;code class=&quot;language-text&quot;&gt;addEventListenr&lt;/code&gt;这个函数签名的第二个参数是一个&lt;code class=&quot;language-text&quot;&gt;obj&lt;/code&gt;，我们常用到的就是&lt;code class=&quot;language-text&quot;&gt;{capture: true}&lt;/code&gt;，用于在事件的捕获阶段（从文档的顶层到触发的 dom）绑定事件处理函数，这里还存在一个参数&lt;code class=&quot;language-text&quot;&gt;{passive: true}&lt;/code&gt;，将这个参数置为&lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;之后，相当于通知浏览器，我这个回调函数不会执行&lt;code class=&quot;language-text&quot;&gt;preventDefault&lt;/code&gt;，对于上面我们&lt;code class=&quot;language-text&quot;&gt;demo&lt;/code&gt;中看到的滚动卡顿的问题来说，就相当于告诉控制滚动的线程，你继续滚动，我不会打断正常的滚动，所以就产生了&lt;code class=&quot;language-text&quot;&gt;demo&lt;/code&gt;中的差异。&lt;/p&gt;
&lt;h1 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/WICG/EventListenerOptions/blob/gh-pages/explainer.md&quot;&gt;Passive event listeners&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;兴趣遍地都是，坚持和持之以恒才是稀缺的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[about]]></title><description><![CDATA[Wang Yao   Software enginner in Xi’an. Now focus on frontend with React. If you want to contact me, Please send me an email: w60440848…]]></description><link>http://cuteshilina.com/resume-en/</link><guid isPermaLink="false">http://cuteshilina.com/resume-en/</guid><pubDate>Sun, 28 Jul 2019 16:21:13 GMT</pubDate><content:encoded>&lt;h1 id=&quot;wang-yao&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#wang-yao&quot; aria-label=&quot;wang yao permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Wang Yao&lt;/h1&gt;
&lt;p&gt;  Software enginner in Xi’an. Now focus on frontend with React.&lt;/p&gt;
&lt;div align=&quot;center&quot;&gt;
&lt;p&gt;&lt;em&gt;If you want to contact me, Please send me an email: w604408482@gmail.com.&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;</content:encoded></item><item><title><![CDATA[双向绑定]]></title><description><![CDATA[…]]></description><link>http://cuteshilina.com/2019-6-15-mvvm/</link><guid isPermaLink="false">http://cuteshilina.com/2019-6-15-mvvm/</guid><pubDate>Sat, 15 Jun 2019 17:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在前端的学习中，经常会听到双向绑定（&lt;code class=&quot;language-text&quot;&gt;MVVM&lt;/code&gt;）这个概念，双向绑定的概念很简单，就是视图（&lt;code class=&quot;language-text&quot;&gt;View&lt;/code&gt;）上的更新能够实时更新数据层（&lt;code class=&quot;language-text&quot;&gt;Model&lt;/code&gt;），同时数据层的更新也会实时更新到视图层。不同于&lt;code class=&quot;language-text&quot;&gt;MVC&lt;/code&gt;的数据单向流动（从数据层到视图层），那么如何实现数据和视图的双向绑定呢？
实现数据的双向绑定，首先我们要搞明白面临的问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如何监听试图层的变化？&lt;/li&gt;
&lt;li&gt;视图层变化之后如何更新到数据层？&lt;/li&gt;
&lt;li&gt;如何监听数据层的变化？&lt;/li&gt;
&lt;li&gt;如何将数据层的变化更新到视图层？&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;视图层的更新主要是来自用户的输入行为（输入、点击等），我们可以通过监听事件的方式（&lt;code class=&quot;language-text&quot;&gt;keyup&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;keydown&lt;/code&gt;等），在事件回调中获取视图层的更新，将更新同步到数据层上，由于数据层的更新，我们再用数据去刷视图层，这样就是实现了双向绑定，从网上获取的资料来看，主要有以下几种实现方式：&lt;/p&gt;
&lt;h1 id=&quot;手动绑定&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%89%8B%E5%8A%A8%E7%BB%91%E5%AE%9A&quot; aria-label=&quot;手动绑定 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;手动绑定&lt;/h1&gt;
&lt;p&gt;这里手动绑定的意思是，在&lt;code class=&quot;language-text&quot;&gt;DOM&lt;/code&gt;上绑定事件回调，在事件回调函数值中去更新数据层和重新渲染视图，简单的实现如下：
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 110.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC/UlEQVQ4y51US08UQRDeM+4uK7s7szM90/Psee0DiK/EH6AmEiPGk170YvSGBwPxwkkSE19IFBCIC1EIgRW9YAIe9AI/67N6FvCBC6yHLz09XfV1VX1VnVnd/I7W9g7Wt3bQktjuHp+2d7HxbRermz+QWdrYwuPxCYyMjuHBozHcHxntDg/b68jYOJqtr8hMLbVwMUlQFb3I20Xks7T2Fk6OQgGnsjkoFR2T8x+ReTX3AaJah667BANlnaGs6SipKspqhaCSsdYRqrRVVJi2g6dT88g8m25CRBFCn6KM+yHq5+D4dVimB2a7qDg+lD2n9gWHUSyXwbiFJy9n2oSOCGDbHgYHzsMwOFRVR0UzoFK0ioyanI4kLBGhKQmn24SuCOkWBXHYD9cJ0TBtcNNBH90sifbJOpGmhHyf8G0TXhCh0FdE4DYQ+f1ILB+hVwcz7GOjO0y4F6GqaQhEDZ4bw3MEDJ0fOJyI8PeUHT+AzgxUqwOIwhrCWh1GmJDS2rHpdqxhhZR0XAFuuShTTym6Sat28hr+TajQQTUZRBhU4XOHRHHBDQ8W96GR0l1FKEU5TaJEHqXsNXDGk21E/VdhUCnarlOWhH3FEqlcQyIGEBMSJ4Zwk/9L2ZM1NEwwikzRaPTIUSVDWYbSEep27EM3CGFRq3hBg8SgFIm8SDMsDUvU3LLp0+90r/zCXsTy/M8+JEJpwCnsSNQhamfhezFMUl3zIxjcg0N7XcTpfBs0phU3gMbN9PGQ5Tqkcl+5BCuI4VLdXE6ieBEY9SITCTg586gBk85NmntGnaASgcpYihIJx7j9i9APYxhCQDQuwKRXxrI8aA6BlNZllPTi6DSGjJmoUJ/KS3QqEbPpn0t28kKySwmfzyzSxkWBcRSoTbK5HLL5PHI5QrrmDr6z+d72uvcvtSP09PSkT9jE5CwybxbXcOvuPVweGsalq9fbGOqAf54N48q1G7h5+w4mF5aRaa5vYm7lC14vrODF7BJkxN1A+kzOL+Pd8me8X9vET08l2TgpomAPAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;HandSetHtml&quot;
        title=&quot;HandSetHtml&quot;
        src=&quot;/static/84e65ec1e909cf16f05d4d970f70098a/fcda8/handSetHTML.png&quot;
        srcset=&quot;/static/84e65ec1e909cf16f05d4d970f70098a/12f09/handSetHTML.png 148w,
/static/84e65ec1e909cf16f05d4d970f70098a/e4a3f/handSetHTML.png 295w,
/static/84e65ec1e909cf16f05d4d970f70098a/fcda8/handSetHTML.png 590w,
/static/84e65ec1e909cf16f05d4d970f70098a/9128f/handSetHTML.png 603w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
如上，我们在&lt;code class=&quot;language-text&quot;&gt;HTML&lt;/code&gt;中有一个&lt;code class=&quot;language-text&quot;&gt;input&lt;/code&gt;元素用来输入，另一个&lt;code class=&quot;language-text&quot;&gt;div&lt;/code&gt;元素用来显示输入的元素；在这两个元素上我们声明了特定的属性&lt;code class=&quot;language-text&quot;&gt;q-value&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;q-text&lt;/code&gt;，这两个属性名标示着和数据层的绑定关系，如下，是相关的JS代码：
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 588px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 153.3783783783784%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEbUlEQVRIx51Wy24cRRSdDyCxPZ5+VXV39aP6MeOxx7HzIkJiHZAIKERix4Z8QhZICDlGcSRih0QxAgskApIXiFjsgoAVEvBbh3NrZowdjxPD4qh63FWn7z333Fvu/Pj8Dzz77S88+1Xw5//CAc8f/P43hKvz9OAXbNz/Ah9v3sedjS3c+XSKe2fEeP8nWw8hXJ3tvR9wpaoxWg3QzX0szHWxsNhDl5iuDr3T4GF+oYvYZHhIrs69R3uomwplGSMqaqi8gNIaXhDBDyO3jhHOhOxZ9HwkWYGtx3vobG7vIitKNOUQ/XoddTVC364SFzAgimoJejBCYhsEkULPD06QOkKTY3P7S3Q2Pn8Cy5RzfiEr+jDGIk0KQtYSKskRmAIR8TJCSfnug90xYVVXaImE0USZ4Sbq6XlY9H30PIE3xoTsRdJjhHcfPIEpLA9QJ27s9nxuCCZE/onDZ4qwbiz1K2DaIeoLq7BNDmUmqcap+1DvEOGR52B2hCKoSQ3qOkNTtahtizS30M0ACT8SUt+oZFHSHKGKnL4mrRCEajZhygMmLRDHBlkWO6g4mUSYwGcxPKXRC8fRCVEY6UM7vUC4izjNEOsUK8s1rl1psTIYYtheQrU0hBksQ/dXYPIKGR3g0XdnSDmjQUMSK0RRwq+nUIrgc0ANfZ3w7zEzyBlt9OoqZ2XlxF50FfZpGd9Vu3uk0gJnoxnWOVFlW9HEjC6gjipNmZpGXiSMmBGKdjOscrptGGFeFqgZZVkNUdohqqaPYtBHZnPohCkfiu+5w4vTqN0qmXn/EkovR666GlcvlrCr60jqPobNRSw3l4lLWO1fQ79a5Z6G0UtxamhtoEmiTew+JoU9VuVQKfowR5an0CyINS3MpJ9NUlESi4g+VCyQP5lAMmmkSDNtE+kI1loOCRlhJTym6unYVV8IpPpSefGgUlJ1dZptdt0PGZSjZXbKUol07Q3kl9+E5hRq7DIG9ZpLfdS+jiWOOFu0iJjRtOoyaE8QirAJ0ytMHzGji9MYeVIjY4uJXjLSxIdJzK6ijkoZ906QcMRJt4kFnQ9j9nI0Ma8Kxdi0ELVRNLikGgTSavEhJOUg1IySZ0QGtmGS5WPC8bRh9XKKza4ISO5WXgPSIR4RMOJQj4vQc2n6x4zePWobISxpbFsUKNs1jrAlJJwsGe+XgBPIp6XChFDT+yN4eeuJsW01QE4trFwD9Jg8Z2KVWK4AOoCDwWd6ipFGsToS6SnDwXD2rfQ5ZYYj1MOrKBt2Sz25qNp1FPUKJaB+HGVRrJm+jDTttJs9D3l15mmLijdfHGfUzFBL8WaKRPqbREIife2I1ASnEdq6hWYhpFuc+6eIxr8DF41yOPbevaPBSSpBSRu7XnYd4Gv3H8L5uXmcn59g7sg6N3/83QRz8wt47dw5R/7ZDu/lR9/s44MPP8Jb797C9Rvv4/o7N/8bbtzE2+/dIsdtCFfnu5+eY2//Zzz+dh87X3+P7a+eYofYfgWme+SMnBUO4foHQFfiiewvd28AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;handset&quot;
        title=&quot;handset&quot;
        src=&quot;/static/bfc4c520ad6b2c659b9e799fe2753790/9bbaf/handSetJs.png&quot;
        srcset=&quot;/static/bfc4c520ad6b2c659b9e799fe2753790/12f09/handSetJs.png 148w,
/static/bfc4c520ad6b2c659b9e799fe2753790/e4a3f/handSetJs.png 295w,
/static/bfc4c520ad6b2c659b9e799fe2753790/9bbaf/handSetJs.png 588w&quot;
        sizes=&quot;(max-width: 588px) 100vw, 588px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
这里我们实现双向绑定的思路是，视图层对数据的绑定是通过特定的属性&lt;code class=&quot;language-text&quot;&gt;q-*&lt;/code&gt;，来将&lt;code class=&quot;language-text&quot;&gt;UI&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;Model&lt;/code&gt;绑定起来，使用事件回调监测数据的变化，更新数据，然后刷新&lt;code class=&quot;language-text&quot;&gt;UI&lt;/code&gt;。&lt;/p&gt;
&lt;h1 id=&quot;脏检测&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%84%8F%E6%A3%80%E6%B5%8B&quot; aria-label=&quot;脏检测 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;脏检测&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;AngularJS&lt;/code&gt;的数据双向绑定是基于脏检查的机制，脏检查的大致实现思想是，在数据层上维护变量的当前值，当视图层上的操作引起数据更新时，会执行脏检测，如果有绑定的变量的值发生了变化，变量对应的指令就会刷新数据绑定的&lt;code class=&quot;language-text&quot;&gt;UI&lt;/code&gt;；同样的脏检查机制的实现，我们在&lt;code class=&quot;language-text&quot;&gt;DOM&lt;/code&gt;上的也有绑定两个东西，一个是数据层上的变量的应用，&lt;code class=&quot;language-text&quot;&gt;UI&lt;/code&gt;更新的时候更新对应的变量，然后另外就是绑定的指令，用来执行具体的&lt;code class=&quot;language-text&quot;&gt;UI&lt;/code&gt;层面的更新逻辑。
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 102.02702702702702%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAACtklEQVQ4y52U20/UQBTG98WgsDywbNtpO213Op22e4FNFP8o1JCIBBRE4gOKCkRDQGKQi/ECQozRmPjHNfk803JbrsLDL3PrfPOd0zNTWtv+hdGJaYxMTGJ49AnuXYPhh48xNj2LrR9/UXq+uIoWq0DU+3Cj3IPuW93oLpeP6DlG+TQ9vb3o6roJHggsrX9D6dncWzheDUo2wIWAG8ZgDodlO4Rb4OyTz3XCaL5qWlBpA/MrGyhNzS7AsCzU40HESQtB1ITvRYQE5yJvXTqdiQimXWw2LNZBpb+KUCV4tbSG0lMSrFSrSNMWkqQJlzmwiZObDrhIcK4QXMwFHddDIxlC6odohymF4sGgzdUTnCV6QrBwyBhHU91F6CskQQLflzCZfWrz5Q5fLKKPJqSK85CVShFIBYMSfp6jSwW1w0BIxKqJoBbBljFML0C/YXSInid8pkNBrgZbQ5Ak7Dk+PB4ioL9tUy6v5jDPoQGLuWhQDhtBhBY5tEiU2fzMPP6HYBU2bU5lGypsIhYpUScxnUezCPkqgjpXrtAFHOVOdR06dMBFrg6hCLShQ0F9U7SLpN4Gpx9i6KtE5D/EMNFPa5X9fj7OORrrWu077dCkfLmQJBintxHFA6hRHu0ohUf1KGspuB5Lqk+KIojqeSV4NZnffdPzESUdZWOAcY4wGYCgwhYiBld1OKqBgG6NEAl4FMOpKXgR9dNBuFFE39AhQlEUFmR83CGFFbbvwKeHwbE9MDpR16Hl12ASBr0+jPJqcpr3RbHm0otEJlgQUkpMCDowfxxm5t5ltu9njkwy03YyenkIlpmE7ps51Gd23h6Mi/WipZRlcb2Vzb/fzEorn/YwPvMSDx5N4v51GJvCyPg0dKQfvv5E6ePO7y/Lm993Fla3dl8vr+9dlTeE3ruytbu9sfvn8z+NNHpMrUJNegAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;dirtyCheckHtml&quot;
        title=&quot;dirtyCheckHtml&quot;
        src=&quot;/static/b62136dacee091cedda6472b57d18c59/fcda8/dirtyCheckHTML.png&quot;
        srcset=&quot;/static/b62136dacee091cedda6472b57d18c59/12f09/dirtyCheckHTML.png 148w,
/static/b62136dacee091cedda6472b57d18c59/e4a3f/dirtyCheckHTML.png 295w,
/static/b62136dacee091cedda6472b57d18c59/fcda8/dirtyCheckHTML.png 590w,
/static/b62136dacee091cedda6472b57d18c59/a6d36/dirtyCheckHTML.png 650w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 588px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 228.3783783783784%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAuCAYAAAAoaDnGAAAACXBIWXMAAAsTAAALEwEAmpwYAAAGc0lEQVRIx51XyW5cRRTtD4Akdg9vrDdV1Rt7sB0bJ9kBfxCBxCBAiE0kFgQJEYTYoAyIRQIEhAkQBSEGRRjBinGFBHwS2fXhVPXg7rhtERbH79Vzvftu3XvOvbdbd3/6A/u//Y3vfvkL+7/+yfs/J9cHwPe//YXvf/8bxlbrzv5PuPTWZVy89AYuvEa8cgkXLq7C60dg8r9X33wbX9BW6/pnX2FHavSbNk5GbZx46CROnDq1hJMWa6uxto6HHj6BMErwPm213rn5GYq6hJQCoaqJHKGI4HqhheMF6PmE66HruPa6DB/tbg8JnXr3w8/RuvLeHlIudNqg1lvI5RCV2uD9aTSEzPsImg0IXfEDPjo9xxpexHqniziVuPreJ2hdvv4xiqpEliaIZI0okQiDGEGQEDG8IEJPxHAJ49FRBiMavHJjjwZvfAxd5PRMIVIVvCjiJgftXs+iY9CdYmasd4zBKzSY6WKymRvXuy5j4kwMcKO9zl7mns4CVntojlzmqAuFrB6g3tliCBTCTMHLcgRxeuiIM8yM3ufhnl0EQQglI2SJgkwKhDTkK17zGm6cwZMFnCiF63uIhUISaTjM8EqDCeOXxBIRX9A6omEBQYMuvfRJIUObrsmwMzuqN6fRYYOkTZRklhLDgcbudol+2UdTbCOvmHWGIahGpEVOJuTzTC/G8ZCHcSbtRi8wX/XRcwJ7HNclob2Jdw6fe75YSZ1DWZbMcpubDOMN1g06k3uT5YPsHlDnmCzvIWeW0zSAl2iIJIXMBJQm0RNKkPFrd7srCX2Eh0Z6CpoJKIqanBxB8poyfqk0iSIDPCrF9eceHhvDq0xKSFqEwsOZbQm9uYlIlxiVj2BY7qIpN9Cvz7CA7PAUJeJIIY3Jz5DyTBK+K6zhKM2Ws+ww8JniMaOAGQ8QhRK+H8EJWGFCAYe0cgPxH45sDUoadKCyCirtk9y5NepHk6+3+YJFtzuNZ+/4GJrFWruLzSEL7bCC3nkc+sxjSPoDFo0GhRqhyU+jn+9wPZgkaiHjh3nIhXnYVAl1zPgMTkMMhoxXxtq4iZIGDUyd1MUGEhI9IiP8YMLLFR5mfNixLw2LXdTlJqqqj1FxFpvVOeSqD81a2RRb3LOBYb3LdYOEujexX6EUhWBa9k1Jn5V/E0fPE/ZqPDl4HlpdG+IfqZSe687VYIPf682VM1PMJCnTde+YpBgPO/TMC0kTBtwNTYVhg2KMXJY189wldRavpuKsTIopsKYFSBUjZCMKVMl/RigriUySl3lD1LaMGR72PP/4AnuZf6RWVEME3ZQItIaicgqqpVBGfux2gpwMgpWyW0lsQaUoJbCzJcm9ERKdo5B91sVtZGwDgh0vJGYFdl5xnCO0bAyGoYdhP2NRKBBkGRKRsKAWyLMBdNJAxuVEPaHPvWIhKZ5V0SGlmAz265T8qyBkiVIPrCpUTgKb/pIVlCL79HSK6ExbrWHFertzWCmn1jtIUoEtSk+ywtRbjyLPOUUUAxT5JurmLKp8Czqv2LhKpMXIEtsMBOYDhilLHpo4mAYvWaJqtWVVU3AsMRoueOyS94Wix+x+VjV8Pqp2rXpEnFin7jPYsTJK4wIZ46UzVp1p/ZNJZRHbzsgEpizEXKusZh8Sq2KYWe+M/CaS6s5HkSV0Z9eFUsb9h6Rnpq/ONFt2/Og5tkmtz2XXncptSpkpJvRx7OmWlFI3FXIdMNgclqiUIAqZjIzPGBvJeVFRLWZ68IQtHkaWPR7V8cW0ULjLMUzYlxvONmU1IA83GHjT7DeRMospx5I0rThZ5HYE8clPL9N2NBFs/BFHEqN9M30sdD22zyC3ychio4zMfnWt27HHMTioMs7BeDddLx/5hpm+SOKstDOiNGSmRzbTnGpjPg/JRYdemC7nC04R900PK0eRqgihK41wsM3xt7CeFnJkR2TTU4Sgzkkhn7F0Ux6Z2j7aIBclPetXpzHon0Ndc76mKgyRXf+gSpukOPOEBMdPsCrpUx1DDutsSpoNiq3VDEeTCjOJ1XxEnk0QR3koqU3bAuaCXxyIvGW4UzgHPzNMsqyWWbla196/NY4TPeb8MuaG8dp6e7zWbk+u/wXtzpg/jsaBiMfXPrg1bn105y5eevlVPPHMCzj/9PM4/9RzDwa+8+SzL1obxlbri/2f//n0mx/v3bz97b0bt778X7h5+5t7n379wz1j61+8jKHEu/7ouwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;dirtyCheckJs&quot;
        title=&quot;dirtyCheckJs&quot;
        src=&quot;/static/7ad9370138dc63b7095da4782d30f90c/9bbaf/dirtyCheckJs.png&quot;
        srcset=&quot;/static/7ad9370138dc63b7095da4782d30f90c/12f09/dirtyCheckJs.png 148w,
/static/7ad9370138dc63b7095da4782d30f90c/e4a3f/dirtyCheckJs.png 295w,
/static/7ad9370138dc63b7095da4782d30f90c/9bbaf/dirtyCheckJs.png 588w&quot;
        sizes=&quot;(max-width: 588px) 100vw, 588px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h1 id=&quot;数据劫持&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%95%B0%E6%8D%AE%E5%8A%AB%E6%8C%81&quot; aria-label=&quot;数据劫持 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;数据劫持&lt;/h1&gt;
&lt;p&gt;实现双向绑定的另一种方式是，使用数据劫持的方式，给数据层的属性定制&lt;code class=&quot;language-text&quot;&gt;getter&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;setter&lt;/code&gt;，在&lt;code class=&quot;language-text&quot;&gt;UI&lt;/code&gt;上触发了回调函数更新数据的时候，会调到我们定制的&lt;code class=&quot;language-text&quot;&gt;setter&lt;/code&gt;中，在&lt;code class=&quot;language-text&quot;&gt;setter&lt;/code&gt;中会刷新&lt;code class=&quot;language-text&quot;&gt;UI&lt;/code&gt;。
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 108.78378378378379%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC8UlEQVQ4y51VS08TURjtGvtAOtN5dt7TmekLsSb+BFkIQV2w0ZUrVkZiUDBBJRoMIMEgEdQoMYFEBXQjJuKGjfys47ltISBpsC5O7r3tvec79/vOdyf1+cc+tn8dYOvnb2wL7HWPnb0D7JDj0+4+Um82v2Fichp3Jqcwdm8SY3cfdIfx1jj+cAYfvnxHanpuGQ1TQVDJI631IZvJIdvbS5xvj0SuM3Lcdy6TgV60sPB6Hampp/NQDAtWMYCiaZANE7KqQlIUyIpKKCioWkcomg6poMDxAzxbWkVq4tEsdNNANR5AnNQQ1i7DcWPYlg/N9aHafpu4M/KyDMv1MLPwCqn7j58zQgEJyeq1AWiqDlU1oGomCnoL4pBQ0ZFQIqHj4cl8mzAvF6iyiCQagG956KcqVS82IwuiQ7JOpKcJqbBQ0FAOGii5CWpODN8rQ2duzyLrqNCyXZSCKjw3gu8EvLrBzdrRoS4JZXhBiHLSjySuIqjWofulEyRdKyzaDlwvgFm0IbEwx4vRfQ4FoeWgWmYOfV7ZclE0PXrTp32Cpt+6U8iiKFRVDi8hYVEaYUznu/zNIJn+f1cW3ov9OsolGtyvouJVYNthM9hRHv+VULSX6bEzWN2CqCzVKO0KS2d0ySlC0XqyqqAU1WH7MWSdV6TJhTKxUaJ6cYO8JHEuN+fSIdppaLbecYXiD1Uz4LJLougCwkoDvluCSetoLJLFwjhhAi2IYNoeDJc+JVSz9TD0MdipHCqGDjeqwrWFsUlCIoNrk6qtgIjrMEMGCSN6NIJiWjxjECZtZvBx8Em43CIUz5ZX7YefXGzZxWEvc4NOFboXQuXaYBuKfhdzYXrdK8FwHAakWs4dqm8TziIn5ZHng5BlztJ8LNPZLDIcM8fGdBvNufgtI8bWuqenp+nVmRcrSM2tvMfI6E0MDl/HlasjxLUWhv4aj2Po5Hxw+AZGb93G0tsNpMR3YG3ja3OxuPYRi6tdgmdevtuE+Datb+3iD2vy0WupJFUpAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;hijackingHTML&quot;
        title=&quot;hijackingHTML&quot;
        src=&quot;/static/3c12a9b983da2392d418567bd376f722/fcda8/hiijackingHTML.png&quot;
        srcset=&quot;/static/3c12a9b983da2392d418567bd376f722/12f09/hiijackingHTML.png 148w,
/static/3c12a9b983da2392d418567bd376f722/e4a3f/hiijackingHTML.png 295w,
/static/3c12a9b983da2392d418567bd376f722/fcda8/hiijackingHTML.png 590w,
/static/3c12a9b983da2392d418567bd376f722/36bb5/hiijackingHTML.png 611w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 588px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 185.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAlCAYAAABCr8kFAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFS0lEQVRIx5VWTY8UVRTttcDM0N31Xa++Xn1Xd0/PDMLC36HGBFAJJArERGKixr2A6IIB8YPRQRMSEIgrRV25wF+i/IzO8bzXPdBjV49hcaq7q+uduu/ec899nfu//IkHf/yFnx4/wYPfnuDh7y+OR1yvcI9cnd1Hj3Hpg0/wznsXcfrCRZw6ex6nzl1YgvMLOM37J7nm/KWPcYdcneu79/ByXqLK17AadHH40AqOrK7g8MoUR1ZWCXVvtRUra2t46dAhhInEzd376Fy7dQf1cIBUBgiyAYK8QhBGcN0ArhfA9gQsBceFaTsLUPd7homsrPH5V3fQuXpzBylJkqBCnW0gT4Yo0zGabEtD5kN4zQZEXsPm4r5pwbDsfej2+kiyAldvfofO5e3baFSESYggrSFiycgEHGcKy/Fger6OUkV0IOGNHXSubO+gqGskkUSQFLCF4EMWeqapF0/B74bZStZCeJuEDf8wYdjMh+2hz4c0Qd/Q+XlOvIjWCMuG+StSpM0Iw+NbqJuc28/hZjX8JIPJ3BkK3LIiMPli03LaI1SXJCt1wpPYR+jHiIIMrgjgxCm8lP8FMZwkh8VPy3EQilQ/Y5FYE/bnI+RFUodRIBGToGlClEWIiJF5fMijhCw/gOl6evH8Vg+IsIDBh5pGYmtcoKIeq2wTGV8kqgG8aoQoziHjktt/Xun2HN5QOixnIuXDhlowy5XO0yxXps0tevuI2qt8Q1V5MFdNc59M5he3bXeB8DKrXDU1hS3gckshhZ3JkK2UsD9V63noGsb0JXOkS2WjLpJVTqIYg5otmI8RF42GTAtEUYaAVVV9rbat0mDq6jpaRipVXep1H2HMhY5r4fhWgmI8hODvcXkCo+IEhsVxbFSvoCmPIUkHlBZfEubw/FArwA+FTtdClVVBgiiB7/qwuQ2bhbEsVaC5as5aUulurzWXyqZvGhg2KaqqRDDchD/YhJNmCJU+GVEWNyiSEb8XTA81SsPYIzy6kMO8wFq3jzwLmc+YulvXpB4jTuMaWTJALoco5DpBTUap7hINulHrltVN30/pi7QwX8AXDr+z6mwxxxUQgi/yQo0oVBFGOloFISLIosSVPWErt3VJYjJH/f+4i/EM+7W3VDbaYEdDai+AoLsItpkni6nREnaYwEtoEoEHm/38/wbLS16RyIshJT9VpbmFwE+0bfWsKVTkKlLtkazyvOHuI/z0+m2MN5jwioOpHCFYPwG/YZWLCg7TEEUec+bCDUJYIoRNZ3dpaY5Okd1uX1lZsnoF0mzMaNdR1vystxBzJBQZJSMpp2KTDcBccwc2q2xTNqbdQjjtlByG4aHMMzRVSIlITr8SkhW0bZ8KsJ459N5o6B8s7JyO7SFJqLs04IyOaBIZizSAYOSqGPOdcWBR9nTY7bHBIzVbmE+aRcRtxiQsyk0O/mS2eNFclxIqJxZCVTimTbGP2dOqC1R0yl0sNQJmc/lgx96eGqzLuaHfuJevmSloD5zBsO1nhVgaoXZsijnjgCpzzg36oUwqSG5fHUtiybMO5WSLqV25wtXnmeVzWcumQsnCNBXJijHPMexhnmlkWPKcs44wTKez2Z6mwuGItalDJZ0F2Vze/haj9WOMiMcREiTB1EA1CRe7NFtLaU5v2Wk9gfU4ItQo1oSfffn9RMpy4trBhHY06fZMwpj0+uaEPjc5avCz25usHe22g//xHDkJYjm5dmt30rn140O8+/6HeP3Ns3j15NtL8drJM+04dQZvvHWOHB9BcXV2H/769zd3f/7n+s7dp198/cNTHhpfCGqNWqs4FNe/LSKXlX1m0TQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;hijackingJs&quot;
        title=&quot;hijackingJs&quot;
        src=&quot;/static/e0a87d1af9cf2795279397f5fdbc0b8d/9bbaf/hijackingJs.png&quot;
        srcset=&quot;/static/e0a87d1af9cf2795279397f5fdbc0b8d/12f09/hijackingJs.png 148w,
/static/e0a87d1af9cf2795279397f5fdbc0b8d/e4a3f/hijackingJs.png 295w,
/static/e0a87d1af9cf2795279397f5fdbc0b8d/9bbaf/hijackingJs.png 588w&quot;
        sizes=&quot;(max-width: 588px) 100vw, 588px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
在&lt;code class=&quot;language-text&quot;&gt;DOM&lt;/code&gt;属性上我们只需要指明引用的变量，具体的&lt;code class=&quot;language-text&quot;&gt;UI&lt;/code&gt;刷新逻辑定义在&lt;code class=&quot;language-text&quot;&gt;setter&lt;/code&gt;中。&lt;/p&gt;
&lt;p&gt;以上是实现一个双向绑定的常见手段，这里只是了解大致的原理，具体到不同的前端框架中实现的双向绑定，比文章中介绍的更复杂和更健壮，这里只是了解其原理，抓住主要实现原理，框架层面的实现也是基于这些原理来做的。
文中的&lt;a href=&quot;https://github.com/Soyn/demos/tree/master/mvvm&quot;&gt;Demo Code&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;refrence&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#refrence&quot; aria-label=&quot;refrence permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Refrence&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://jixianqianduan.com/frontend-javascript/2015/11/29/js-data-two-ways-binding.html&quot;&gt;javascript实现数据双向绑定的三种方式&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://segmentfault.com/a/1190000004681757&quot;&gt;JavaScript数据双向绑定的简单演示 - 前端知识点小结 - SegmentFault 思否&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/25464162&quot;&gt;数据双向绑定的分析和简单实现 - 知乎&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;兴趣遍地都是，坚持和持之以恒才是稀缺的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[浏览器同源策略]]></title><description><![CDATA[什么是同源策略 
上面是对同源策略的定义，简单来说同源策略就是限制不同的源（）之间的交互的安全策略。想象如果没有同源策略的限制，你访问银行的网站A时的登录信息，在你访问另一个网站B的时候，B网站可以拿到A网站的信息，如果B…]]></description><link>http://cuteshilina.com/2019-5-11-sameOriginPolicy/</link><guid isPermaLink="false">http://cuteshilina.com/2019-5-11-sameOriginPolicy/</guid><pubDate>Sat, 11 May 2019 17:00:00 GMT</pubDate><content:encoded>&lt;h1 id=&quot;什么是同源策略&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BB%80%E4%B9%88%E6%98%AF%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5&quot; aria-label=&quot;什么是同源策略 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;什么是同源策略&lt;/h1&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 14.864864864864865%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAi0lEQVQI13WOwQqDMBBE/f8vrAe1eojZZBPR1oJg+moiFnro4TGzO+wylTEjTdNS32pEBHiT0s6+X6Q//peUzqyalyej9RhjcM5jxR+qqCo+zOj0IsSsDzTPemYxxq8PGsrtuq5U7mjVtR1D39N2d/rBFKy1R2NXWouPOJ2QspNCfnDl2S/zwrZtfADWnuOnmFnHggAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;wiki&quot;
        title=&quot;wiki&quot;
        src=&quot;/static/49845fdad5ecbf983a6b04332b3a2a3d/fcda8/wiki.png&quot;
        srcset=&quot;/static/49845fdad5ecbf983a6b04332b3a2a3d/12f09/wiki.png 148w,
/static/49845fdad5ecbf983a6b04332b3a2a3d/e4a3f/wiki.png 295w,
/static/49845fdad5ecbf983a6b04332b3a2a3d/fcda8/wiki.png 590w,
/static/49845fdad5ecbf983a6b04332b3a2a3d/efc66/wiki.png 885w,
/static/49845fdad5ecbf983a6b04332b3a2a3d/c83ae/wiki.png 1180w,
/static/49845fdad5ecbf983a6b04332b3a2a3d/1bba3/wiki.png 1433w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
上面是&lt;code class=&quot;language-text&quot;&gt;Wikipedia&lt;/code&gt;对同源策略的定义，简单来说同源策略就是限制不同的源（&lt;code class=&quot;language-text&quot;&gt;Domain&lt;/code&gt;）之间的交互的安全策略。想象如果没有同源策略的限制，你访问银行的网站A时的登录信息，在你访问另一个网站B的时候，B网站可以拿到A网站的信息，如果B网站有恶意的代码，就可以直接访问你的银行账户。
同源策略中的同源，是三个相同：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;协议相同&lt;/li&gt;
&lt;li&gt;域名相同&lt;/li&gt;
&lt;li&gt;端口号相同&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;以&lt;code class=&quot;language-text&quot;&gt;http://www.example.com&lt;/code&gt;为例：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;URL&lt;/th&gt;
&lt;th&gt;Outcome&lt;/th&gt;
&lt;th&gt;Reason&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;http://www.example1.com&quot;&gt;http://www.example1.com&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Failure&lt;/td&gt;
&lt;td&gt;域名不同&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;http://www.example.com:8080&quot;&gt;http://www.example.com:8080&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Failure&lt;/td&gt;
&lt;td&gt;端口号不同&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;http://www.example.com/dir/page.html&quot;&gt;http://www.example.com/dir/page.html&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Same Origin&lt;/td&gt;
&lt;td&gt;仅仅是path不同&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;https://www.example1.com&quot;&gt;https://www.example1.com&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Failure&lt;/td&gt;
&lt;td&gt;协议不同&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&quot;同源策略限制的范围&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5%E9%99%90%E5%88%B6%E7%9A%84%E8%8C%83%E5%9B%B4&quot; aria-label=&quot;同源策略限制的范围 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;同源策略限制的范围&lt;/h1&gt;
&lt;p&gt;同源策略对跨源访问的控制可以分为三类；&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;对跨域资源的&lt;code class=&quot;language-text&quot;&gt;写操作&lt;/code&gt;是可以，例如表单提交、重定向这些不受同源策略的限制&lt;/li&gt;
&lt;li&gt;一些替换元素（img、audio、video等）不受同源策略的限制&lt;/li&gt;
&lt;li&gt;不同源之间的资源读操作（获取cookie、localStorage、DOM、AJAX请求等）受到同源策略的限制&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;对于开发人员来说，第三条限制，跨域资源之间的读取受到限制，这个是最常遇见的问题，对于第二条中一些HTML原生标签不受跨域访问的限制，可以用来&lt;code class=&quot;language-text&quot;&gt;hack&lt;/code&gt;掉同源策略的限制，以下资源是不受同源策略限制的：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;script&amp;gt;标签&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;外部CSS的加载&amp;lt;link rel=&amp;quot;stylesheet&amp;quot; href=&amp;quot;...&amp;quot;&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;Img&amp;gt;标签&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;video&amp;gt;和&amp;lt;audio&amp;gt;标签&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;object&amp;gt;、&amp;lt;embed&amp;gt;（&amp;lt;applet&amp;gt;也不受同源策略限制，但该标签已经被废弃）&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;@font-face引用的字体（浏览器实现有差异，有些要同源）&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;iframe&amp;gt;中嵌入的内容&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;如何突破同源策略的限制&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A6%82%E4%BD%95%E7%AA%81%E7%A0%B4%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5%E7%9A%84%E9%99%90%E5%88%B6&quot; aria-label=&quot;如何突破同源策略的限制 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;如何突破同源策略的限制&lt;/h1&gt;
&lt;h2 id=&quot;change-origin&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#change-origin&quot; aria-label=&quot;change origin permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Change Origin&lt;/h2&gt;
&lt;p&gt;在网页上可以通过设置&lt;code class=&quot;language-text&quot;&gt;document.domain&lt;/code&gt;设置当前页面所在的域，例如，在页面&lt;code class=&quot;language-text&quot;&gt;http://store.company.com/dir/page.html&lt;/code&gt;中的&lt;code class=&quot;language-text&quot;&gt;JS&lt;/code&gt;脚本执行了下面的代码：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;domain &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;company.com&quot;&lt;/span&gt;；&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;那么在当前网站上去获取&lt;code class=&quot;language-text&quot;&gt;http://www.company.com&lt;/code&gt;的网站上的资源是不受同源策略的限制的，但是这个改变&lt;code class=&quot;language-text&quot;&gt;domain&lt;/code&gt;的方法仅仅用于二级域名获取一级域名的资源的时候，你不能在&lt;code class=&quot;language-text&quot;&gt;http://www.company.com&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;domain&lt;/code&gt;改变为&lt;code class=&quot;language-text&quot;&gt;otherCompany.com&lt;/code&gt;。&lt;/p&gt;
&lt;h1 id=&quot;iframe&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#iframe&quot; aria-label=&quot;iframe permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;iframe&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;iframe&lt;/code&gt;在的父子窗口如果不是同源的话，在访问获取彼此的DOM节点或者读取数据的话，会受到同源策略的限制，无法访问。
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 99.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADMUlEQVQ4y5WT2U9TURCHLwUqi4JbxC1GTUTbCi0t3bBlKVUQjTHqgxqptMEYkSCKNhEi4obBBQJu0FKjBbpRBSnVaCyIf9V9Oj/nXFDQCFcfvp629853ZubMEaIf58RI8psYSsyIY4mUODb1n/AYig0nZ0XuEsLTs4gQ7z99Rzw5i1hyhn6nEEnIE03MIEax8U9ziFJsaHoGQiiRYv1vYuys9w47da2Lnb7Syc613mLnrhNtMlzvZC5vF6u/0cUeDgZZmFxCZOorGm/3YLeqFIeqDNh5UgvBroewSwehkNgjw156d4cKJ5q9lHEKQjD+EY3t95GnMWG70YR8mxFpRjPS1MR+edKLLJL4+KU2BONJCIHwB7hvdELQGJFtrMIqrR2CykSUzrOPUBvpuemvcCkXHm1sQSA0AcE3+g6uax3Sw/VWBzZX1CDPXIlsvQ15pkrkm6uQqS1bVvpTeNhzGb6ROIQh+nBdbad+lUiSbVV12FJRK33n5JM8U2uVFda6mzD0NkbCYBz1rTepNAMyiq1YSxltPOAkkZNENtrIsCjj6x/iX8KGJgz+KeQ9y+CZmSqwtdyMgnITcktLaCPeR5PU59+RE9Lu6aV2ZNkOIrfMik12DbY51CsIjfLCDN4zWzWU5XXIMVJPK1V0OLr5k+fSpauKZBqZkhWUobKsGrkWM9ZZddhQVkz91ErkGEqwhuTZej3WWrR0eBr6nzIt1JPw0lJhuyTk47GaRiXP4sAmm5OCLVSugYaXequllUrPXFiVOgOyaQOlzixNyGKGNDb10tjokVVik064wH6I1oNQ7LculqiWKdm9IJQG+2oHFEVmScJncD2VLF0pNW86naRmGeiZgr9HGdbxwaZqhUBoEufbbs1fdM3CnPErRxlLF18O3vudGropzfNXbzj8gXX1vmLHLrSwGtdFVn3GwxynG/4BN3Oe9bBaijniaWbe7j7mD00y4fV4EoOU6rPhMTx+5kf30xe493gAdx+tzD3iwZPn6On3YcA/glfBcQSiCQgjk1/EQHRafBmMiwOBsNjnHxV7h0bEp0PBFekl+nyjYn8gJL54Oy4OR6bE4MRn8QcfHQ/iOrUShwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;iframe&quot;
        title=&quot;iframe&quot;
        src=&quot;/static/390bcd5a0b4457e6cf9b5680d05b2acb/fcda8/iframe.png&quot;
        srcset=&quot;/static/390bcd5a0b4457e6cf9b5680d05b2acb/12f09/iframe.png 148w,
/static/390bcd5a0b4457e6cf9b5680d05b2acb/e4a3f/iframe.png 295w,
/static/390bcd5a0b4457e6cf9b5680d05b2acb/fcda8/iframe.png 590w,
/static/390bcd5a0b4457e6cf9b5680d05b2acb/cab8c/iframe.png 744w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
父窗口所在的域为&lt;code class=&quot;language-text&quot;&gt;http://localhost:5500&lt;/code&gt;，其中子窗口所在的域为&lt;code class=&quot;language-text&quot;&gt;http://localhost:8080&lt;/code&gt;，这里父子窗口是同源的，所以彼此在获取资源的时候，会受到同源策略的限制：
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 33.78378378378378%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABHUlEQVQoz4VSa0+DQBDk//+s+k0SbWNrrLY2Kc/jcTyOA0Fux72rpI2Juslk94a9YZjg6UKjbVtIWaGqG2R5gSzLIbirosAYhZiGAQSAiP6FJ7IMcZwgL0r0fNEYc8U8O9hFe/7ZL7jOTjCKIgRBACtc17WDday1RlVV7mznhZNSous6KKWY61A3E/O927OinhACwZkFReaWav7snhds0eLSvv3W+S9wDkt2EaYCKeelxwlq+EA/jhgN4bboG3+VE5Qve+inLZrNBurhEWq7g9ozt17DnE4wx+OlJwnofEYXxyg5Jml7GKJJUyT83M7EUXjN2yvI92HuVjArhn8Pet6BTu8XscMBhoVMWcJwznOeY2J8Lt3+CczbmTjfL+G5GbOKEM1hAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;parent&quot;
        title=&quot;parent&quot;
        src=&quot;/static/7408e8542b2999605d036b3dd6ddac2a/fcda8/parent.png&quot;
        srcset=&quot;/static/7408e8542b2999605d036b3dd6ddac2a/12f09/parent.png 148w,
/static/7408e8542b2999605d036b3dd6ddac2a/e4a3f/parent.png 295w,
/static/7408e8542b2999605d036b3dd6ddac2a/fcda8/parent.png 590w,
/static/7408e8542b2999605d036b3dd6ddac2a/7608e/parent.png 735w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 104.05405405405406%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC30lEQVQ4y62U2W7bMBBF9f+f1Kei6JKiAZrYdbwojmLtEqndlmRZ1O0lGwVpm4ciKIEDChR5ZyFnrN1uh/V6jf1+j7qpkYcZ0vsUXV3jSIRoIdIT0rRBXpxQF0c0skFbd9Bjwu/DWi6X+HJ1hdvbBYo8o9ARYh8htm3IKIb7KBG4Ev4hROSHCJwD/wfos5JqCtPlgmkcn7GyLIOUElVVoZCC1gsEm0cEtoemLFHn0lAVOf9JFGGAOgox8Z8RGYbfsJqGITQNTqcTyrpCHuco/JzG/wzm34ZVM08aLTrQwtCfMXS0Nk1vwtJCs6hZfErzvGH+/mcPXwoqpQxvFXtV8KXQm0KexV7z8M05nL38H8Mq+Z70G3zpqca8y6Iwz6nrOpzPvaHvf6HXXsPyPI9llRoBPSdJApvlqInj2IhqA2GUGOY9er925k+snOUmRMo6LSDzHIKV4/o+D0c4Ho/P3rtBCsejoBCmso70XP+fUzZjHfwYP1b38PcHlpsNj54VAWuV1iQPa6t6Y9+1Bh2WXtOiGh3BnB7joReGiMMI/naHhB1HPDwgcxzWawTX9RheyjAFzrqKLqN5Bbr+Q56JuKekmPY0iRMIGrCSsGY3Kc1id2pxaltUunWxxnt6oy+l5qHhfDadRenuQtGnx2omHYlDJwJGZmXrHbLPX6EWC4zX1xi/fYO6W+HCtna5+Y5pu8HEb7VcQPEC1eGAkuREOA+oKdKQ+P4ehevC0vnKdjYSe49Uz6s14vUW/t0GCdMguKZkhklDrzWKjHUDRS5VjaEo0ecFzpytNNoyh3eIghUCb4mI3567hO8ukEQb5svBZZBQI1uaoXie2RQRRza2m2vs7RuEwRaW8K94s++Qep+QPH5A5LyH9L8gdT8iIW25QiVuUKXfMfYOm6gLNRyeycUPJOEN0ugWWbqEde4KXoYkGS+BbpP+lLMvVuiOEuOFYar2ie4v1Njy5lsz6z0/ASsCSTrLkd2ZAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;child&quot;
        title=&quot;child&quot;
        src=&quot;/static/b71d50b75cc6db015890660811ca1c64/fcda8/child.png&quot;
        srcset=&quot;/static/b71d50b75cc6db015890660811ca1c64/12f09/child.png 148w,
/static/b71d50b75cc6db015890660811ca1c64/e4a3f/child.png 295w,
/static/b71d50b75cc6db015890660811ca1c64/fcda8/child.png 590w,
/static/b71d50b75cc6db015890660811ca1c64/aec65/child.png 687w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
对于&lt;code class=&quot;language-text&quot;&gt;iframe&lt;/code&gt;额跨域问题，有三种解决办法：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用&lt;code class=&quot;language-text&quot;&gt;fragement&lt;/code&gt;（hash tag）&lt;/li&gt;
&lt;li&gt;windows.name&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;postMessage&lt;/p&gt;
&lt;h2 id=&quot;fragement&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#fragement&quot; aria-label=&quot;fragement permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Fragement&lt;/h2&gt;
&lt;p&gt;这里的&lt;code class=&quot;language-text&quot;&gt;fragement&lt;/code&gt;指的是&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;中&lt;code class=&quot;language-text&quot;&gt;#&lt;/code&gt;后面的部分，在父窗口中把信息作为&lt;code class=&quot;language-text&quot;&gt;hash&lt;/code&gt;写入到子窗口的src上。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; originalSrc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;myFrame&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;src&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; src &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; originalSrc &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;#&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;myFrame&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;location&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;src&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;因为&lt;code class=&quot;language-text&quot;&gt;url hash&lt;/code&gt;的改变不会引起页面的刷新，但是会触发&lt;code class=&quot;language-text&quot;&gt;onhashchange&lt;/code&gt;的事件，在子窗口中监听&lt;code class=&quot;language-text&quot;&gt;onhashchange&lt;/code&gt;的事件。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;location&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hash&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;onhashchange &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; getData&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;同样，子窗口也可以通过同样的方式，向父窗口传递数据：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;parent&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;location&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;parentUrl &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;#&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;code-classlanguage-textwindownamecode&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#code-classlanguage-textwindownamecode&quot; aria-label=&quot;code classlanguage textwindownamecode permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;window.name&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;window.name&lt;/code&gt;在页面进行跳转前设置的值，在跳转后也可以访问到，我们可以借助&lt;code class=&quot;language-text&quot;&gt;window.name&lt;/code&gt;的这个特性来解决跨域问题，整个流程如下：&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;在父窗口设置子&lt;code class=&quot;language-text&quot;&gt;iframe&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;src&lt;/code&gt;，在子窗口&lt;code class=&quot;language-text&quot;&gt;load&lt;/code&gt;成功后将&lt;code class=&quot;language-text&quot;&gt;data&lt;/code&gt;挂到&lt;code class=&quot;language-text&quot;&gt;window.name&lt;/code&gt;上，然后设置子窗口的&lt;code class=&quot;language-text&quot;&gt;location.href&lt;/code&gt;到与父窗口同域的页面&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;跳转到同域的页面后，父窗口就可以通过&lt;code class=&quot;language-text&quot;&gt;window.name&lt;/code&gt;拿到跨域页面设置的数据了
例如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;index&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;html  &lt;span class=&quot;token comment&quot;&gt;// {A}&lt;/span&gt;
b&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;index&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;html  &lt;span class=&quot;token comment&quot;&gt;// {B}&lt;/span&gt;
a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;empty&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;html  &lt;span class=&quot;token comment&quot;&gt;// {C}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;我们在&lt;code class=&quot;language-text&quot;&gt;A&lt;/code&gt;中加载完成后，在&lt;code class=&quot;language-text&quot;&gt;A&lt;/code&gt;页面中设置&lt;code class=&quot;language-text&quot;&gt;src&lt;/code&gt;为&lt;code class=&quot;language-text&quot;&gt;B&lt;/code&gt;页面的&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;，在&lt;code class=&quot;language-text&quot;&gt;iframe&lt;/code&gt;加载成功后，将数据设置到&lt;code class=&quot;language-text&quot;&gt;window.name&lt;/code&gt;上，然后改变自己的&lt;code class=&quot;language-text&quot;&gt;location.href&lt;/code&gt;为&lt;code class=&quot;language-text&quot;&gt;C&lt;/code&gt;页面，&lt;code class=&quot;language-text&quot;&gt;C&lt;/code&gt;页面加载成功后，&lt;code class=&quot;language-text&quot;&gt;A&lt;/code&gt;页面和&lt;code class=&quot;language-text&quot;&gt;B&lt;/code&gt;页面就是同源的了，这个时候&lt;code class=&quot;language-text&quot;&gt;A&lt;/code&gt;页面去子窗口上取&lt;code class=&quot;language-text&quot;&gt;window.name&lt;/code&gt;的值就不会因为跨域问题而报错了。 &lt;strong&gt;使用window.name的关键是在设置完window.name后，要将页面跳转到与父窗口同源的页面，这样主窗口才能访问子窗口上设置的数据&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;windowpostmessag&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#windowpostmessag&quot; aria-label=&quot;windowpostmessag permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;window.postMessag&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;html5&lt;/code&gt;提供了&lt;code class=&quot;language-text&quot;&gt;postMessage&lt;/code&gt;的机制，用于不同源之间的通信：&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 16.216216216216214%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAeElEQVQI152NWQoDIRBE5/4XNIiEfAR11BFxAz/GCtWQHCAN1a8XqDr23qi1wjkH7z2stSLOOWeklHBdlzDGiFKK7Px97xR3eh33feP1tniYJ5RSMMZAay0MIUgQeZ7njwykGckbyTAxZJtzoveOMQZaa6K1Fv6pD0Re5KKd5NhZAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;postMessage MDN&quot;
        title=&quot;postMessage MDN&quot;
        src=&quot;/static/949c7cc4e10beca3b39f3c3b82178ccc/fcda8/postMessage.png&quot;
        srcset=&quot;/static/949c7cc4e10beca3b39f3c3b82178ccc/12f09/postMessage.png 148w,
/static/949c7cc4e10beca3b39f3c3b82178ccc/e4a3f/postMessage.png 295w,
/static/949c7cc4e10beca3b39f3c3b82178ccc/fcda8/postMessage.png 590w,
/static/949c7cc4e10beca3b39f3c3b82178ccc/f941f/postMessage.png 736w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;./images/pm0.png&quot;&gt;
在父窗口中监听&lt;code class=&quot;language-text&quot;&gt;message&lt;/code&gt;事件
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 106.75675675675676%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAADSElEQVQ4y5WUW08TQRiG+wOMlu6pO7vb7W53e94WDHj4FcZzKCECQRQVrSgxeOWNJiQYNQpqxIiYRkALikJF0OgFagxi7+wF/hTm85ttLZFUhYs3M7s788x3eGc9E7MfZifnPr7OL3yeeVZYepWf36Lefno1vfhlZgIZjOWZmP04e/3e2Pu2ts4fLZ0dpQOZY6WDzajM5nQo01Y60trx4+aD3DvG8owjtbv38rJDBAinRNjG+cDrrYMddSjvf1RZs93rhWz/la/jrzHCJ9Nv546f6f0uGjbVko1rihVdU+wY9Ws6Ff0yilTGmlpjoyD56ane/m+M5Xmcf1Po6D5XlLQgyKZNeUGkPkEETpCA4wXgBSYRcBPwouSKzStyYex719m+FcZCYKHQfvJsUdJN0JxGqhgWNUMWqAEdAqYFfnzPDtsAqgG8uMJYLpBFyOEGLebQYDxFQ5YNsqKCX9FAUgMgEnXzwNHnCDyVLfowPaJqNJWup9F4ApLpNMhEgTqOr8L+nXINoJ8odPeevdRJ18POxiZIOCnQgkYVtvkIu7NF1gBFNyjRTdY9FyDJxI1yS8DfTRGxVoH0LqpYYcpqJsiKK16SQXBh68Bq6qKEQIny4h/AN4X2Ez1FORQBvX4PVXWVEtN2uysbNnZYLwMQxJUhLpRlIUhlD7Lvf0aIXRZYepiurBKqGTrOQ+wZSDAEhhWGIFrJsMNADMs9BA0PrqkxSq5WygyoOU1Ui8VoKI4etA1QYw7IEQeMZAMEokkIx1GJFFjRONjRGBAzTIkVpSLaq6vnwrqxmQ99eDNM9GCyaS9lixNO0u1ywkmXI8Oo0AVAmD8JAUVDf8qEYiCYsr+GbdBvfixwyLKoFY6AFYmCiQaPxOIQxrmFUAPTDpohF8yMX6lf7ZvCOqrF0xSbg6cqFH3JalMd+XKtyoCKqrbZ2BT35xAwQEs0UEnRKgvlDePfVQb2lYFj0/NznafPr/iwDgLWyceL7nXz8SjuP6qsqfNxcDJ7afkJsjxjU/MLV2/cXWpu6yrtP9Kyuu9w5udWtP9o62qm/UTp2q37S4zlyb1YzI08nRkfGp2YHBwezQ/ceTg1cHtk0xocfpQfGp2cZIzcy8XcL7qXwrIsCL1uAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;pm1&quot;
        title=&quot;pm1&quot;
        src=&quot;/static/0fddce5a3382f5a0f8e21679f12cbb0a/fcda8/pm1.png&quot;
        srcset=&quot;/static/0fddce5a3382f5a0f8e21679f12cbb0a/12f09/pm1.png 148w,
/static/0fddce5a3382f5a0f8e21679f12cbb0a/e4a3f/pm1.png 295w,
/static/0fddce5a3382f5a0f8e21679f12cbb0a/fcda8/pm1.png 590w,
/static/0fddce5a3382f5a0f8e21679f12cbb0a/e9131/pm1.png 614w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
&lt;code class=&quot;language-text&quot;&gt;iframe&lt;/code&gt;窗口和父窗口不是同源的，通过&lt;code class=&quot;language-text&quot;&gt;postMessage&lt;/code&gt;将消息发送给父窗口。&lt;/p&gt;
&lt;h2 id=&quot;jsonp&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#jsonp&quot; aria-label=&quot;jsonp permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;JSONP&lt;/h2&gt;
&lt;p&gt;在浏览器中，&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;标签是可以从不同源的地址上加载而不受同源策略的限制，这就给我们提供了一种手段，绕过同源策略的限制，&lt;code class=&quot;language-text&quot;&gt;JSONP&lt;/code&gt;就是通过这种手段来达到跨域通信的，但是&lt;code class=&quot;language-text&quot;&gt;JSONP&lt;/code&gt;需要服务端的支持，将返回的&lt;code class=&quot;language-text&quot;&gt;JSON&lt;/code&gt;数据和&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;中的&lt;code class=&quot;language-text&quot;&gt;callback&lt;/code&gt;拼接起来，只要前端定义了这个函数，在浏览器看来，就是从服务端加载了一段带数据的函数调用。
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 99.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC60lEQVQ4y51US09TURjsWqH0cZ+972dvn7fgxl8gLiABE5WERI0SYmI0cQlxhUqMJYgkmhYxGEUNQWCjRMWNC9F/1F3H79yWl5FKXUymaW/nzMz3nRtb2/6O9Z2fWP+8i40vP7Dx9T+ws4utb7/AtGLLax9x5/Zd3Lg1icsTkxi7MoGxq91j/PpN1FY3EavW36Bi6jCtOE4Lfeg51YOeePzE6GXc20vch5m5Z4g9WlyC6uchumXImg3ZdCBmVAiSDEHOEHeGGD0jR3xvdh6xh09q0AwLZqUf9kAFqueBkxVwggBelE4EThAjnrpfJcGFGhTNgJQRkc+X4Fs2KpoOkU5Ntx/c+8O/BR+3HCq6AY4T4ZklOGYWZVWDp+qQKQbXlcO2oGqYyFguFNuPfuQ4HgJPkXkeHAP77hj8XVA3oRQGoBdDqDZ99rKQ6QDZyULSLfAUX8oo+xCoY4G4Y2SJ3BnlMzB8B2ZgQfOzUHJlKH4BIg3NcBzYrgvH81uH0fM8TZk/5PSIQ55OzeZsBFnqzvZgeEXoVha6bkPJGAQTckaHQN2KNEQ2tI6RU9SbQex7ARwrB9cMYBk+PKtIgwqgqRZUxWiJMcgkSD230Or5SGReFBFQ1MA3oOcr1Gk/xQ2gmja50sCxztjCUxImKCjMqQmRTIjkmi331MyhKSfTPLkzEIYutKCAoHgWrlei7gLYfgg32w/TL0IJStALlWgrJNON6pHodrFbdSDIIqfT0BQLrp2HTVFzdojACWHpNCy6kio54vcWnA2CReVaa5Xm9iJXDwRZDM0NIFNPkkTrIas0BC1iBnZXo/KZ2J+L3eb9DjXLgZoLoeXDaOeOuxHRC+Mv4Ns8zRzOLtSakmY2kxmtmUilm32JRLMvmSIkD3EnpJrxRDLC9INqM7b48j0ujl/D4PAoBodGcW5opGucH76AkUvjmHu+gtirD9uNpbdbjafL7xrz9deN+VoXqLew8GK1UV/dbKysf2r8Bt1YlaEKEkFRAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;JSONP0&quot;
        title=&quot;JSONP0&quot;
        src=&quot;/static/8ed1a2cf0055c5161e5e1283996457fc/fcda8/JSONP0.png&quot;
        srcset=&quot;/static/8ed1a2cf0055c5161e5e1283996457fc/12f09/JSONP0.png 148w,
/static/8ed1a2cf0055c5161e5e1283996457fc/e4a3f/JSONP0.png 295w,
/static/8ed1a2cf0055c5161e5e1283996457fc/fcda8/JSONP0.png 590w,
/static/8ed1a2cf0055c5161e5e1283996457fc/374ac/JSONP0.png 634w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 81.08108108108108%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACfUlEQVQ4y52TTU/VQBSG+w/kXtrOdDrTdm4/uR8gookQSEhcuHHhj1EWBkEgQMIFiR+oC4wEo+LGKMaN0fjTXs+03HsLyMbFkzNzmr7znnNmrE8//uD42y8cf/mJ91//nw+nv3FCWtbeqyPcv3sHi/cWcXN2Abdm52ssjJhbOL8f5Oaqf27PL+LZ4UdYjzb6YHYTtnAxNm6j2bTRoNiwnTKa3Fhz/Dz1HK2vNZolazsvYC2tbiPSElGaQSY5rTOErRwqa0OoEFzIEiZ8cF8O9/Uc83xC4PH2PqyHK1tIYx9RnkEkBRKl4ErCV3AYwzg5tR13hFtfsyEO41jeeloJ6khAZyl8nUIHMeKwgNZE0kVArr0ohtQavjmMnBhnxpURMVwSdMlJnrUQZ12EcY4gysDIIQs1uHHLeSnkkpBryjsr90pBkwiCgByEYOSGB9Q7LsAZuaHoygBMUo5EHVNirdwrBXudALrbgyq6KOIe8mQKWTaFPJ+GoFbwIIKgAQxc1blcMvcwkack0IOOJxCSyzAkpyqAilII49D0zrRBVCWb6boDxxcFzSZP2mhnN1DkM4gnuoho4kxFcIxQ2AInzMH1yf675NWt8nQhQupjAi+gQeiEekkC5MRmXhndsyFcFLskuESCStGV8EPqEQ1GUq+EgpQaHpXoqao0l4TLAQ3x4BBlJDETS8EHK5s0UYlQpggk3TdzZVQLfpTTIFpULpWtzCEVnA7iniLnrHx6jeEzbGJ5cw/Wk53n6E3PIO90K9oDOsN10aGpn1EMmazoVvSuz2Bz/w2sw5NT9A/eYWPvAOv9l1jfHbFG+7VBNN/6o3Ud8+/u6yO8/fwdfwFhNA1SBD2PAgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;JSONP1&quot;
        title=&quot;JSONP1&quot;
        src=&quot;/static/0769801184b84dd3e1ae4f60827b137c/fcda8/JSONP1.png&quot;
        srcset=&quot;/static/0769801184b84dd3e1ae4f60827b137c/12f09/JSONP1.png 148w,
/static/0769801184b84dd3e1ae4f60827b137c/e4a3f/JSONP1.png 295w,
/static/0769801184b84dd3e1ae4f60827b137c/fcda8/JSONP1.png 590w,
/static/0769801184b84dd3e1ae4f60827b137c/f941f/JSONP1.png 736w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;cors&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#cors&quot; aria-label=&quot;cors permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;CORS&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;CORS(cross-origin resource share)&lt;/code&gt;规范了跨域请求的标准，通过&lt;code class=&quot;language-text&quot;&gt;HTTP&lt;/code&gt;头让浏览器允许跨域请求的发送，这个话题，我会在下一篇博客细讲。&lt;/p&gt;
&lt;h2 id=&quot;refrence&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#refrence&quot; aria-label=&quot;refrence permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Refrence&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.com/@baphemot/understanding-cors-18ad6b478e2b&quot;&gt;Understanding CORS – Bartosz Szczeciński – Medium&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html&quot;&gt;浏览器同源政策及其规避方法&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.ruanyifeng.com/blog/2016/04/cors.html&quot;&gt;CORS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/MuYunyun/blog/issues/13&quot;&gt;跨域实践二三事&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS&quot;&gt;CORS MDN&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;兴趣遍地都是，坚持和持之以恒才是稀缺的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Promise初探]]></title><description><![CDATA[什么是Promise？ 英文翻译过来是诺言、承诺的意思  顾名思义，的潜在含义是： 代表的是还没发生的事 在事情没有完成之前，无法确定是成功还是失败 而在中的代表的意义是类似的，对于异步操作（网络请求、文件I/O…]]></description><link>http://cuteshilina.com/2019-4-20-Promise/</link><guid isPermaLink="false">http://cuteshilina.com/2019-4-20-Promise/</guid><pubDate>Sat, 20 Apr 2019 17:00:00 GMT</pubDate><content:encoded>&lt;h1 id=&quot;什么是promise？&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BB%80%E4%B9%88%E6%98%AFpromise%EF%BC%9F&quot; aria-label=&quot;什么是promise？ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;什么是Promise？&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;英文翻译过来是诺言、承诺的意思&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 35.810810810810814%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA6ElEQVQoz32R246DMAxE8/9f2SdgWylXQu64Hm9D2Ze1dISj2OOJUSZk+jGFnsyRMpXMlCLUWj8gb5RLv+7+3n9RKSWyxpD2XFQ7tVaZTmOMi5PRxtNjcbTHROgBd3FwHAcpqDrnWaTRf6G1ptfrKU0xRmHfd2GeQwikeu+U+Zl3R3cwGcNQDCAw84lzTgZ67+GwSRGEZ5zneTGF4QyNc8CXLrubO1XYm7FeijEN1uE4gc+eEGHPLJpo9N/9wsAURT54eMosKMUstCwLbdt2WYdrCAPEuq5kreVa7C2KY4jhhfJt/ONCpzcdcSH/CANqFwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;promise 0&quot;
        title=&quot;promise 0&quot;
        src=&quot;/static/95463ff1299e26085f3987868aa50483/fcda8/promise_0.png&quot;
        srcset=&quot;/static/95463ff1299e26085f3987868aa50483/12f09/promise_0.png 148w,
/static/95463ff1299e26085f3987868aa50483/e4a3f/promise_0.png 295w,
/static/95463ff1299e26085f3987868aa50483/fcda8/promise_0.png 590w,
/static/95463ff1299e26085f3987868aa50483/efc66/promise_0.png 885w,
/static/95463ff1299e26085f3987868aa50483/c83ae/promise_0.png 1180w,
/static/95463ff1299e26085f3987868aa50483/4cdc7/promise_0.png 1327w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;顾名思义，&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;的潜在含义是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;代表的是还没发生的事&lt;/li&gt;
&lt;li&gt;在事情没有完成之前，无法确定是成功还是失败&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;而在&lt;code class=&quot;language-text&quot;&gt;Javascript&lt;/code&gt;中的&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;代表的意义是类似的，对于异步操作（网络请求、文件I/O等）这些事情在完成之前无法确定其状态，在完成的时候要么成功要么失败，&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;会在完成的时候通知你。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 22.972972972972975%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuklEQVQY011Pyw7DIAzr///hxPpCrLSU0gI7tL14czQ4DMlySJzEaVJ+wzgP6wOO44BzDuu6YlkWAf/e+8rzPAuX3L7vwsyzr2HTQz2hzQvDMAi6rkPbtjXu+15ipVStjeMorLWWujEGIQQ0KaXvloAUI7ZtE5cEi2Q6KDGZzhjnnKXG/3meKE8G0i6LRRC/w9lM8IwyLP6WUsfLyjJq2MecnEzr1lpM0ySnUXTft2wmruuqKP//PPXkD3nNeIS908obAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;promise 1&quot;
        title=&quot;promise 1&quot;
        src=&quot;/static/c2e993dbc1bbc9041d6b35e9840070d5/fcda8/promise_1.png&quot;
        srcset=&quot;/static/c2e993dbc1bbc9041d6b35e9840070d5/12f09/promise_1.png 148w,
/static/c2e993dbc1bbc9041d6b35e9840070d5/e4a3f/promise_1.png 295w,
/static/c2e993dbc1bbc9041d6b35e9840070d5/fcda8/promise_1.png 590w,
/static/c2e993dbc1bbc9041d6b35e9840070d5/d0c0e/promise_1.png 715w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;上面是&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;的定义，&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;是一个表示异步事件处理完成的对象，我们看看传统的异步操作是怎样的：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;    &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;successCallback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Result is ready: &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;failureCallback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Error on async request: &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;requestData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;options&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; sucessCallback&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; failureCallback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在传统的异步操作下，整个接口的定义实现方式，没有一个清晰的定义，不同的人去写，接口的定义方式不一样。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;    &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;successCallback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Result is ready: &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;failureCallback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Error on async request: &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;requestData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;options&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;successCallback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;failureCallback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;中，抽象出了异步操作成功（then）的接口和失败的接口（catch/reject），并且支持链式调用，在传统的&lt;code class=&quot;language-text&quot;&gt;callback&lt;/code&gt;的实现中，如果下一个异步操作依赖于上一个操作，很容易写出&lt;code class=&quot;language-text&quot;&gt;callback hell&lt;/code&gt;的这种代码，对于代码的阅读和维护带来麻烦。&lt;/p&gt;
&lt;h1 id=&quot;promise的状态&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#promise%E7%9A%84%E7%8A%B6%E6%80%81&quot; aria-label=&quot;promise的状态 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Promise的状态&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;对象对象是一个代理对象，被代理的值表示一个异步操作，在创建的时候，对于最终异步操作的返回结果是未知的，&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;允许为异步操作的成功和失败分别绑定相应的处理方法，让异步方法可以像同步方法一样返回值，但并不是立即返回最终的执行结果，而是一个代理了未来出现的结果的&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;对象，&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;有以下几种状态：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;pending:&lt;/code&gt;初始状态，创建&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;之后，执行还没结束的时候&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;fulfilled：&lt;/code&gt;异步操作成功&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;rejected:&lt;/code&gt;异步操作失败&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 40.54054054054054%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyklEQVQoz4VSiwqEIBD0/3/yiuCqi9LKXvSYc4S1Q6QbWMp1d5xZVdd1geA3Dskvy4JxHLGua7R/1wmUNKWw7zuO40Df92iaBtZaPAlgKCk4zzMkSTTPM6qqRF3XXt22baFO/lNQoqQs3+g6HewNw4C2bfFxykhOdVSqtXYHVd4+Q+p4iFdIQi5YbKcJkwtjjF/neY4se3kykpKA+zJPhowjEKbmxxwJqIaW2cQG2v0HlRpwDFoqisITP11IsPyrLG6gKgne+NOrIL52rnQE5axeCgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;promise 2&quot;
        title=&quot;promise 2&quot;
        src=&quot;/static/cf8c26f621956c651b9653d450816898/fcda8/promise_2.png&quot;
        srcset=&quot;/static/cf8c26f621956c651b9653d450816898/12f09/promise_2.png 148w,
/static/cf8c26f621956c651b9653d450816898/e4a3f/promise_2.png 295w,
/static/cf8c26f621956c651b9653d450816898/fcda8/promise_2.png 590w,
/static/cf8c26f621956c651b9653d450816898/0f2bc/promise_2.png 742w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;如上图，在&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;创建后，所处的状态为&lt;code class=&quot;language-text&quot;&gt;pending&lt;/code&gt;状态，执行成功或失败的这个过程叫&lt;code class=&quot;language-text&quot;&gt;settled&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;settled&lt;/code&gt;之后，&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;由&lt;code class=&quot;language-text&quot;&gt;pending&lt;/code&gt;状态转换到&lt;code class=&quot;language-text&quot;&gt;fulfilled&lt;/code&gt;或&lt;code class=&quot;language-text&quot;&gt;rejected&lt;/code&gt;状态，并执行相应的回调。&lt;/p&gt;
&lt;h1 id=&quot;how-to-use-promise&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#how-to-use-promise&quot; aria-label=&quot;how to use promise permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;How to use Promise?&lt;/h1&gt;
&lt;p&gt;我们首先来看看&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;提供的方法：&lt;/p&gt;
&lt;h2 id=&quot;constructor&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#constructor&quot; aria-label=&quot;constructor permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Constructor&lt;/h2&gt;
&lt;p&gt;常见的方式是通过&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;的构造函数得到Promise的实例：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;    &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;executor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;resolve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; r &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;asyncWork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;success&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;error&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;reject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
     &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; p &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;executor&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;的构造函数接收一个&lt;code class=&quot;language-text&quot;&gt;executor&lt;/code&gt;函数为参数，这个&lt;code class=&quot;language-text&quot;&gt;executor&lt;/code&gt;一般来说是一个异步操作，在生成实例的时候会被执行，在执行成功的时候调用&lt;code class=&quot;language-text&quot;&gt;resolve&lt;/code&gt;，失败的时候调用&lt;code class=&quot;language-text&quot;&gt;reject&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&quot;实例方法&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95&quot; aria-label=&quot;实例方法 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;实例方法&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Promise.prototype.then(onFulfilled?, onRejected?)&lt;/code&gt;，在&lt;code class=&quot;language-text&quot;&gt;promise resolve&lt;/code&gt;的时候&lt;code class=&quot;language-text&quot;&gt;onFulfilled&lt;/code&gt;会被调用，&lt;code class=&quot;language-text&quot;&gt;reject&lt;/code&gt;的时候&lt;code class=&quot;language-text&quot;&gt;onReject&lt;/code&gt;会被调用，这两个参数是可选的，如果你只想对异常进行处理的话，可以使用&lt;code class=&quot;language-text&quot;&gt;promise.then(undefined, onRejected)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Promise.prototype.catch(onRejected)&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;catch&lt;/code&gt;方法会在&lt;code class=&quot;language-text&quot;&gt;promise reject&lt;/code&gt;的时候被调用。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Promise.prototype.finally(onFinally)&lt;/code&gt;，向当前&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;添加一个回调函数，无论当前&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;的状态是完成还是失败都会被调用&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;静态方法&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95&quot; aria-label=&quot;静态方法 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;静态方法&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Promise.resolve(value)&lt;/code&gt;，返回一个由给定&lt;code class=&quot;language-text&quot;&gt;value&lt;/code&gt;决定的&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;对象；如果这个&lt;code class=&quot;language-text&quot;&gt;value&lt;/code&gt;可以是一个&lt;code class=&quot;language-text&quot;&gt;thenable&lt;/code&gt;的对象（带有&lt;code class=&quot;language-text&quot;&gt;then&lt;/code&gt;方法的对象），最终返回的&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;对象的状态由&lt;code class=&quot;language-text&quot;&gt;then&lt;/code&gt;方法执行决定；否则的话，返回的&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;对象状态为&lt;code class=&quot;language-text&quot;&gt;fulfilled&lt;/code&gt;，并且将该值传给对应的&lt;code class=&quot;language-text&quot;&gt;then&lt;/code&gt;方法，如果你不知道一个值是否是&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;对象，使用&lt;code class=&quot;language-text&quot;&gt;Promise.resolve(value)&lt;/code&gt;来返回一个&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;对象，这样就能将该&lt;code class=&quot;language-text&quot;&gt;value&lt;/code&gt;以&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;对象的形式使用。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Promise.reject(reason)&lt;/code&gt;，返回一个执行状态为&lt;code class=&quot;language-text&quot;&gt;rejected&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;Promise&lt;/code&gt;对象，并将错误信息给到对应的处理函数&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Promise.race(iterable)&lt;/code&gt;，当&lt;code class=&quot;language-text&quot;&gt;iterable&lt;/code&gt;中的任意一个子&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;成功或者失败后，父&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;会使用这个子&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;的结果，传给父&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;绑定的回调上&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Promise.all(iterable)&lt;/code&gt;，这个方法返回一个&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;对象，只有&lt;code class=&quot;language-text&quot;&gt;iterable&lt;/code&gt;中所有的&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;执行成功的时候才会触发成功，一旦由任何一个执行失败都会触发要返回这个&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;额失败，最终&lt;code class=&quot;language-text&quot;&gt;iterable&lt;/code&gt;的返回结果和&lt;code class=&quot;language-text&quot;&gt;iterable&lt;/code&gt;的顺序一致。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;是支持链式调用的：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;    Promise&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function-variable function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;resolve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;finally&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;promise的错误处理&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#promise%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86&quot; aria-label=&quot;promise的错误处理 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Promise的错误处理&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;    &lt;span class=&quot;token comment&quot;&gt;// use `catch`&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;resolve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Init&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;error&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// {A}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// {B}&lt;/span&gt;
        console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;123&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Error was caught!&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;End&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    
    &lt;span class=&quot;token comment&quot;&gt;// use reject&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;resolve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Init&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;error&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;End&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Error was caught!&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;在处理错误的时候，可以通过&lt;code class=&quot;language-text&quot;&gt;Promise.ptototype.catch&lt;/code&gt;或者是注册的&lt;code class=&quot;language-text&quot;&gt;reject&lt;/code&gt;方法来处理错误，在&lt;code class=&quot;language-text&quot;&gt;{A}&lt;/code&gt;行处，抛出了错误，这里&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;的状态会变为&lt;code class=&quot;language-text&quot;&gt;rejected&lt;/code&gt;，会调用对应的回调函数，在&lt;code class=&quot;language-text&quot;&gt;{A}&lt;/code&gt;到&lt;code class=&quot;language-text&quot;&gt;.catch&lt;/code&gt;之间的&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;链会被打断。&lt;/p&gt;
&lt;h1 id=&quot;wraaper-by-promise&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#wraaper-by-promise&quot; aria-label=&quot;wraaper by promise permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Wraaper by Promise&lt;/h1&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;    &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;ms&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;resolve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;resolve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ms&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;我们在使用&lt;code class=&quot;language-text&quot;&gt;setTimeout&lt;/code&gt;的时候，&lt;code class=&quot;language-text&quot;&gt;setTimeout&lt;/code&gt;执行的函数如果执行发生了错误，并且在函数的实现中并没有做&lt;code class=&quot;language-text&quot;&gt;Error Handling&lt;/code&gt;，函数执行发生错误的时机我们并不知道，如果使用上面基于&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;包裹之后的&lt;code class=&quot;language-text&quot;&gt;timeout&lt;/code&gt;，我们是可以明确知道错误发生的时机的。&lt;/p&gt;
&lt;h2 id=&quot;超时promise&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%B6%85%E6%97%B6promise&quot; aria-label=&quot;超时promise permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;超时Promise&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;创建之后，会等待异步操作的执行，如果异步操作的时间很长的话，这个&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;一直处于  &lt;code class=&quot;language-text&quot;&gt;pending&lt;/code&gt;状态，对于用户来说，页面会一直停留在&lt;code class=&quot;language-text&quot;&gt;loading&lt;/code&gt;的状态，显然，用户体验并不好，因此，对于这种情况，我们需要提供可以在超时之后，取消&lt;code class=&quot;language-text&quot;&gt;promsie&lt;/code&gt;的机制：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;    &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;delayPromise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;ms&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ms&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Operation is timeout!&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; timeoutPromise &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;asyncFn&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ms&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; Promise&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;race&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;asyncFn&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;delayPromise&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ms&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上我们基于&lt;code class=&quot;language-text&quot;&gt;Promise.race&lt;/code&gt;实现了超时&lt;code class=&quot;language-text&quot;&gt;promise&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&quot;refrence&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#refrence&quot; aria-label=&quot;refrence permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Refrence&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://liubin.org/promises-book/&quot;&gt;Promise迷你书&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise&quot;&gt;Promise&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;兴趣遍地都是，坚持和持之以恒才是稀缺的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[前端路由]]></title><description><![CDATA[什么是路由？ 路由最一开始是在后端中出现的，我们在访问某些网站的时候经常会见到类似于这样的:
 或者 ，这就是（Server Side Render…]]></description><link>http://cuteshilina.com/2019-4-13-frontend-route/</link><guid isPermaLink="false">http://cuteshilina.com/2019-4-13-frontend-route/</guid><pubDate>Sat, 13 Apr 2019 17:00:00 GMT</pubDate><content:encoded>&lt;h2 id=&quot;什么是路由？&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BB%80%E4%B9%88%E6%98%AF%E8%B7%AF%E7%94%B1%EF%BC%9F&quot; aria-label=&quot;什么是路由？ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;什么是路由？&lt;/h2&gt;
&lt;p&gt;路由最一开始是在后端中出现的，我们在访问某些网站的时候经常会见到类似于这样的&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;:
&lt;code class=&quot;language-text&quot;&gt;http://www.xxx.com/xxx.php&lt;/code&gt; 或者 &lt;code class=&quot;language-text&quot;&gt;http://www.xxx.com/xxx.html&lt;/code&gt;，这就是&lt;code class=&quot;language-text&quot;&gt;SSR&lt;/code&gt;（Server Side Render）服务端渲染，通过后端直接渲染前端页面。这里客户端会发向服务端发请求，服务端解析&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;，根据&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;将需要的资源返回给前端，路由其实就是前端和服务端的一种交互方式，相当于服务端针对于&lt;code class=&quot;language-text&quot;&gt;不同url&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;switch case&lt;/code&gt;，每一类&lt;code class=&quot;language-text&quot;&gt;case&lt;/code&gt;对应一个&lt;code class=&quot;language-text&quot;&gt;controller&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&quot;前端路由&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1&quot; aria-label=&quot;前端路由 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;前端路由&lt;/h2&gt;
&lt;p&gt;上面介绍了传统意义上的路由，用户在页面上点击的时候触发页面请求，服务端将对应的页面返回回来，这样存在一个问题是，整个页面会重新加载，会产生无意义的白屏页面，用户体验不好。在用户点击访问网站或者&lt;code class=&quot;language-text&quot;&gt;Web App&lt;/code&gt;上的另一个页面的时候，这个时候我们可能仅仅需要的是更新部分视图就可以了，而没有必要去重新加载整个页面，避免无意义的白屏；这个时候前端路由就出现了，页面的跳转和渲染放在前端，后端提供&lt;code class=&quot;language-text&quot;&gt;API&lt;/code&gt;获取数据即可。&lt;/p&gt;
&lt;h2 id=&quot;前端路由的实现原理&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86&quot; aria-label=&quot;前端路由的实现原理 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;前端路由的实现原理&lt;/h2&gt;
&lt;p&gt;对于前端路由有两种实现方式，一种是通过&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Window/hashchange_event&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;hashchanged&lt;/code&gt;&lt;/a&gt;；另一种是使用&lt;code class=&quot;language-text&quot;&gt;HTML5&lt;/code&gt;提供的&lt;code class=&quot;language-text&quot;&gt;history api&lt;/code&gt;来做前端路由的处理。
对于&lt;code class=&quot;language-text&quot;&gt;hasnchange&lt;/code&gt;的实现方式，我们需要监听&lt;code class=&quot;language-text&quot;&gt;hashchange&lt;/code&gt;事件，在浏览器的&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;中改变&lt;code class=&quot;language-text&quot;&gt;hash&lt;/code&gt;不会导致页面发请求，我们在&lt;code class=&quot;language-text&quot;&gt;hashchange&lt;/code&gt;的事件回调中处理页面中&lt;code class=&quot;language-text&quot;&gt;DOM&lt;/code&gt;的刷新。
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 280px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 199.32432432432435%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAoABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAIBAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAH3cqSwRPSSwZgUD//EABcQAAMBAAAAAAAAAAAAAAAAAAAQEQH/2gAIAQEAAQUCKqYt0rxQi//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BX//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BX//EABQQAQAAAAAAAAAAAAAAAAAAADD/2gAIAQEABj8Cf//EABwQAQACAwADAAAAAAAAAAAAAAEQEQAxQSFRYf/aAAgBAQABPyFUeZb5DTFR7gB84HTuGr7lA6Q2Z//aAAwDAQACAAMAAAAQk8g8A8//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EF//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EF//xAAdEAEAAgMBAAMAAAAAAAAAAAABESEAEDFBUZHh/9oACAEBAAE/EIwUj3K50mNEEXOKhSJevPrRcDZ2YzjFk1Lr5AY8wNKJaiNXFciycCCEX7H7r//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;hashchange&quot;
        title=&quot;hashchange&quot;
        src=&quot;/static/15f95df1eb76710ab08f96cd4d6fc111/9014f/19-4-13-03.jpg&quot;
        srcset=&quot;/static/15f95df1eb76710ab08f96cd4d6fc111/a80bd/19-4-13-03.jpg 148w,
/static/15f95df1eb76710ab08f96cd4d6fc111/9014f/19-4-13-03.jpg 280w&quot;
        sizes=&quot;(max-width: 280px) 100vw, 280px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
在&lt;code class=&quot;language-text&quot;&gt;html5&lt;/code&gt;推出&lt;code class=&quot;language-text&quot;&gt;pushstate&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;replacestate&lt;/code&gt;之后，就可以通过这两个&lt;code class=&quot;language-text&quot;&gt;api&lt;/code&gt;来改变&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;并且不发请求，而且相比于使用&lt;code class=&quot;language-text&quot;&gt;hash&lt;/code&gt;，页面的&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;更加美观，但是通过&lt;code class=&quot;language-text&quot;&gt;pushstate&lt;/code&gt;方式改变了&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;，如果这个时候刷新了页面，服务端会收到请求，这个时候后端没有对应的&lt;code class=&quot;language-text&quot;&gt;controller&lt;/code&gt;来处理，所以在&lt;code class=&quot;language-text&quot;&gt;pushstate&lt;/code&gt;的实现方式下，后端最好对于没有路由的&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;直接返回到主页面。&lt;/p&gt;
&lt;h2 id=&quot;如何实现一个简单的前端路由&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1&quot; aria-label=&quot;如何实现一个简单的前端路由 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;如何实现一个简单的前端路由&lt;/h2&gt;
&lt;p&gt;这里我们来尝试实现一个简单的前端路由，主要的思想就是侦测&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;的变化，解析&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;，调用&lt;code class=&quot;language-text&quot;&gt;handler&lt;/code&gt;，整个路由是一个单例。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; Route &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    routes&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token function-variable function&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;root &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; options&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;root &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;options&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mode &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;history&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; history&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pushState &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;function&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mode &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;history&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mode &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;hash&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;基于浏览器的两种实现方式，我们实现路由的时候，提供&lt;code class=&quot;language-text&quot;&gt;mode&lt;/code&gt;的设置，默认是’hash’的实现，这里我们配置了根路径，这里主要是处理在&lt;code class=&quot;language-text&quot;&gt;pushstate&lt;/code&gt;的实现中，&lt;code class=&quot;language-text&quot;&gt;pushstate&lt;/code&gt;导致无法获取到&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;改变的部分的问题：
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 45.27027027027027%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACRklEQVQoz22S30tTcRjG9w8FkfbDtExXSyrDSTdKkFIQURRRV0XBmjPzB2lmYUGRiVd2EV0FEXShLs0sNal06ja3OT3bznbcztl2zvfTd0eMLnrhhfcLz/vwPM/3deRyOdLpDMlkilAoTGgtQnBpid+fPrI4MUZs9hupXwtkQ6ts5XSyEp/TdXTDwMjnyReKFIomArCEwBGNRAgsLzM7N8f3uXkmJr8wPT3N7MwM/vFx+nr78Hjuyfbi9bXj8frwtrXT3tFJR2cXXT0PedQ/wMDTQV6+eo0juLoi1qNRlPi6UJSUWA5vsr6ZFJqWEfM/FjjbcoFq10nqTjVQffQENXKurDlG2f4qyg5UsXvvQSoOO7fn8gocysI8G0uLQo2sYWZUTCUuCgVpxchjSFsrgQCjI8N0d/cz9uEdLwaf8PbNKLFYjLCMJxKJEixFFV4jIoU51JWAUEJBEvG4pelGvqimQMg0ZMlYyGyEaT19hAZXLe+HHnDOfZzmRjeFXJasmsCU+ck1dN0owXFo8ZgoBW2ZZomhaEmVwrKEKd8lwOcJP7XluxjqusRwzzWetV1kpPcWajKBIUn/LcuycFhJBXJZIbQMlpZGEtriJKENmvT7aa2vwnP5DL6brXivNHL/xnm2JD6qaIQ3dVTNsMnsXxYlZcUiwiwKu7ed/lX4dWqKZuc+ml2V1B/aQ5OzjCa3GzWhkJHnllC3UNOaTWhb5j9VIt0BrAZ+8txXx+jjFm5fvY6z2oXv7h2KWR3TKMhbNGw3Ozt/ABNuWamfL4NqAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;19 4 13 01&quot;
        title=&quot;19 4 13 01&quot;
        src=&quot;/static/487982939f4d4a1da2be3314e0d2bb19/fcda8/19-4-13-01.png&quot;
        srcset=&quot;/static/487982939f4d4a1da2be3314e0d2bb19/12f09/19-4-13-01.png 148w,
/static/487982939f4d4a1da2be3314e0d2bb19/e4a3f/19-4-13-01.png 295w,
/static/487982939f4d4a1da2be3314e0d2bb19/fcda8/19-4-13-01.png 590w,
/static/487982939f4d4a1da2be3314e0d2bb19/efc66/19-4-13-01.png 885w,
/static/487982939f4d4a1da2be3314e0d2bb19/3a737/19-4-13-01.png 897w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 43.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACKklEQVQoz12Ry08TURSH509x59aF0cSwA8GW8lB8REtKQ2uwgtQocUFiImpcKivUaKIJUeLChI1KG0KLFKVYCkZ8BbWGl6W1nXY6M2XaTj9vqzWEk3y5J+fc/O7vnCvNz88TDAYJCHx+PxO+CXw+P5NjT5h8Nkb41QsW/BO8n5okGo0SXVxkURDdwcK/eiSygDQXDhOana0KTs+EeOkPEHgd4l0kwpu3c3h6+7G1HeVIcysWWxuNlmYON1lpsrZUabTYaG79268gJTbW2VpfI5f6jaFqpFMK2ZSMmk6R3Nxg8OoQLk8/fd5LdPf00dPr5aznAmcc3di7ujnd6cTpPken043d4ULKxL6T+PqF5M8YupzGVBVBjqKgJESLapbx0Ydc7L9CZGqcO7euMTI8TCVKZql6mqZJuVyu5pKW2EKOx1FSKVQ9Ly6JpmhU24UCidUfnGqqw3W8gecjgwy4OrC3W9BzWbLJONv5PKqYTNU0DMNAkn9tshkXonKGXE44KxYp5hQMAaUCH5eWaK+v48FNN/dueLh/3cXY7csoioIuxHaHtJ1MYGTSlJQsphCpURIOyGt8Xl7Gc9LCgMOGt6udofPH8Do60HWN1XiaWFwjKav/x5aqw4mkXCnswBROK/FtZYW+E4dwt+yn8cA+Du7dg7W+gW1NR8tk0PK6ENcxazus7au8y3ptybKc5VP4LmsfRpmbnuHxo6eEglOVH6FoFCiIhyvuavwBbCRQrePPVuUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;19 4 13 02&quot;
        title=&quot;19 4 13 02&quot;
        src=&quot;/static/cbd7e68982d64c999ed4d762a4754a85/fcda8/19-4-13-02.png&quot;
        srcset=&quot;/static/cbd7e68982d64c999ed4d762a4754a85/12f09/19-4-13-02.png 148w,
/static/cbd7e68982d64c999ed4d762a4754a85/e4a3f/19-4-13-02.png 295w,
/static/cbd7e68982d64c999ed4d762a4754a85/fcda8/19-4-13-02.png 590w,
/static/cbd7e68982d64c999ed4d762a4754a85/efc66/19-4-13-02.png 885w,
/static/cbd7e68982d64c999ed4d762a4754a85/078fe/19-4-13-02.png 934w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
如上图，我们原本的页面在&lt;code class=&quot;language-text&quot;&gt;https://github.com&lt;/code&gt;下，在第一次&lt;code class=&quot;language-text&quot;&gt;pushstate&lt;/code&gt;的时候，没有问题，但是在第二次&lt;code class=&quot;language-text&quot;&gt;pushstate&lt;/code&gt;的时候，和我们期待的&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;并不符合，这会导致的问题是，我们在解析&lt;code class=&quot;language-text&quot;&gt;url change&lt;/code&gt;的部分的时候，会得到错误的结果，所以这里我们指定好根目录，在解析的时候将&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;中根路径剔除掉。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;  &lt;span class=&quot;token function-variable function&quot;&gt;getFragement&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; fragement &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mode &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;history&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      fragement &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; location&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pathname &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; location&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;search&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      fragement &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;clearSlash&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fragement&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      fragement &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; fragement&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/\?(.*)$/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// replace the query string&lt;/span&gt;
      fragement &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;root &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;/&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; fragement&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;root&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; fragement&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      fragement &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; location&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hash&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;slice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; fragement&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面的代码就是去解析出’url’改变的部分；在&lt;code class=&quot;language-text&quot;&gt;pushstate&lt;/code&gt;的实现中，存在一个问题是，我们在&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;跳转的时候，是调用&lt;code class=&quot;language-text&quot;&gt;pushstate&lt;/code&gt;来改变&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;，但是这并不能触发&lt;code class=&quot;language-text&quot;&gt;popstate&lt;/code&gt;的事件，所以这里我们需要去&lt;code class=&quot;language-text&quot;&gt;listen url&lt;/code&gt;的变化：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;  &lt;span class=&quot;token function-variable function&quot;&gt;startTimer&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;fn&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ms&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; self &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;internalFn&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;internalFn&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ms&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;timer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;internalFn&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ms&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token function-variable function&quot;&gt;listen&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; current &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getFragement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; self &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getFragement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        current &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getFragement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;check&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;startTimer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fn&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;完整的代码实现请查看： &lt;a href=&quot;https://github.com/Soyn/FERoute&quot;&gt;FERoute&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;refrence&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#refrence&quot; aria-label=&quot;refrence permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Refrence&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.zhihu.com/question/53064386&quot;&gt;https://www.zhihu.com/question/53064386&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://juejin.im/post/5b40c1ede51d4518f140f84b&quot;&gt;https://juejin.im/post/5b40c1ede51d4518f140f84b&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.zhihu.com/question/63586494&quot;&gt;前端管理路由相比后端有什么优势？ - 知乎&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://krasimirtsonev.com/blog/article/deep-dive-into-client-side-routing-navigo-pushstate-hash&quot;&gt;http://krasimirtsonev.com/blog/article/deep-dive-into-client-side-routing-navigo-pushstate-hash&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/SME-FE/sme-router&quot;&gt;GitHub - SME-FE/sme-router: A lightweight router lib that implement with express route style&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/History_API&quot;&gt;https://developer.mozilla.org/en-US/docs/Web/API/History_API&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/krasimir/navigo&quot;&gt;GitHub - krasimir/navigo: A simple vanilla JavaScript router with a fallback for older browsers&lt;/a&gt;
&lt;a href=&quot;https://medium.com/@wilbo/server-side-vs-client-side-routing-71d710e9227f&quot;&gt;Server-side vs Client-side Routing – Wilbert Schepenaar – Medium&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;兴趣遍地都是，坚持和持之以恒才是稀缺的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[实现一个前端状态管理库]]></title><description><![CDATA[在前端开发中，如何对前端状态的管理是一个需要面对的问题，前端主要是数据展示和界面交互，交互的存在就会导致数据的变化，数据的变化会影响页面的展示，也就是说，一个完整的前端状态管理，要提供数据的存储、更新、数据变化的通知机制。这篇文章，我们来了解一下如何从0到…]]></description><link>http://cuteshilina.com/2019-3-23-StateManager/</link><guid isPermaLink="false">http://cuteshilina.com/2019-3-23-StateManager/</guid><pubDate>Sat, 23 Mar 2019 17:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在前端开发中，如何对前端状态的管理是一个需要面对的问题，前端主要是数据展示和界面交互，&lt;strong&gt;&lt;em&gt;交互的存在就会导致数据的变化，数据的变化会影响页面的展示&lt;/em&gt;&lt;/strong&gt;，也就是说，一个完整的前端状态管理，要提供数据的存储、更新、数据变化的通知机制。这篇文章，我们来了解一下如何从0到1，如何实现前端数据的管理。&lt;/p&gt;
&lt;h2 id=&quot;发布订阅&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85&quot; aria-label=&quot;发布订阅 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;发布订阅&lt;/h2&gt;
&lt;p&gt;首先我们需要一个机制在数据更新的时候，用到这份数据的部分能够知道数据更新了，这样才能保证页面的同步；这里我们需要实现一个&lt;a href=&quot;https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern&quot;&gt;Publish/Subscribe&lt;/a&gt;，在数据更新的时候发布&lt;code class=&quot;language-text&quot;&gt;stateChanged&lt;/code&gt;的事件，所有订阅了&lt;code class=&quot;language-text&quot;&gt;stateChange&lt;/code&gt;的组件会调用注册的回调函数来获取更新后的数据。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ------pubSub.js------&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;PubSub&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;listeners &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;publish&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;event&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; currentEventListeners &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;listeners&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;currentEventListeners&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      currentEventListeners&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;listener&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;listener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; 
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  
  &lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;event&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; callback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; callback &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;function&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;callback is not a function!&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;listeners&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;listeners&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;listeners&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;callback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，就是一个发布／订阅的简单实现，&lt;code class=&quot;language-text&quot;&gt;listeners&lt;/code&gt;中会维护所有注册的回调函数，在&lt;code class=&quot;language-text&quot;&gt;subscribe&lt;/code&gt;的时候会以事件名为&lt;code class=&quot;language-text&quot;&gt;key&lt;/code&gt;，回调函数为&lt;code class=&quot;language-text&quot;&gt;value&lt;/code&gt;，放入&lt;code class=&quot;language-text&quot;&gt;listeners&lt;/code&gt;中，&lt;code class=&quot;language-text&quot;&gt;publish&lt;/code&gt;事件的时候，会调用注册到当前这个事件所有的回调函数。&lt;code class=&quot;language-text&quot;&gt;发布／订阅&lt;/code&gt;模式是很常见的消息传递机制，好处是模块与模块之间解耦，订阅者和发布者对于彼此是透明的。&lt;/p&gt;
&lt;h2 id=&quot;如何侦测数据变更&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A6%82%E4%BD%95%E4%BE%A6%E6%B5%8B%E6%95%B0%E6%8D%AE%E5%8F%98%E6%9B%B4&quot; aria-label=&quot;如何侦测数据变更 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;如何侦测数据变更&lt;/h2&gt;
&lt;p&gt;有了发布／订阅之后，我们就需要知道数据变更的时机，这里我们使用&lt;code class=&quot;language-text&quot;&gt;ES6&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;Proxy&lt;/code&gt;来检测数据的变化。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// --- store.js---&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Proxy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;params&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function-variable function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    state&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;events&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;publish&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;stateChanged&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;status &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; Status&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Mutating&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;warn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;You Should Mutate Your State By Action!&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;status &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Status&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Resting&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;中的&lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;是一个&lt;code class=&quot;language-text&quot;&gt;Proxy&lt;/code&gt;，我们在&lt;code class=&quot;language-text&quot;&gt;set&lt;/code&gt;数据的时候，会发布&lt;code class=&quot;language-text&quot;&gt;stateChanged&lt;/code&gt;的事件，所有订阅了&lt;code class=&quot;language-text&quot;&gt;stateChanged&lt;/code&gt;的回调都会被调用。&lt;/p&gt;
&lt;h2 id=&quot;如何变更数据&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A6%82%E4%BD%95%E5%8F%98%E6%9B%B4%E6%95%B0%E6%8D%AE&quot; aria-label=&quot;如何变更数据 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;如何变更数据&lt;/h2&gt;
&lt;p&gt;类似于&lt;code class=&quot;language-text&quot;&gt;redux&lt;/code&gt;，我们需要设计一套去变更数据的模式，在创建&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;的时候，将我们对数据的加工操作（类似于&lt;code class=&quot;language-text&quot;&gt;redux&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;reducer&lt;/code&gt;注册进去），在需要修改数据的时候，&lt;code class=&quot;language-text&quot;&gt;dispatch&lt;/code&gt;对应的&lt;code class=&quot;language-text&quot;&gt;action&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Store&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;events &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;PubSub&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;params&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasOwnProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;mutations&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// {A}&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mutations &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; params&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mutations&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;commit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;mutationType&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; payload&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;status &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Status&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Mutating&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mutations&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;mutationType&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;function&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mutations&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;mutationType&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; payload&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;actionType&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; payload&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isPlainObject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;payload&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Payload Must Be A Plain Object!&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;status &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; Status&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Mutating&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Can Not Dispatch Action In Mutation Function!&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;commit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;actionType&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; payload&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// {B}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;getState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在创建&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;的时候，我们将修改&lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;的操作&lt;code class=&quot;language-text&quot;&gt;mutations&lt;/code&gt;注入进去(&lt;code class=&quot;language-text&quot;&gt;{A}&lt;/code&gt;行代码)，在&lt;code class=&quot;language-text&quot;&gt;dispatch&lt;/code&gt;的时候，根据&lt;code class=&quot;language-text&quot;&gt;dispatch&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;action&lt;/code&gt;的类型去调用对应的&lt;code class=&quot;language-text&quot;&gt;mutation&lt;/code&gt;来更改&lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;mutation&lt;/code&gt;会触发&lt;code class=&quot;language-text&quot;&gt;stateChanged&lt;/code&gt;的事件，这样所有订阅了&lt;code class=&quot;language-text&quot;&gt;stateChanged&lt;/code&gt;事件的组件会刷新；所以我们可以提供一个基础组件，这个组件要做的事就是订阅&lt;code class=&quot;language-text&quot;&gt;stateChanged&lt;/code&gt;事件，事件发生之后就重新渲染：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;store &lt;span class=&quot;token keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Store&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;store &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;store&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;store&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;events&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;stateChanged&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasOwnProperty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;element&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;element &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;element&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，其他的组件从这个组件上继承的时候，就会自动订阅&lt;code class=&quot;language-text&quot;&gt;stateChanged&lt;/code&gt;的事件，完整的代码实现在这里：&lt;a href=&quot;https://github.com/Soyn/tinyStateManager&quot;&gt;tinyStateManager&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;h2 id=&quot;build-a-state-management-system-with-vanilla-javascript&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#build-a-state-management-system-with-vanilla-javascript&quot; aria-label=&quot;build a state management system with vanilla javascript permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://css-tricks.com/build-a-state-management-system-with-vanilla-javascript/&quot;&gt;Build a state management system with vanilla JavaScript&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;兴趣遍地都是，坚持和持之以恒才是稀缺的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[ES6 Module]]></title><description><![CDATA[在ES6之前，并没有官方标准的模块化方案，在社区中就出现了和这两种方案，前者主要用于服务端，后者用在浏览器端，为了统一写法，又出现了的标准，在中，终于有了官方标准的模块化方案，这篇博客我们就来看看的模块化方案。 Overview…]]></description><link>http://cuteshilina.com/2019-3-16-ESModule/</link><guid isPermaLink="false">http://cuteshilina.com/2019-3-16-ESModule/</guid><pubDate>Sat, 16 Mar 2019 17:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在ES6之前，&lt;code class=&quot;language-text&quot;&gt;Javascript&lt;/code&gt;并没有官方标准的模块化方案，在社区中就出现了&lt;code class=&quot;language-text&quot;&gt;Common.js&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;AMD&lt;/code&gt;这两种方案，前者主要用于服务端，后者用在浏览器端，为了统一写法，又出现了&lt;code class=&quot;language-text&quot;&gt;UMD&lt;/code&gt;的标准，在&lt;code class=&quot;language-text&quot;&gt;ES6&lt;/code&gt;中，&lt;code class=&quot;language-text&quot;&gt;Javascript&lt;/code&gt;终于有了官方标准的模块化方案，这篇博客我们就来看看&lt;code class=&quot;language-text&quot;&gt;ES6&lt;/code&gt;的模块化方案。&lt;/p&gt;
&lt;h1 id=&quot;overview&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#overview&quot; aria-label=&quot;overview permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Overview&lt;/h1&gt;
&lt;h2 id=&quot;定义和使用模块&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%9A%E4%B9%89%E5%92%8C%E4%BD%BF%E7%94%A8%E6%A8%A1%E5%9D%97&quot; aria-label=&quot;定义和使用模块 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;定义和使用模块&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ------lib.js-----&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;foo in lib.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; 
    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;bar in lib.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// ------main.js-----&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; foo &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./lib.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; bar &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./lib.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，是&lt;code class=&quot;language-text&quot;&gt;ES6&lt;/code&gt;中&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;的用法，这里有两个保留字&lt;code class=&quot;language-text&quot;&gt;import&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;export&lt;/code&gt;，从上面的代码中，我们可以发现，对于不同的&lt;code class=&quot;language-text&quot;&gt;export&lt;/code&gt;方式，对应的&lt;code class=&quot;language-text&quot;&gt;import&lt;/code&gt;的方式也不一样。&lt;/p&gt;
&lt;h2 id=&quot;name-export&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#name-export&quot; aria-label=&quot;name export permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Name Export&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ------lib.js-----&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，就是&lt;code class=&quot;language-text&quot;&gt;name export&lt;/code&gt;的写法，每一个函数或者变量，直接被&lt;code class=&quot;language-text&quot;&gt;export&lt;/code&gt;，这种每写一个函数或者变量就&lt;code class=&quot;language-text&quot;&gt;export&lt;/code&gt;的方式也叫做&lt;code class=&quot;language-text&quot;&gt;inline export&lt;/code&gt;，如果在一个&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;中有很多需要&lt;code class=&quot;language-text&quot;&gt;export&lt;/code&gt;的东西，这种写法就有些累赘了，这时候可以写成这样：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ------lib.js------&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    foo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    bar&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    a
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在&lt;code class=&quot;language-text&quot;&gt;ES6 Module&lt;/code&gt;中，有&lt;code class=&quot;language-text&quot;&gt;local name&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;export name&lt;/code&gt;的概念，顾名思义&lt;code class=&quot;language-text&quot;&gt;local name&lt;/code&gt;就是在&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;中的名字，&lt;code class=&quot;language-text&quot;&gt;export name&lt;/code&gt;就是模块暴露给外界的名字。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ------lib.js------&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// {A}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; 
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    foo &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; bar&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// {B}&lt;/span&gt;
    bar &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; foo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    a &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在上面的代码中，&lt;code class=&quot;language-text&quot;&gt;{A}&lt;/code&gt;行的&lt;code class=&quot;language-text&quot;&gt;foo&lt;/code&gt;是&lt;code class=&quot;language-text&quot;&gt;local name&lt;/code&gt;，在&lt;code class=&quot;language-text&quot;&gt;{B}&lt;/code&gt;行的&lt;code class=&quot;language-text&quot;&gt;bar&lt;/code&gt;是&lt;code class=&quot;language-text&quot;&gt;export name&lt;/code&gt;，同样的我们在&lt;code class=&quot;language-text&quot;&gt;import&lt;/code&gt;的时候也可以使用别名。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ------lib.js------&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// ------main.js------&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; foo &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; bar &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./lib.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;default-export&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#default-export&quot; aria-label=&quot;default export permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Default Export&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ------lib.js------&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// ------main.js------&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; foo &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;lib.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，我们&lt;code class=&quot;language-text&quot;&gt;import&lt;/code&gt;了一个&lt;code class=&quot;language-text&quot;&gt;default&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;export&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;default export&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;name export&lt;/code&gt;在&lt;code class=&quot;language-text&quot;&gt;import&lt;/code&gt;的时候，&lt;code class=&quot;language-text&quot;&gt;name export&lt;/code&gt;需要加大括号，而&lt;code class=&quot;language-text&quot;&gt;default export&lt;/code&gt;则不需要。&lt;/p&gt;
&lt;h2 id=&quot;转发export&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%BD%AC%E5%8F%91export&quot; aria-label=&quot;转发export permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;转发export&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ------lib.js------&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;foo in lib.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;bar in lib.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  foo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  bar&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// ------middleLib.js------&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; foo &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; bar&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; bar &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; foo &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./lib&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// ------main.js------&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; foo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; bar &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./middleLib&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上我们将模块&lt;code class=&quot;language-text&quot;&gt;lib.js&lt;/code&gt;中暴露的&lt;code class=&quot;language-text&quot;&gt;export&lt;/code&gt;通过另一个模块暴露出去了，这种常见的用法是，在封装好一个大的模块后，这个大的模块只需要向外界暴露部分小模块的&lt;code class=&quot;language-text&quot;&gt;API&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; module
  &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;js
  &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;js
  &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt; index&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;js&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，在&lt;code class=&quot;language-text&quot;&gt;module&lt;/code&gt;这个&lt;code class=&quot;language-text&quot;&gt;folder&lt;/code&gt;下我们有&lt;code class=&quot;language-text&quot;&gt;a.js, b.js, index.js&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;a.js和b.js&lt;/code&gt;是一些功能的实现，我们将&lt;code class=&quot;language-text&quot;&gt;a.js, b.js&lt;/code&gt;中需要向外界暴露的&lt;code class=&quot;language-text&quot;&gt;API&lt;/code&gt;通过&lt;code class=&quot;language-text&quot;&gt;index.js&lt;/code&gt;转发。&lt;/p&gt;
&lt;h1 id=&quot;es6-module-under-hood&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#es6-module-under-hood&quot; aria-label=&quot;es6 module under hood permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ES6 Module Under Hood&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ES6&lt;/code&gt;给我们提供了很简洁的语法去使用模块，但是&lt;code class=&quot;language-text&quot;&gt;ES Module&lt;/code&gt;简洁的外表下，背后的细节仍然值得我们注意。&lt;/p&gt;
&lt;h2 id=&quot;es-module是静态的&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#es-module%E6%98%AF%E9%9D%99%E6%80%81%E7%9A%84&quot; aria-label=&quot;es module是静态的 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ES Module是静态的&lt;/h2&gt;
&lt;p&gt;如何理解&lt;code class=&quot;language-text&quot;&gt;ES Module&lt;/code&gt;是静态的这句话呢？意思就是，&lt;code class=&quot;language-text&quot;&gt;ES Module&lt;/code&gt;不同于&lt;code class=&quot;language-text&quot;&gt;Common.js&lt;/code&gt;这种模块化方案，只有在运行时才可以确定依赖的模块，在源码中看到的依赖关系就是运行时的依赖。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;//------commonJSModule.js------&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exports &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 foo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
 bar&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//------main.js------&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;something&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; foo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./commonJSModule.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;foo&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; foo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./commonJSModule.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bar&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，在&lt;code class=&quot;language-text&quot;&gt;CommonJS&lt;/code&gt;中这中动态的在运行时决定依赖的方式在&lt;code class=&quot;language-text&quot;&gt;ES Module&lt;/code&gt;中是行不通的（但是有提案在做运行时的&lt;code class=&quot;language-text&quot;&gt;loader&lt;/code&gt; —&gt; &lt;a href=&quot;https://github.com/whatwg/loader/%EF%BC%89%E3%80%82&quot;&gt;https://github.com/whatwg/loader/）。&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;es-module的变量提升&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#es-module%E7%9A%84%E5%8F%98%E9%87%8F%E6%8F%90%E5%8D%87&quot; aria-label=&quot;es module的变量提升 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ES Module的变量提升&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ------lib.js------&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;foo in lib.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;bar in lib.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  foo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  bar&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// ------main.js------&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; foo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; bar &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./lib&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，我们可以先调用&lt;code class=&quot;language-text&quot;&gt;export&lt;/code&gt;的函数，在调用之后再&lt;code class=&quot;language-text&quot;&gt;import&lt;/code&gt;，这个在编译的时候会将&lt;code class=&quot;language-text&quot;&gt;import&lt;/code&gt;提升到顶层，但是在实际开发的过程中，虽然可以这样，但是这并不是好的代码风格。&lt;/p&gt;
&lt;h2 id=&quot;es-module是只读的&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#es-module%E6%98%AF%E5%8F%AA%E8%AF%BB%E7%9A%84&quot; aria-label=&quot;es module是只读的 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ES Module是只读的&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ------commonJSModule.js------&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exports &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    foo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// ------main.js------&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./lib.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 1&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./lib.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面的代码在&lt;code class=&quot;language-text&quot;&gt;CommonJS&lt;/code&gt;下，我们可以修改&lt;code class=&quot;language-text&quot;&gt;require&lt;/code&gt;的东西，因为在&lt;code class=&quot;language-text&quot;&gt;commonJS&lt;/code&gt;中是拷贝一份，但是在&lt;code class=&quot;language-text&quot;&gt;ES Module&lt;/code&gt;中，我们无法修改&lt;code class=&quot;language-text&quot;&gt;import&lt;/code&gt;的东西，&lt;code class=&quot;language-text&quot;&gt;import&lt;/code&gt;的模块在行为上类似于&lt;code class=&quot;language-text&quot;&gt;const&lt;/code&gt;变量和&lt;code class=&quot;language-text&quot;&gt;frozen object&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ------lib.js------&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;foo in lib.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;bar in lib.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  foo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  bar&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// ------main.js------&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; foo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; bar&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; a &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./lib&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
foo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// works {A}&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// error {B}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;es-module静态结构的设计带来的益处&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#es-module%E9%9D%99%E6%80%81%E7%BB%93%E6%9E%84%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%B8%A6%E6%9D%A5%E7%9A%84%E7%9B%8A%E5%A4%84&quot; aria-label=&quot;es module静态结构的设计带来的益处 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ES Module静态结构的设计带来的益处&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ES Module&lt;/code&gt;的静态结构的设计特点，让代码在编译的时候就能确定依赖关系，不同于运行时，只有代码跑起来的时候很多东西才能确定，就好比，你计划完成一项复杂的项目，静态的结构能保证你在做之前，你确定的事是不会变的，而不是只要等到在项目进行中去确定，面对可预测的问题，我们是好解决的。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;有助于在代码打包的时候做 &lt;code class=&quot;language-text&quot;&gt;dead code elimination&lt;/code&gt;，减小&lt;code class=&quot;language-text&quot;&gt;bundle&lt;/code&gt;文件的大小（&lt;code class=&quot;language-text&quot;&gt;RollUp&lt;/code&gt;基于&lt;code class=&quot;language-text&quot;&gt;ES Module&lt;/code&gt;实现了&lt;code class=&quot;language-text&quot;&gt;tree shaking&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;静态的结构有助于&lt;code class=&quot;language-text&quot;&gt;lint&lt;/code&gt;工具的检测&lt;/li&gt;
&lt;li&gt;为&lt;code class=&quot;language-text&quot;&gt;javascript&lt;/code&gt;支持宏做准备（宏操作需要静态的结构 —&gt; &lt;a href=&quot;https://www.sweetjs.org/%EF%BC%89&quot;&gt;https://www.sweetjs.org/）&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://exploringjs.com/es6/ch_modules.html&quot;&gt;ES6 Module&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/41706953/are-the-new-ecmascript-6-import-and-export-asynchronous&quot;&gt;Are the new ECMAScript 6 import and export asynchronous?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;兴趣遍地都是，坚持和持之以恒才是稀缺的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[script在HTML中的加载]]></title><description><![CDATA[在访问网页的时候，浏览器是如何渲染当前的页面的？浏览器获取到输入（、、）的时候，输入中有的信息，有样式信息，代码，在加载页面的时候，如果的加载和解析太耗时的话，首屏的大量留白是很影响用户体验的，这里我们来看看，对于在页面中的加载对的加载的性能影响。 Script…]]></description><link>http://cuteshilina.com/2019-3-2-AsyncAndDeferInScript/</link><guid isPermaLink="false">http://cuteshilina.com/2019-3-2-AsyncAndDeferInScript/</guid><pubDate>Sat, 02 Mar 2019 17:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在访问网页的时候，浏览器是如何渲染当前的页面的？浏览器获取到输入（&lt;code class=&quot;language-text&quot;&gt;HTML&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;CSS&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;Javascript&lt;/code&gt;）的时候，输入中有&lt;code class=&quot;language-text&quot;&gt;DOM Tree&lt;/code&gt;的信息，有样式信息，&lt;code class=&quot;language-text&quot;&gt;Javascript&lt;/code&gt;代码，在加载页面的时候，如果&lt;code class=&quot;language-text&quot;&gt;DOM&lt;/code&gt;的加载和解析太耗时的话，首屏的大量留白是很影响用户体验的，这里我们来看看，对于&lt;code class=&quot;language-text&quot;&gt;Scritp&lt;/code&gt;在页面中的加载对&lt;code class=&quot;language-text&quot;&gt;HTML&lt;/code&gt;的加载的性能影响。&lt;/p&gt;
&lt;h2 id=&quot;script在页面中的位置&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#script%E5%9C%A8%E9%A1%B5%E9%9D%A2%E4%B8%AD%E7%9A%84%E4%BD%8D%E7%BD%AE&quot; aria-label=&quot;script在页面中的位置 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Script在页面中的位置&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;标签在页面中放置的位置对于整个页面的加载和功能影响是很大，默认情况下，浏览器在解析&lt;code class=&quot;language-text&quot;&gt;HTMl&lt;/code&gt;页面的时候，遇到&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;标签，如果是&lt;code class=&quot;language-text&quot;&gt;inline&lt;/code&gt;的话，会立即执行&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;标签中的代码，这里就牵扯一个问题，浏览器对&lt;code class=&quot;language-text&quot;&gt;HTML&lt;/code&gt;的解析是按照&lt;code class=&quot;language-text&quot;&gt;HTML&lt;/code&gt;内容的输入顺序执行的，如果&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;在&lt;code class=&quot;language-text&quot;&gt;head&lt;/code&gt;中，如果需要操作&lt;code class=&quot;language-text&quot;&gt;DOM&lt;/code&gt;，这个时候浏览器对文档的解析并没有结束，可能这时候需要的&lt;code class=&quot;language-text&quot;&gt;DOM&lt;/code&gt;并不存在。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;link&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;rel&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;stylesheet&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;./style.css&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;link&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text/javascript&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script&quot;&gt;&lt;span class=&quot;token language-javascript&quot;&gt;
      &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Dom Length: &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementsByClassName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;test&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test1&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test2&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test3&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test4&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test5&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，是一个&lt;code class=&quot;language-text&quot;&gt;inline&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;，在&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;的代码中去取&lt;code class=&quot;language-text&quot;&gt;DOM&lt;/code&gt;，这个时候浏览器在执行这段代码的时候，浏览器并没有解析到对应的&lt;code class=&quot;language-text&quot;&gt;DOM&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 33.78378378378378%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAiElEQVQoz62P3QrDIAyF8/4P6UUjE8qsWFcQ/Dkzll2sIoNtBz7UkJMTaVkYWmus6x0hPBqhY61tdYZzrr9zzkgpIcYIZu6Iz3sPYwxuDaUUaN+bedtwHLEZKoCKWuU8JfcZolJKDxcklHDR2XcxDz1Sew9+icbU+TafNhZoNuBbhi//qr8PfAJr4ifu/q3keAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;inline in head&quot;
        title=&quot;inline in head&quot;
        src=&quot;/static/902439bf615502def2479177dc6495fa/fcda8/inline_in_head.png&quot;
        srcset=&quot;/static/902439bf615502def2479177dc6495fa/12f09/inline_in_head.png 148w,
/static/902439bf615502def2479177dc6495fa/e4a3f/inline_in_head.png 295w,
/static/902439bf615502def2479177dc6495fa/fcda8/inline_in_head.png 590w,
/static/902439bf615502def2479177dc6495fa/242e2/inline_in_head.png 703w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;所以，为了避免这种情况，一般来说，会将script标签放置在&lt;code class=&quot;language-text&quot;&gt;&amp;lt;/body&amp;gt;&lt;/code&gt;标签前，这个时候，所有的&lt;code class=&quot;language-text&quot;&gt;DOM&lt;/code&gt;都解析好了，不存在找不到&lt;code class=&quot;language-text&quot;&gt;DOM&lt;/code&gt;的情况。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;link&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;rel&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;stylesheet&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;./style.css&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;link&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test1&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test2&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test3&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test4&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test5&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text/javascript&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script&quot;&gt;&lt;span class=&quot;token language-javascript&quot;&gt;
      &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Dom Length: &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementsByClassName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;test&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;    
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 33.108108108108105%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAd0lEQVQoz7WPzQrEIAyEff/nlNoeBC0UTfyZmhy6S2EPa+nAYET5JmPcumFZHPb9QM4MZgIRjzmrmRmlFNRa1XJPKamJCDFGWGvhvUcIAaa1hjI+9o4pSYgEyykB5vPUB/R/f0vAZgbyC6xA3W2y7tXtDnyqV4EnqGoqZePXZHIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;inline in body&quot;
        title=&quot;inline in body&quot;
        src=&quot;/static/3174ed35b9647e0cf017de6ae37d1855/fcda8/inline_in_body.png&quot;
        srcset=&quot;/static/3174ed35b9647e0cf017de6ae37d1855/12f09/inline_in_body.png 148w,
/static/3174ed35b9647e0cf017de6ae37d1855/e4a3f/inline_in_body.png 295w,
/static/3174ed35b9647e0cf017de6ae37d1855/fcda8/inline_in_body.png 590w,
/static/3174ed35b9647e0cf017de6ae37d1855/d67ca/inline_in_body.png 714w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;外部script的加载对html解析的影响&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A4%96%E9%83%A8script%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%AF%B9html%E8%A7%A3%E6%9E%90%E7%9A%84%E5%BD%B1%E5%93%8D&quot; aria-label=&quot;外部script的加载对html解析的影响 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;外部Script的加载对HTML解析的影响&lt;/h2&gt;
&lt;p&gt;在加载外部的&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;的时候，&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;的加载对于页面的性能影响更加明显，加载外部脚本的时候牵扯发外部的请求去请求脚本，这个时候&lt;code class=&quot;language-text&quot;&gt;HTML&lt;/code&gt;的解析是被阻塞住的，外部&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;加载成功后，马上执行&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;脚本，执行完后，才继续解析剩下的&lt;code class=&quot;language-text&quot;&gt;HTML&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;link&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;rel&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;stylesheet&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;./style.css&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;link&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test1&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test2&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test3&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test4&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test5&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text/javascript&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;./app.js&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.16216216216216%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABkElEQVQozyWQ2Y7aQBBF+f8fyWM+IcpIhISEJRAFBMx4w7RtsNtt7G4vmJOaycPV7apq1XImS89n7QdswpBNFIlCtnHESnLrIGTlBfwOAuavHj9OnsT+R20pWgURy7f/8eLN+/g7SdKUXFdckoKLuhJFBaFfoMuK6t6QFTW6sqKGxjqRxYmaQuOMwcq7bTtxJ94y6bqOzPQc/Yw/B5/9PmY/naH8iFSVnDOL0h2pyHUDz3HApTFtLQ3vpeQaXC9NB8fw6JmEcqatK1zrcEXO45YwuhrbNHQyceh7ehnav/sDepWhTcH3/YHinnKtruhGUzrNITky+Ttf8/XLgst8jkmu1O0TNyIb1fgXQZDmqNygQkW8nRJ9+8Sv6U9mLzu8U8rRk4vCk6AYuZU1E+Wd8Xc+VsA64eTuFvvOS6XUso0Vb9Ir7mYw2xf08jPHxYZkF2PiHC35vMg464TKCkOlFKXOqUzJUJWM9Z3ef6XbLulOe/rdlm4x46FvPF1Lb3thNTA+HwydQ7jgSsMljzC14R8CfAqYIPt1zAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;extend script in body&quot;
        title=&quot;extend script in body&quot;
        src=&quot;/static/e7fcce1b32423cec4032540a3a637c6e/fcda8/extend_script_in_body.png&quot;
        srcset=&quot;/static/e7fcce1b32423cec4032540a3a637c6e/12f09/extend_script_in_body.png 148w,
/static/e7fcce1b32423cec4032540a3a637c6e/e4a3f/extend_script_in_body.png 295w,
/static/e7fcce1b32423cec4032540a3a637c6e/fcda8/extend_script_in_body.png 590w,
/static/e7fcce1b32423cec4032540a3a637c6e/efc66/extend_script_in_body.png 885w,
/static/e7fcce1b32423cec4032540a3a637c6e/5a3c9/extend_script_in_body.png 1169w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
从上图的&lt;code class=&quot;language-text&quot;&gt;profile&lt;/code&gt;的图我们可以发现，浏览器在解析&lt;code class=&quot;language-text&quot;&gt;HTML&lt;/code&gt;的时候，默认在解析到&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;标签的时候，会加载对应的&lt;code class=&quot;language-text&quot;&gt;Javascript&lt;/code&gt;代码，加载完成后立即执行，这个过程会将&lt;code class=&quot;language-text&quot;&gt;HTML&lt;/code&gt;解析阻塞住，那有没有办法解决页面阻塞的问题呢？在&lt;code class=&quot;language-text&quot;&gt;HTML5&lt;/code&gt;中引入了&lt;code class=&quot;language-text&quot;&gt;async&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;defer&lt;/code&gt;这两个属性，可以解决&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;加载阻塞页面解析的问题。&lt;/p&gt;
&lt;h2 id=&quot;script中的async和defer属性&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#script%E4%B8%AD%E7%9A%84async%E5%92%8Cdefer%E5%B1%9E%E6%80%A7&quot; aria-label=&quot;script中的async和defer属性 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Script中的Async和Defer属性&lt;/h2&gt;
&lt;p&gt;首先我们看看&lt;code class=&quot;language-text&quot;&gt;MDN&lt;/code&gt;对这两个属性的解释：
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZklEQVQoz3VSi3KDIBDM/39i+khTY4hPBEFRjNs9q07bpDezs8AwC7d7h3meIRVjRF3XqAhhbSy076Fdj+n+fee/2jSED9tmGAYURYHPskHb9YjjiFHA82HFvg5h52madrFfgsJlVSFJU+QUdt4vaJ2D77qFZb+tN44/BKV2QZ4gP76gOp9hKOpvGZy6LbBKwd1u8Fm2oMvyheUsFCVm2vXQ8ny/wx2PsKcP2PcT2pXt6QT9+oY+uSBSPF7VjjG9YiTPbP9BUKrRGmVZombrFSGsGZBp6Ku1v2CNgWPL8pG95b+CIpKxFfFQ/JSQsjyHaVuEYUQXhgWBPwoMRCDBPQ1FStGrMz1MLxek9PGSJLjSp89UQeUFzuREZVA8kztyv+VjD2OzaWq2Jj+ra42irJZ5jHFcRmiaIqa4gslKutvIPE1Z2HmOQj+gDSMaH+iRh6FXlp41fEzWDWE48LYLMITr10BWjS8YygWI3CNfOwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;extend async mdn&quot;
        title=&quot;extend async mdn&quot;
        src=&quot;/static/ae9786c7e3b6e7befa12744ad2927e85/fcda8/extend_async_mdn.png&quot;
        srcset=&quot;/static/ae9786c7e3b6e7befa12744ad2927e85/12f09/extend_async_mdn.png 148w,
/static/ae9786c7e3b6e7befa12744ad2927e85/e4a3f/extend_async_mdn.png 295w,
/static/ae9786c7e3b6e7befa12744ad2927e85/fcda8/extend_async_mdn.png 590w,
/static/ae9786c7e3b6e7befa12744ad2927e85/efc66/extend_async_mdn.png 885w,
/static/ae9786c7e3b6e7befa12744ad2927e85/82b28/extend_async_mdn.png 931w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
如上，是&lt;code class=&quot;language-text&quot;&gt;async&lt;/code&gt;属性对&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;标签的加载和执行的影响：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;async&lt;/code&gt;为&lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;是异步加载和执行的，加载过程不会阻塞浏览器对&lt;code class=&quot;language-text&quot;&gt;HTML&lt;/code&gt;的解析&lt;/li&gt;
&lt;li&gt;有多个&lt;code class=&quot;language-text&quot;&gt;async&lt;/code&gt;为&lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;的执行的顺序是不确定的，执行顺序并不是脚本的引用顺序&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;link&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;rel&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;stylesheet&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;./style.css&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;link&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test1&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test2&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test3&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test4&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test5&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text/javascript&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;async&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;true&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;./app.js&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;./images/async_chrome_profile.png&quot;&gt;
从上面的&lt;code class=&quot;language-text&quot;&gt;profile&lt;/code&gt;的图可以很明显的看到这个过程，&lt;code class=&quot;language-text&quot;&gt;Javascript&lt;/code&gt;的加载和&lt;code class=&quot;language-text&quot;&gt;HTML&lt;/code&gt;的解析是并行的，并不会阻塞&lt;code class=&quot;language-text&quot;&gt;HTML&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;parse&lt;/code&gt;，但是&lt;code class=&quot;language-text&quot;&gt;javascript&lt;/code&gt;代码的执行的实际这里是无法确定的。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;link&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;rel&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;stylesheet&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;./style.css&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;link&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test1&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test2&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test3&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test4&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;Test5&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text/javascript&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;async&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;true&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text/javascript&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;async&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;true&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;./app.js&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，我们在这里从&lt;code class=&quot;language-text&quot;&gt;cdn&lt;/code&gt;上引入了&lt;code class=&quot;language-text&quot;&gt;JQuery&lt;/code&gt;的代码，我们来看看这里&lt;code class=&quot;language-text&quot;&gt;async=true&lt;/code&gt;的时候，对&lt;code class=&quot;language-text&quot;&gt;javascript&lt;/code&gt;代码的执行情况的影响。
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 39.189189189189186%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABkklEQVQozzWS647TMBCF8/4PwNuw4hdCrARdIbQgtrt0m6SJYydNfE2a9mOcCktH53jGc5WLrus4Ht/RWmP6XnSJUh3a9HSdZpgsy7rirMNoQ98P1CdFWbf0w0TTGo7lCWOMxCkK5PiQiCFwuyZSmLjMHm4Ll8WzLkH0zJLcdoeVNWkWe4RZsYaaxTX8P0WMiTlFusMvdHtAq3fa+pWxr5iDJlpFdEq0IblOtCF0O1z1gK0+4cqPBLPjIslmmaRo9Jn69S9v358JZcO8QBRvEg4CP98Is3C64uL1zgmsYIrydoWxbCmfHnGyhiIbTKV4/vqD6ttn1M8datCCCWVGlBQcRi9Jb1uyzFY4Y5TgJE30T194efiA+7OnuD+Cqpkwsvi89GG/p5dqw2AxgvMUtmQbpO2QIfZwrAmHisl63trfm6+IeTRJWJ/XrXoeNyThfiLmIOliGz0ny11Kt16PgjPeL/jrfS29O8tKLhRVfeLUKA5SLX8V6/xWcfJRdLhrQbbbjQPWC8Ldb2WqbJ/ke2X9D7DbYroncthJAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;async jquery&quot;
        title=&quot;async jquery&quot;
        src=&quot;/static/47d3dace03f49cb0ff06c0d44049160e/fcda8/async_jquery.png&quot;
        srcset=&quot;/static/47d3dace03f49cb0ff06c0d44049160e/12f09/async_jquery.png 148w,
/static/47d3dace03f49cb0ff06c0d44049160e/e4a3f/async_jquery.png 295w,
/static/47d3dace03f49cb0ff06c0d44049160e/fcda8/async_jquery.png 590w,
/static/47d3dace03f49cb0ff06c0d44049160e/efc66/async_jquery.png 885w,
/static/47d3dace03f49cb0ff06c0d44049160e/561da/async_jquery.png 969w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
在上面的&lt;code class=&quot;language-text&quot;&gt;profile&lt;/code&gt;的图中，我们可以很明显的看到，&lt;code class=&quot;language-text&quot;&gt;javascript&lt;/code&gt;代码的执行顺序，和&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;的引入顺序并不一致。
我们接着来看看&lt;code class=&quot;language-text&quot;&gt;defer&lt;/code&gt;属性对&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;标签的影响：
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 47.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABN0lEQVQoz5VS2ZKCMBD0//9s9xdcFAGBcCUQEJGjdzoayy2eNlVdPTmmq2cmh23bwFXXNaIoQtu2aJoGxhgXa60dc89YCxsPObfWunhZFqdz8II8UEohz3MoQmK/L4oCWZY5XK4ZklwhSnNkRYVpmjCOI9Z1/Ss4z7NzRhfkqqreTmvhtuueDl8wgr7vnXvifr/vBTUFKVaWTrCmqLSCTgdJXqWKx+OBWUBmVXTG3J3DSZzEX98w5xA6CGBOZwcdnGAvEUwYopV9J/eEDS+OjdzfohgYbtg+BddhgD3+oEsSWHnQCcg2TrCK0yfqD36hrLAUJTYR3JVcSqmlJLBEDkDJMHzM4fizNE2RSnwV5j37zEWttyB7wm/DRDa9kt655r++i/86ngkOrZNh0cxOkExRv//v8nm/aySyYpGuNxYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;extend defer mdn&quot;
        title=&quot;extend defer mdn&quot;
        src=&quot;/static/3ee27e2f2c6c824529cea2ec64ce517b/fcda8/extend_defer_mdn.png&quot;
        srcset=&quot;/static/3ee27e2f2c6c824529cea2ec64ce517b/12f09/extend_defer_mdn.png 148w,
/static/3ee27e2f2c6c824529cea2ec64ce517b/e4a3f/extend_defer_mdn.png 295w,
/static/3ee27e2f2c6c824529cea2ec64ce517b/fcda8/extend_defer_mdn.png 590w,
/static/3ee27e2f2c6c824529cea2ec64ce517b/27b8e/extend_defer_mdn.png 836w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
根据&lt;code class=&quot;language-text&quot;&gt;MDN&lt;/code&gt;的解释，在&lt;code class=&quot;language-text&quot;&gt;defer&lt;/code&gt;属性为&lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;的情况下，&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;标签会异步加载，脚本的执行是按照&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;标签在&lt;code class=&quot;language-text&quot;&gt;HTML&lt;/code&gt;中出现顺序执行，等所有的&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;执行完毕之后才会触发&lt;code class=&quot;language-text&quot;&gt;DOMContentLoaded&lt;/code&gt;事件。
&lt;img src=&quot;./images/defer_chrome_profile.png&quot;&gt;
对于&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;的加载和执行，结合文中实际的例子，我们总结一下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;标签默认是同步加载，加载完成之后立即执行&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;async&lt;/code&gt;为&lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;的时候，&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;的加载是异步的（不会阻塞&lt;code class=&quot;language-text&quot;&gt;HTML&lt;/code&gt;的解析过程），代码的执行顺序不一定是&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;标签出现的顺序。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;defer&lt;/code&gt;的加载和&lt;code class=&quot;language-text&quot;&gt;async&lt;/code&gt;是异步的不会阻塞&lt;code class=&quot;language-text&quot;&gt;HTML&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;parse&lt;/code&gt;，和&lt;code class=&quot;language-text&quot;&gt;async&lt;/code&gt;区别在于，&lt;code class=&quot;language-text&quot;&gt;defer&lt;/code&gt;标签的执行是按照在文档中定义的顺序执行的，在代码执行完毕之后才触发&lt;code class=&quot;language-text&quot;&gt;DOMContentLoaded&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;async&lt;/code&gt;的代码的执行并不对&lt;code class=&quot;language-text&quot;&gt;DOMContentLoaded&lt;/code&gt;有影响（代码的执行可能在&lt;code class=&quot;language-text&quot;&gt;DOMContentLoaded&lt;/code&gt;事件之后，意味着如果在&lt;code class=&quot;language-text&quot;&gt;async&lt;/code&gt;为&lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;的脚本中拿不到&lt;code class=&quot;language-text&quot;&gt;DOMContentLoaded&lt;/code&gt;的事件)]&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://flaviocopes.com/javascript-async-defer/&quot;&gt;Efficiently load JavaScript with defer and async&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script&quot;&gt;The Script element&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;兴趣遍地都是，坚持和持之以恒才是稀缺的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[自己动手写AMD Loader]]></title><description><![CDATA[上一篇博客Javascript模块化介绍了前端的模块化的一些方案和历史，基于浏览器的规范，我们尝试自己实现一个。 AMD Loader…]]></description><link>http://cuteshilina.com/2019-2-23-WriteYourOwnAmdLoader/</link><guid isPermaLink="false">http://cuteshilina.com/2019-2-23-WriteYourOwnAmdLoader/</guid><pubDate>Sat, 23 Feb 2019 17:00:00 GMT</pubDate><content:encoded>&lt;p&gt;上一篇博客&lt;a href=&quot;http://cuteshilina.com/2019/02/06/Javascript%E6%A8%A1%E5%9D%97%E5%8C%96/&quot;&gt;Javascript模块化&lt;/a&gt;介绍了前端的模块化的一些方案和历史，基于浏览器的&lt;a href=&quot;https://github.com/amdjs/amdjs-api/wiki/AMD&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;AMD&lt;/code&gt;规范&lt;/a&gt;，我们尝试自己实现一个&lt;code class=&quot;language-text&quot;&gt;AMD Loader&lt;/code&gt;。&lt;/p&gt;
&lt;h1 id=&quot;amd-loader要解决的问题&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#amd-loader%E8%A6%81%E8%A7%A3%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98&quot; aria-label=&quot;amd loader要解决的问题 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;AMD Loader要解决的问题&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;AMD&lt;/code&gt;主要是为了解决浏览器端的模块化，实现&lt;code class=&quot;language-text&quot;&gt;AMD Loader&lt;/code&gt;的话，以下的点要考虑到：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;前端的加载是异步的&lt;/li&gt;
&lt;li&gt;模块的依赖也是模块（可能会出现循环依赖的问题）&lt;/li&gt;
&lt;li&gt;每个Module只加载一次&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;AMD Loader&lt;/code&gt;暴露 &lt;code class=&quot;language-text&quot;&gt;define&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;require&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;其实我们主要要解决的点在于，如何处理&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;的加载。&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;加载要解决两个主要问题，一是对模块的引用（对path的处理）；二是如何维护模块之间的引用关系。&lt;/p&gt;
&lt;h1 id=&quot;模块代码的加载&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%A8%A1%E5%9D%97%E4%BB%A3%E7%A0%81%E7%9A%84%E5%8A%A0%E8%BD%BD&quot; aria-label=&quot;模块代码的加载 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;模块代码的加载&lt;/h1&gt;
&lt;p&gt;首先来看看&lt;code class=&quot;language-text&quot;&gt;define&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;API&lt;/code&gt;接口：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;define&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dependence&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; factory&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;define&lt;/code&gt;的函数中&lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt;是表示当前模块的&lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt;，&lt;strong&gt;&lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt;可以是字符串或者一个绝对路径的字符串&lt;/strong&gt;，这里规定不能出现相对&lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt;，例如’./myModule’或者 ‘../myModule’；&lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt;是可选的，如果没有提供&lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt;的话，默认&lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt;名是&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;的在浏览器加载当前&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;。
&lt;code class=&quot;language-text&quot;&gt;dependence&lt;/code&gt;，是一个字符串数组，字符串是依赖模块的&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;，可以是相对路径、绝对路径、字符串（如JQuery）。
所以，我们首先要解决的问题是，如何去规范化用户传进来的各种各样的&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;，例如，下面这些&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;的规范化：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;a&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;b&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;c&lt;span class=&quot;token comment&quot;&gt;//d --&gt; a/b/c/d&lt;/span&gt;
 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;a&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;b&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;c&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;d &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;a&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;d
 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;a&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;b&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;c&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;d &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;a&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;b&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;c&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;d
 main&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;test&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;foo#bar &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; main&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;test&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;对于这些&lt;code class=&quot;language-text&quot;&gt;URl&lt;/code&gt;，我们可以写正则表达式去匹配，在用户传入模块的’url’，需要过一遍我们的正则，将其规范化，对于依赖模块，我们要基于当前&lt;code class=&quot;language-text&quot;&gt;Config&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;baseURL&lt;/code&gt;（如果在config中配置了baseUrl的话），拼成完整的&lt;code class=&quot;language-text&quot;&gt;url&lt;/code&gt;，让浏览器的&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;去加载，在加载完之后，将对应的&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;删除。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;script&quot;&gt;&lt;pre class=&quot;language-script&quot;&gt;&lt;code class=&quot;language-script&quot;&gt;    function loadScript(url, callback) {
        var node = document.createElement(&amp;#39;script&amp;#39;);
        var head = document.head;
        node.setAttribute(&amp;#39;data-module&amp;#39;, url);
        node.async = true;
        node.src = url;
        
        function onload() {
            node.onload = node.onerror = null;
            head.removeChild(node);
            callback();
        }
        node.onerror = function(error) {
            node.onload = node.onerror = null;
            head.removeChild(node);
            callback(error)
        }
    }&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，是使用&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;标签加载模块的一些代码，基本逻辑是：&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;创建script标签 ---&amp;gt; 加载模块源码 ---&amp;gt; 模块加载完成后触发回调函数&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;这里主要是利用&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;标签来做模块的加载，这里给&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;标签加上了&lt;code class=&quot;language-text&quot;&gt;async=true&lt;/code&gt;的标志，浏览器在解析&lt;code class=&quot;language-text&quot;&gt;HTML&lt;/code&gt;页面的时候，不会因为加载&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;阻塞住页面的解析，在&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;加载成功后执行&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;中的代码。&lt;/p&gt;
&lt;h1 id=&quot;模块的定义&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%A8%A1%E5%9D%97%E7%9A%84%E5%AE%9A%E4%B9%89&quot; aria-label=&quot;模块的定义 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;模块的定义&lt;/h1&gt;
&lt;p&gt;在使用&lt;code class=&quot;language-text&quot;&gt;AMD Loader&lt;/code&gt;定义我们的&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;的时候，使用&lt;code class=&quot;language-text&quot;&gt;define(id?, dependence?, factory)&lt;/code&gt;的接口来定义我们的&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;，在实现模块定义的时候，我们可以预想到有以下问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;模块的加载是异步的，意味着我们需要设计&lt;code class=&quot;language-text&quot;&gt;notify&lt;/code&gt;机制&lt;/li&gt;
&lt;li&gt;我们需要解决模块循环依赖问题&lt;/li&gt;
&lt;li&gt;模块仅仅被加载一次，需要有模块的&lt;code class=&quot;language-text&quot;&gt;cache&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 70.94594594594594%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB7klEQVQ4y41TTW/TQBDN3+IP0DMSNySOnPkrgDgAQkKVkAAVCVVFqFAkkGgqtSlNAYc4cdx8OHb9ba/tOCEJj5mlhiYxtIfR7uzsPr33ZrbipxNcFF4ylmuY/VjIy6JyEVDx2I5zmGEG9yz/F2jlMuzifIp3xx3c2apCGXgyvzTgeVa8SkbJBJ+O29jXTBhBioBq7tK9BcCyAu8D8iyZzOHGGRStj5T2DOZTjf0MSqSvADrklROP4IocQ0+gpp5i50BHy/ARjn43hdn1vYR8HZUzLA6jfIZ8Dox/AtFoilbfxlZVw9O3CtrDCGI8g+ULfKy3cPf1HqrqAILeuMuAriDjx3McfT/BvccvcP/JBtY33kiGqhHhqO3A8FKoPQsnpo9TYva170iWQbaoUAKyRGb1bPM9rqzdwNXrt3Dt5m00dBMvPzTxaLOOWtMgz3J4dJ+9S4gtg7E1K4BFAwZOhJqi4VDp4HNDR88O0TZjfNFdOKyC5BU+sn8R7bOzRhWgCx6G5Fs6BbIZeUizpvZsPN9p4OGrOg7VIaxAQDMcNLsWuqaH3W8dbNc7GPh/pa90mSUUMiRr8q5rC/JQwKSHhhvDClM5QnvUlAfbB9CdWDL/A1j2b4sB53ljaQzOcX7+GIR/jV8m+X+gZbFcL/JfudwbZa8pjgAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;main&quot;
        title=&quot;main&quot;
        src=&quot;/static/a7e517f53b0ac12fea1023f9e1626fe7/fcda8/main.png&quot;
        srcset=&quot;/static/a7e517f53b0ac12fea1023f9e1626fe7/12f09/main.png 148w,
/static/a7e517f53b0ac12fea1023f9e1626fe7/e4a3f/main.png 295w,
/static/a7e517f53b0ac12fea1023f9e1626fe7/fcda8/main.png 590w,
/static/a7e517f53b0ac12fea1023f9e1626fe7/13e20/main.png 741w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
如上，对于&lt;code class=&quot;language-text&quot;&gt;main Module&lt;/code&gt;有&lt;code class=&quot;language-text&quot;&gt;dep0, dep1, dep2&lt;/code&gt;三个依赖，这里我们在定义&lt;code class=&quot;language-text&quot;&gt;main Module&lt;/code&gt;的时候，将&lt;code class=&quot;language-text&quot;&gt;main Module&lt;/code&gt;中的每个依赖（在声明中只有url）实例化成&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;，在加载&lt;code class=&quot;language-text&quot;&gt;main Module&lt;/code&gt;的时候，得先要加载我们的依赖&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;，这里因为&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;的加载是异步的，所以在实例化我们的依赖的时候，在每个&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;中保存一个&lt;code class=&quot;language-text&quot;&gt;refs&lt;/code&gt;的数组，这个数组中保存着依赖这个&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt;，当前&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;加载完成之后，在&lt;code class=&quot;language-text&quot;&gt;onload&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;callback&lt;/code&gt;中去通知当前模块&lt;code class=&quot;language-text&quot;&gt;load&lt;/code&gt;完成，然后当前&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;会查看当前&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;refs&lt;/code&gt;中所有的&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;，在&lt;code class=&quot;language-text&quot;&gt;refs&lt;/code&gt;中这些&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;就会收集自己所有的依赖是不是都加载完成，如果加载完成了，当前的&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;就加载完成了，否则就触发当前&lt;code class=&quot;language-text&quot;&gt;ref&lt;/code&gt;的重新&lt;code class=&quot;language-text&quot;&gt;load&lt;/code&gt;（为了触发其他未被加载的依赖的加载）。&lt;/p&gt;
&lt;p&gt;解决了&lt;code class=&quot;language-text&quot;&gt;notify&lt;/code&gt;的问题，剩下的两个问题主要是对&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;状态的维护，如下图，是整个&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;的加载的状态转移图：
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABI0lEQVQ4y42Tz07DMAzG+5A8ES/DmTviyAUBEgekqYcJDjBGKGvzp+kS58Op1JJ2Ga0rq1Vq/WzHnwv8YyGEv3f8DMuxBRZshPYPgYjQti201uymd+/9GFusgVEgVI3AZ7VDrWsopXs3poVisLV2XYUpUHcNOmdhO4u6kWikhHPu5GqK+cHg6bknx1A/SRRbJwr5O5wCaQKOvxwDIzSNTUFpEcU8Q84IXCH5E8C8kxEY7yhaKZ5weXuBm80V7h9LfOwFHp43KLdvi0knwCHw0H7h7vUa2+8X7MUPNE9RVDWkMtn2zgLz2cPZqa+uMA6kcyxaK1kmEsejg2ERR72lElmscJhmrEqaGjvxjoOqeCMspFRoWHdxI3JDWNVyQMju8xrgL0bwAUXtSb4cAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;AMDLoader&quot;
        title=&quot;AMDLoader&quot;
        src=&quot;/static/3f50d301a22cc50d03c5fc43665fe92a/fcda8/AMDLoader.png&quot;
        srcset=&quot;/static/3f50d301a22cc50d03c5fc43665fe92a/12f09/AMDLoader.png 148w,
/static/3f50d301a22cc50d03c5fc43665fe92a/e4a3f/AMDLoader.png 295w,
/static/3f50d301a22cc50d03c5fc43665fe92a/fcda8/AMDLoader.png 590w,
/static/3f50d301a22cc50d03c5fc43665fe92a/efc66/AMDLoader.png 885w,
/static/3f50d301a22cc50d03c5fc43665fe92a/25260/AMDLoader.png 1113w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;依照上图的状态转移图，&lt;code class=&quot;language-text&quot;&gt;Module Class&lt;/code&gt;的设计如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Module&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; deps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;refs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;depsUrl &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getVaildUrl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;deps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;depsModule &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;STATUS&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;STATUS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;INIT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token class-name&quot;&gt;Module&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prototype &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    constructor&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Module&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token function-variable function&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 加载module的代码&lt;/span&gt;
    &lt;span class=&quot;token function-variable function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;depsUrl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 检测修正依赖的url，并剔除已经被加载的module的url&lt;/span&gt;
    &lt;span class=&quot;token function-variable function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 实例化每个依赖&lt;/span&gt;
    &lt;span class=&quot;token function-variable function&quot;&gt;setDependencies&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 设置依赖当前模块的refs&lt;/span&gt;
    &lt;span class=&quot;token function-variable function&quot;&gt;checkCircular&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 检测循环依赖&lt;/span&gt;
    &lt;span class=&quot;token function-variable function&quot;&gt;makeExports&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 调用Module的factory函数并输出exports&lt;/span&gt;
    &lt;span class=&quot;token function-variable function&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 加载模块&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;对于Module本身来说我们这里也需要维护一个状态，来表明当前&lt;code class=&quot;language-text&quot;&gt;Module&lt;/code&gt;的执行状态：&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;init --&amp;gt; fetch --&amp;gt; save --&amp;gt; load --&amp;gt; executing --&amp;gt; executed or error&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;AMD-Loader&lt;/code&gt;的完整代码 —&gt; &lt;a href=&quot;https://github.com/Soyn/AMDLoader/blob/master/src/index.js&quot;&gt;AMD Loader&lt;/a&gt;，&lt;strong&gt;代码实现仅为了解AMD模块加载的原理，并不能用在生产环境下&lt;/strong&gt;。&lt;/p&gt;
&lt;h1 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/creeperyang/blog/issues/17&quot;&gt;AMD加载器分析与实现&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/creeperyang/amd-loader/blob/master/amd.js&quot;&gt;https://github.com/creeperyang/amd-loader/blob/master/amd.js&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/requirejs/requirejs/blob/master/require.js&quot;&gt;requireJS源码&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;兴趣遍地都是，坚持和持之以恒才是稀缺的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Javascript模块化]]></title><description><![CDATA[TL:DR; 前端模块化主要是解决依赖管理，模块加载的问题 立即调用函数的匿名闭包是模块化实现的基石 在客户端和服务端都需要做模块化 CommonJS是服务端的模块化解决方案，模块同步加载 AMD是客户端（浏览器）的模块化方案，模块异步加载 UMD统一了客户端和服务端，兼容AMD…]]></description><link>http://cuteshilina.com/2019-2-06-Javascript模块化/</link><guid isPermaLink="false">http://cuteshilina.com/2019-2-06-Javascript模块化/</guid><pubDate>Wed, 06 Feb 2019 17:00:00 GMT</pubDate><content:encoded>&lt;hr&gt;
&lt;p&gt;TL:DR;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;前端模块化主要是解决依赖管理，模块加载的问题&lt;/li&gt;
&lt;li&gt;立即调用函数的匿名闭包是模块化实现的基石&lt;/li&gt;
&lt;li&gt;在客户端和服务端都需要做模块化&lt;/li&gt;
&lt;li&gt;CommonJS是服务端的模块化解决方案，模块同步加载&lt;/li&gt;
&lt;li&gt;AMD是客户端（浏览器）的模块化方案，模块异步加载&lt;/li&gt;
&lt;li&gt;UMD统一了客户端和服务端，兼容AMD和CommonJS&lt;/li&gt;
&lt;li&gt;ES6提供了官方的模块化（import/export）&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt; 在写&lt;code class=&quot;language-text&quot;&gt;Javascript&lt;/code&gt;的时候，会经常会听到模块化这个概念，模块化在编程是一个很重要的设计，将可复用的、独立的模块抽出来，一是避免重复造轮子；二是减小维护和使用成本，虽然现在&lt;code class=&quot;language-text&quot;&gt;ES6&lt;/code&gt;提供了标准的模块化方案，但是在&lt;code class=&quot;language-text&quot;&gt;Javascript&lt;/code&gt;的发展历程中还是经历了一段从黑暗到光明的阶段。&lt;/p&gt;
&lt;h2 id=&quot;模块的加载和封装&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%A8%A1%E5%9D%97%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%92%8C%E5%B0%81%E8%A3%85&quot; aria-label=&quot;模块的加载和封装 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;模块的加载和封装&lt;/h2&gt;
&lt;p&gt;使用&lt;code class=&quot;language-text&quot;&gt;&amp;lt;script&amp;gt;&lt;/code&gt;来做模块化最常见的方式是使用&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;标签将你需要的模块在网页中加载，在用户请求网页的时候，会加载前置的依赖，例如这样：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text/javascript&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;./module1.js&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text/javascript&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;./main.js&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;就像上面一样，这里先加载&lt;code class=&quot;language-text&quot;&gt;module1.js&lt;/code&gt;，在&lt;code class=&quot;language-text&quot;&gt;main.js&lt;/code&gt;中会使用&lt;code class=&quot;language-text&quot;&gt;module1&lt;/code&gt;暴露出的方法，但是这样的模块化方案如果面对大量的依赖管理的话，就会面临很多问题，就像下面的代码：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text/javascript&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;./framework.js&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text/javascript&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;./frameworkPlugin.js&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text/javascript&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;./frameworkPlugin1.js&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text/javascript&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;./frameworkPlugin2.js&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text/javascript&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;./frameworkPlugin3.js&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      ...
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;script&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;text/javascript&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;./main.js&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token script&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;head&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;html&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;但是如果依赖多了的话，带来的问题就是，第一依赖模糊，模块与模块之间的依赖并不清楚；第二就是会给代码维护带来麻烦，因为在编写代码的时候，依赖的注入，是依赖于&lt;code class=&quot;language-text&quot;&gt;html&lt;/code&gt;中前置的&lt;code class=&quot;language-text&quot;&gt;script&lt;/code&gt;标签做的，在代码中并没有显示的声明依赖；第三就是每个&lt;code class=&quot;language-text&quot;&gt;&amp;lt;script&amp;gt;&lt;/code&gt;加载都需要发网络请求，这里网络请求过多。&lt;/p&gt;
&lt;p&gt;如何构建&lt;code class=&quot;language-text&quot;&gt;Javascript&lt;/code&gt;模块也是一个值得探讨的问题，常见的是这样：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果以为上面的方式暴露接口的话，存在的问题就是，很容易污染全局环境，造成命名冲突，为了解决命名冲突的问题，随之而来，我们可以增加命名空间：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; myModule &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token function-variable function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token function-variable function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

myModule&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;像上面这样加命名空间的方式减少了全局环境被污染的情况，并且这样的封装并不安全，本质上是对象，外部可以访问到不想暴露给外界的东西，这种方式并没有解决根本矛盾—&gt;保证封装性的同时减少全局变量的数量，在这里我们要保证模块只暴露想暴露的东西，一些私有属性外界无法访问，这里使用闭包就可以解决这些问题：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; myModule &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; _private &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token comment&quot;&gt;// use _private&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		foo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
myModule&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
myModule&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_private&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里使用立即调用（IIFE）的模式，将私有属性和外部隔离起来，保证了封装性，如果我们需要注入其他的依赖可以这样：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; myModule &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; _$ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; _private &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;_$&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selector&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		foo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;$&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;就像上面的代码，如果可以向模块引入外部依赖，这就是现代模块系统的基石。&lt;/p&gt;
&lt;p&gt;上面讲了如何封装一个模块和加载模块，在实际的开发过程中，我们仍然需要考虑几个问题，比如跳出浏览器环境，在&lt;code class=&quot;language-text&quot;&gt;Node.js&lt;/code&gt;下如何做模块化，如何对打包之后的模块进行压缩、合并、优化。&lt;/p&gt;
&lt;h2 id=&quot;commonjs&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#commonjs&quot; aria-label=&quot;commonjs permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;CommonJS&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;CommonJS&lt;/code&gt;是&lt;code class=&quot;language-text&quot;&gt;Node.js&lt;/code&gt;的模块化规范，&lt;code class=&quot;language-text&quot;&gt;Common.js&lt;/code&gt;对外暴露四个环境变量&lt;code class=&quot;language-text&quot;&gt;module&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;exports&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;global&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;require&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;Common.js&lt;/code&gt;以文件作为独立模块来管理，&lt;code class=&quot;language-text&quot;&gt;Common.js&lt;/code&gt;以同步的方式加载模块。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;//  引入模块&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// a.js&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;bar&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 导出模块&lt;/span&gt;
module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exports &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	foo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	bar
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// main.js&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 声明依赖模块&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; foo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; bar &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;reauire&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;js&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;因为在服务端，文件存在磁盘上，读取速度很快，同步的加载方式不存在问题，但是在浏览器上，因为网络的原因，同步加载的方式并不是一个好的方式，这就引入了异步加载模块的方式&lt;code class=&quot;language-text&quot;&gt;AMD&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;优缺点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;服务端的模块化方案实现&lt;/li&gt;
&lt;li&gt;模块的输出是&lt;code class=&quot;language-text&quot;&gt;Object&lt;/code&gt;，无法做静态分析&lt;/li&gt;
&lt;li&gt;每个模块输出都是一个&lt;code class=&quot;language-text&quot;&gt;copy&lt;/code&gt;，无法做到热加载&lt;/li&gt;
&lt;li&gt;循环依赖的管理做的不好&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;amd（async-module-definition-）&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#amd%EF%BC%88async-module-definition-%EF%BC%89&quot; aria-label=&quot;amd（async module definition ） permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;AMD（Async Module Definition ）&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;AMD&lt;/code&gt;规范制定了一套异步加载&lt;code class=&quot;language-text&quot;&gt;module&lt;/code&gt;的机制，&lt;code class=&quot;language-text&quot;&gt;define(id?, dependencies?, factory)&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;define&lt;/code&gt;函数的前两个参数是可选的，如果提供了一个&lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt;，这个&lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt;就代表该模块，如果没有给这个参数，某块的名字就是模块加载器请求脚本的名字，&lt;code class=&quot;language-text&quot;&gt;dependencies&lt;/code&gt;是一个模块&lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt;的数组，声明当前模块的依赖模块，&lt;code class=&quot;language-text&quot;&gt;factory&lt;/code&gt;函数就是在所有依赖模块加载好之后的会调函数，如果&lt;code class=&quot;language-text&quot;&gt;dependencies&lt;/code&gt;中没有提供任何依赖，模块加载器会扫描&lt;code class=&quot;language-text&quot;&gt;factory&lt;/code&gt;函数中所有的&lt;code class=&quot;language-text&quot;&gt;require&lt;/code&gt;，同步加载依赖,&lt;code class=&quot;language-text&quot;&gt;factory&lt;/code&gt;函数只执行一次，如果传入的参数是一个&lt;code class=&quot;language-text&quot;&gt;Object&lt;/code&gt;的话，会将模块输出到这个对象中，如果函数的返回值是一个对象，模块输出到返回值中。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 将alpha模块挂到exports上&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;define&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;alpha&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;require&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;exports&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;beta&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;require&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; exports&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; beta&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
       exports&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;verb&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
           &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; beta&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;verb&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
           &lt;span class=&quot;token comment&quot;&gt;//Or:&lt;/span&gt;
           &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;beta&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;verb&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
       &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
   &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 返回输出模块&lt;/span&gt;
   &lt;span class=&quot;token function&quot;&gt;define&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;alpha&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
       &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
         &lt;span class=&quot;token function-variable function&quot;&gt;verb&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
           &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; alpha&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;verb&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
         &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
       &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
   &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 一个没有依赖的模块&lt;/span&gt;
   &lt;span class=&quot;token function&quot;&gt;define&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
     &lt;span class=&quot;token function-variable function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
       &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
     &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
   &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 使用commonJS包裹的模块&lt;/span&gt;
   &lt;span class=&quot;token function&quot;&gt;define&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;require&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; exports&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; module&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
     &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;a&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
         b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;b&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

     exports&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
   &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;优缺点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;主要用于客户端（浏览器）&lt;/li&gt;
&lt;li&gt;语法复杂&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;umd（universal-module-definition）&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#umd%EF%BC%88universal-module-definition%EF%BC%89&quot; aria-label=&quot;umd（universal module definition） permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;UMD（Universal Module Definition）&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;AMD&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;CommonJS&lt;/code&gt;的模块化方案提供两套&lt;code class=&quot;language-text&quot;&gt;API&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;UMD&lt;/code&gt;将这两套&lt;code class=&quot;language-text&quot;&gt;API&lt;/code&gt;统一了起来，&lt;code class=&quot;language-text&quot;&gt;UMD&lt;/code&gt;使用&lt;code class=&quot;language-text&quot;&gt;commonJS&lt;/code&gt;的语法，但是提供异步加载模块的能力。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;	&lt;span class=&quot;token comment&quot;&gt;// File log.js&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;global&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; factory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; define &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;function&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; define&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;amd&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;define&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;exports&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; factory&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; exports &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;undefined&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;factory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;exports&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; mod &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      exports&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;factory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mod&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exports&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    global&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;log &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; mod&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exports&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;exports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;use strict&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Example of UMD module system&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// expose log to other modules&lt;/span&gt;
  exports&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;log &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; log&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上其实&lt;code class=&quot;language-text&quot;&gt;UMD&lt;/code&gt;就是对宿主环境做了兼容性处理，在不同的宿主环境下输出不同模块。&lt;/p&gt;
&lt;p&gt;优缺点：
- 同时适用于客户端和服务端，兼容性好
- 兼容&lt;code class=&quot;language-text&quot;&gt;AMD&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;CommonJS&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;es6的import和export&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#es6%E7%9A%84import%E5%92%8Cexport&quot; aria-label=&quot;es6的import和export permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ES6的Import和Export&lt;/h2&gt;
&lt;p&gt;在&lt;code class=&quot;language-text&quot;&gt;ES6&lt;/code&gt;中有了官方的模块化解决方案，将&lt;code class=&quot;language-text&quot;&gt;AMD&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;CommonJS&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;UMD&lt;/code&gt;统一了起来，并且在打包工具打包的时候可以做静态分析，可以做&lt;code class=&quot;language-text&quot;&gt;tree shaking&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// a.js&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;foo&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// main.js&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; foo &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./a&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;优缺点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;服务端和客户端都可以使用&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;import&lt;/code&gt;的时候拿到的是实际值不是拷贝，可以做热更新&lt;/li&gt;
&lt;li&gt;支持静态分析（可以用&lt;code class=&quot;language-text&quot;&gt;tree shaking&lt;/code&gt;）&lt;/li&gt;
&lt;li&gt;相比于&lt;code class=&quot;language-text&quot;&gt;CommonJS&lt;/code&gt;循环依赖的管理做的更好&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;webpack-、babel&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#webpack-%E3%80%81babel&quot; aria-label=&quot;webpack 、babel permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Webpack 、Babel&lt;/h2&gt;
&lt;p&gt;因为并不是所有的宿主环境都支持&lt;code class=&quot;language-text&quot;&gt;ES6&lt;/code&gt;，我们需要使用&lt;code class=&quot;language-text&quot;&gt;Babel&lt;/code&gt;来将&lt;code class=&quot;language-text&quot;&gt;ES6&lt;/code&gt;的代码转移成&lt;code class=&quot;language-text&quot;&gt;es5&lt;/code&gt;的代码，同时我们需要对现有的工程代码做合并、压缩和优化，这主要是通过&lt;code class=&quot;language-text&quot;&gt;Webpack&lt;/code&gt;实现的，也可以使用&lt;code class=&quot;language-text&quot;&gt;Webpack&lt;/code&gt;做按需加载，划分不同的&lt;code class=&quot;language-text&quot;&gt;chunk&lt;/code&gt;，减少&lt;code class=&quot;language-text&quot;&gt;http&lt;/code&gt;请求。&lt;/p&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/creeperyang/blog/issues/17&quot;&gt;https://github.com/creeperyang/blog/issues/17&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/Huxpro/js-module-7day&quot;&gt;https://github.com/Huxpro/js-module-7day&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.freecodecamp.org/anatomy-of-js-module-systems-and-building-libraries-fadcd8dbd0e&quot;&gt;https://medium.freecodecamp.org/anatomy-of-js-module-systems-and-building-libraries-fadcd8dbd0e&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;兴趣遍地都是，坚持和持之以恒才是稀缺的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[React-Redux源码剖析]]></title><description><![CDATA[TL;DR; 本质上是一个高阶组件 会对组件做缓存控制 使用做全局状态的通信 Overview 如上，react-redux向外暴露了四个API，分别是、、、。 Provider…]]></description><link>http://cuteshilina.com/2019-1-26-ReactRedux源码解读/</link><guid isPermaLink="false">http://cuteshilina.com/2019-1-26-ReactRedux源码解读/</guid><pubDate>Sat, 26 Jan 2019 17:00:00 GMT</pubDate><content:encoded>&lt;hr&gt;
&lt;p&gt;TL;DR;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Connect&lt;/code&gt;本质上是一个高阶组件&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Connect&lt;/code&gt;会对组件做缓存控制&lt;/li&gt;
&lt;li&gt;
&lt;h2 id=&quot;code-classlanguage-textconnectcode使用code-classlanguage-textcontextcode做全局状态的通信&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#code-classlanguage-textconnectcode%E4%BD%BF%E7%94%A8code-classlanguage-textcontextcode%E5%81%9A%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81%E7%9A%84%E9%80%9A%E4%BF%A1&quot; aria-label=&quot;code classlanguage textconnectcode使用code classlanguage textcontextcode做全局状态的通信 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;Connect&lt;/code&gt;使用&lt;code class=&quot;language-text&quot;&gt;Context&lt;/code&gt;做全局状态的通信&lt;/h2&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;overview&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#overview&quot; aria-label=&quot;overview permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Overview&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Provider &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./components/Provider&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; connectAdvanced &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./components/connectAdvanced&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; ReactReduxContext &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./components/Context&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; connect &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./connect/connect&apos;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Provider&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; connectAdvanced&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ReactReduxContext&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; connect &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，react-redux向外暴露了四个API，分别是&lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;ConnectAdvanced&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;ReactReduxContext&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&quot;provider&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#provider&quot; aria-label=&quot;provider permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Provider&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt;是一个&lt;code class=&quot;language-text&quot;&gt;React Component&lt;/code&gt;，在组件&lt;code class=&quot;language-text&quot;&gt;didMount&lt;/code&gt;的时候订阅&lt;code class=&quot;language-text&quot;&gt;redux&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;，在&lt;code class=&quot;language-text&quot;&gt;willUnMount&lt;/code&gt;的时候接触订阅，每次&lt;code class=&quot;language-text&quot;&gt;redux state&lt;/code&gt;改变的时候，会调用&lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt;中的&lt;code class=&quot;language-text&quot;&gt;setState&lt;/code&gt;，使得组件刷新，我们来看看部分源代码：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;    &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; store &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; props

    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      storeState&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; store&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      store
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在组件初始化的时候，&lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt;从&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;上获取&lt;code class=&quot;language-text&quot;&gt;redux&lt;/code&gt;上的&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;，并初始化&lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;同时在组件&lt;code class=&quot;language-text&quot;&gt;didMount&lt;/code&gt;的时候，这里会向&lt;code class=&quot;language-text&quot;&gt;redux&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;上注册&lt;code class=&quot;language-text&quot;&gt;callback&lt;/code&gt;函数：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;    &lt;span class=&quot;token function&quot;&gt;componentDidMount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_isMounted &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; store &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props

    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;unsubscribe &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; store&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; newStoreState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; store&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;_isMounted&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;providerState&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// If the value is the same, skip the unnecessary state update.&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;providerState&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;storeState &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; newStoreState&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; storeState&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; newStoreState &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// Actions might have been dispatched between render and mount - handle those&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; postMountStoreState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; store&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;postMountStoreState &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;storeState&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; storeState&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; postMountStoreState &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里在&lt;code class=&quot;language-text&quot;&gt;subscribe&lt;/code&gt;函数的最后几行的代码，是用来处理在组件&lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt;如果在初次&lt;code class=&quot;language-text&quot;&gt;render&lt;/code&gt;的时候，如果有&lt;code class=&quot;language-text&quot;&gt;action&lt;/code&gt;被&lt;code class=&quot;language-text&quot;&gt;dispatch&lt;/code&gt;，这个时候还没有&lt;code class=&quot;language-text&quot;&gt;subscribe&lt;/code&gt;，但是这时候我们的数据需要刷新，所以这个时候需要去取一次最新数据，如果发现有数据变化，使用&lt;code class=&quot;language-text&quot;&gt;setState&lt;/code&gt;，触发组件刷新。&lt;/p&gt;
&lt;p&gt;在&lt;code class=&quot;language-text&quot;&gt;render&lt;/code&gt;中使用&lt;code class=&quot;language-text&quot;&gt;Context.Provider&lt;/code&gt;将&lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt;中的内容，即我们这里的&lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;注入到&lt;code class=&quot;language-text&quot;&gt;children&lt;/code&gt;组件中。&lt;/p&gt;
&lt;p&gt;从上面的代码可以看到，如果&lt;code class=&quot;language-text&quot;&gt;redux&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;State&lt;/code&gt;发生了变化，会触发顶层组件的刷新，重新&lt;code class=&quot;language-text&quot;&gt;render&lt;/code&gt;，从而重刷整个应用。&lt;/p&gt;
&lt;h2 id=&quot;connect&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#connect&quot; aria-label=&quot;connect permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Connect&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;这个函数就是我们经常要使用到的，一般来说在使用&lt;code class=&quot;language-text&quot;&gt;redux&lt;/code&gt;的时候，&lt;code class=&quot;language-text&quot;&gt;Container&lt;/code&gt;组件就是一个&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;之后的组件。
&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;主要的工作就是一是负责从&lt;code class=&quot;language-text&quot;&gt;state tree&lt;/code&gt;上去取组件要用的数据，另外就是在&lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;变化的时候，重新计算来自&lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;上的&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;。
我们来看看一个简单版本的&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;的实现（&lt;a href=&quot;https://gist.github.com/gaearon/1d19088790e70ac32ea636c025ba424e&quot;&gt;connect explain&lt;/a&gt;）:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// connect() is a function that injects Redux-related props into your component.&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// You can inject data and callbacks that change that data by dispatching actions.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;mapStateToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mapDispatchToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// It lets us inject component as the last step so people can use it as a decorator.&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Generally you don&apos;t need to worry about it.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;WrappedComponent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// It returns a component&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;extends&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Component &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          &lt;span class=&quot;token comment&quot;&gt;// that renders your component&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;WrappedComponent
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;/* with its props  */&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;/* and additional props calculated from Redux store */&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mapStateToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;store&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mapDispatchToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;store&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      
      &lt;span class=&quot;token function&quot;&gt;componentDidMount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// it remembers to subscribe to the store so it doesn&apos;t miss updates&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;unsubscribe &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; store&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;handleChange&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      
      &lt;span class=&quot;token function&quot;&gt;componentWillUnmount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// and unsubscribe later&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;unsubscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
      &lt;span class=&quot;token function&quot;&gt;handleChange&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// and whenever the store state changes, it re-renders.&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forceUpdate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上就是&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;一个简单版本的实现，&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;是一个包装过的高阶组件的函数，在第一层接受一个&lt;code class=&quot;language-text&quot;&gt;selector&lt;/code&gt;函数，接收&lt;code class=&quot;language-text&quot;&gt;redux&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;和传给组件的&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;， 然后将需要包装的组件传给返回后的函数，最后返回的组件中就可以从&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;上拿到&lt;code class=&quot;language-text&quot;&gt;redux state&lt;/code&gt;上的数据了，上面这个是一个简陋的&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;实现，我们来看看&lt;code class=&quot;language-text&quot;&gt;react redux&lt;/code&gt;真正的实现。&lt;/p&gt;
&lt;p&gt;我们先来看看&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;是如何解析我们传入的参数的，&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;map*&lt;/code&gt;传入的格式支持直接传入函数，也可以传入一个&lt;code class=&quot;language-text&quot;&gt;obejct&lt;/code&gt;，来看看&lt;code class=&quot;language-text&quot;&gt;react-redux&lt;/code&gt;是如何支持不同的输入的。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// createConnect with default args builds the &apos;official&apos; connect behavior. Calling it with&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// different options opens up some testing and extensibility scenarios&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createConnect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  connectHOC &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; connectAdvanced&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  mapStateToPropsFactories &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; defaultMapStateToPropsFactories&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  mapDispatchToPropsFactories &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; defaultMapDispatchToPropsFactories&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  mergePropsFactories &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; defaultMergePropsFactories&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  selectorFactory &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; defaultSelectorFactory
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createConnect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，是&lt;code class=&quot;language-text&quot;&gt;connect.js&lt;/code&gt;文件暴露出来的&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;接口，外面用的时候，是使用的&lt;code class=&quot;language-text&quot;&gt;createConnect&lt;/code&gt;的返回值。
在这里&lt;code class=&quot;language-text&quot;&gt;createConnect&lt;/code&gt;使用了默认参数，分别是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;connectAdvanced&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;defaultMapStateToPropsFactories&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;defaultMapDispatchToPropsFactories&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;defaultMergePropsFactories&lt;/li&gt;
&lt;li&gt;defaultSelectorFactory&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;我们这里先看和&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;相关的&lt;code class=&quot;language-text&quot;&gt;defaultMapStateToPropsFactories&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;defaultMapDispatchToPropsFactories&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; initMapStateToProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      mapStateToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      mapStateToPropsFactories&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token string&quot;&gt;&apos;mapStateToProps&apos;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; initMapDispatchToProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      mapDispatchToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      mapDispatchToPropsFactories&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token string&quot;&gt;&apos;mapDispatchToProps&apos;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;当调用&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;的时候，这里会调用&lt;code class=&quot;language-text&quot;&gt;match&lt;/code&gt;函数，来辨别出我们传入的&lt;code class=&quot;language-text&quot;&gt;mapStateToProps&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;mapDispatchToProps&lt;/code&gt;是函数还是&lt;code class=&quot;language-text&quot;&gt;object&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;arg&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; factories&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; factories&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; factories&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;arg&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; result
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;dispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; options&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;Invalid value of type &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; arg&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; for &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;name&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; argument when connecting component &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;
        options&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;wrappedComponentName
      &lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面就是&lt;code class=&quot;language-text&quot;&gt;match&lt;/code&gt;函数的代码，这里会将我们传入的&lt;code class=&quot;language-text&quot;&gt;map*&lt;/code&gt;函数作为参数，传入给&lt;code class=&quot;language-text&quot;&gt;mapDispatchToPropsFactories&lt;/code&gt;这个工厂函数，我们来这个工厂函数的实现。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; wrapMapToPropsConstant&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; wrapMapToPropsFunc &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./wrapMapToProps&apos;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;whenMapStateToPropsIsFunction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;mapStateToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; mapStateToProps &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;function&apos;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wrapMapToPropsFunc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mapStateToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;mapStateToProps&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;whenMapStateToPropsIsMissing&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;mapStateToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;mapStateToProps &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wrapMapToPropsConstant&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;whenMapStateToPropsIsFunction&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; whenMapStateToPropsIsMissing&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上是&lt;code class=&quot;language-text&quot;&gt;mapStateToPropsFactories&lt;/code&gt;的实现，这里&lt;code class=&quot;language-text&quot;&gt;export&lt;/code&gt;出去的是一个&lt;code class=&quot;language-text&quot;&gt;array&lt;/code&gt;，分别是当&lt;code class=&quot;language-text&quot;&gt;mapStateToProps&lt;/code&gt;是函数和没有传入的时候，最后返回的是&lt;code class=&quot;language-text&quot;&gt;wrapMapToPropsFunc&lt;/code&gt;这个函数包装后的函数。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wrapMapToPropsFunc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;mapToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; methodName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;initProxySelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;dispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; displayName &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里&lt;code class=&quot;language-text&quot;&gt;wrapMapToPropsFuc&lt;/code&gt;，返回值是一个&lt;code class=&quot;language-text&quot;&gt;(dispatch, { displayName}) =&amp;gt; {}&lt;/code&gt;的接口，这里就是工厂函数生成的函数的接口，这个函数也是被&lt;code class=&quot;language-text&quot;&gt;mapDispatchToProps&lt;/code&gt;复用的，生成统一的接口函数。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; bindActionCreators &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;redux&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; wrapMapToPropsConstant&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; wrapMapToPropsFunc &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./wrapMapToProps&apos;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;whenMapDispatchToPropsIsFunction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;mapDispatchToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; mapDispatchToProps &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;function&apos;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wrapMapToPropsFunc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mapDispatchToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;mapDispatchToProps&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;whenMapDispatchToPropsIsMissing&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;mapDispatchToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;mapDispatchToProps
    &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wrapMapToPropsConstant&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;dispatch&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; dispatch &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;whenMapDispatchToPropsIsObject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;mapDispatchToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; mapDispatchToProps &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; mapDispatchToProps &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;object&apos;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wrapMapToPropsConstant&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;dispatch&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;bindActionCreators&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mapDispatchToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dispatch&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;undefined&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  whenMapDispatchToPropsIsFunction&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  whenMapDispatchToPropsIsMissing&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  whenMapDispatchToPropsIsObject
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上是&lt;code class=&quot;language-text&quot;&gt;mapDispatchToProps&lt;/code&gt;的代码，&lt;code class=&quot;language-text&quot;&gt;mapDisptchToProps&lt;/code&gt;支持函数、&lt;code class=&quot;language-text&quot;&gt;Object&lt;/code&gt;、或者不传任何参数，和&lt;code class=&quot;language-text&quot;&gt;mapStateToProps&lt;/code&gt;一样最后也是返回&lt;code class=&quot;language-text&quot;&gt;(dispatch, { options }) =&amp;gt; {}&lt;/code&gt;。在将&lt;code class=&quot;language-text&quot;&gt;map*&lt;/code&gt;函数初始化好之后，后面就是调用一个高阶组件函数，用来接收我们想要从&lt;code class=&quot;language-text&quot;&gt;redux&lt;/code&gt;上获取数据的组件。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;connectHOC&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selectorFactory&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// used in error messages&lt;/span&gt;
      methodName&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;connect&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

      &lt;span class=&quot;token comment&quot;&gt;// used to compute Connect&apos;s displayName from the wrapped component&apos;s displayName.&lt;/span&gt;
      &lt;span class=&quot;token function-variable function&quot;&gt;getDisplayName&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;Connect(&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;name&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

      &lt;span class=&quot;token comment&quot;&gt;// if mapStateToProps is falsy, the Connect component doesn&apos;t subscribe to store state changes&lt;/span&gt;
      shouldHandleStateChanges&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Boolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mapStateToProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

      &lt;span class=&quot;token comment&quot;&gt;// passed through to selectorFactory&lt;/span&gt;
      initMapStateToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      initMapDispatchToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      initMergeProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      pure&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      areStatesEqual&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      areOwnPropsEqual&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      areStatePropsEqual&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      areMergedPropsEqual&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;

      &lt;span class=&quot;token comment&quot;&gt;// any extra options args can override defaults of connect or connectAdvanced&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;extraOptions
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面的代码就是&lt;code class=&quot;language-text&quot;&gt;connect(map1, map2)&lt;/code&gt;的返回值，这里调用了&lt;code class=&quot;language-text&quot;&gt;connectHOC(connectAdvanced)&lt;/code&gt;，我们来看看&lt;code class=&quot;language-text&quot;&gt;connectAdvanced&lt;/code&gt;函数的代码：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;connectAdvanced&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selectorFactory&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;/* options object*/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wrapWithConnect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;WrappedComponent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面的代码是&lt;code class=&quot;language-text&quot;&gt;connectAdvanced&lt;/code&gt;函数的接口和返回值，这里接受&lt;code class=&quot;language-text&quot;&gt;selectorFactory&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;options&lt;/code&gt;设置，这里的&lt;code class=&quot;language-text&quot;&gt;selectorFactory&lt;/code&gt;函数就是将我们在上一步调用初始化好的&lt;code class=&quot;language-text&quot;&gt;map*&lt;/code&gt;函数由&lt;code class=&quot;language-text&quot;&gt;(dispatch, { options }) =&amp;gt; {}&lt;/code&gt;的形式转换为&lt;code class=&quot;language-text&quot;&gt;(stateOrDispatch, ownProps) =&amp;gt; {}&lt;/code&gt;的形式。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;finalPropsSelectorFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token parameter&quot;&gt;dispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; initMapStateToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; initMapDispatchToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; initMergeProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;options &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; mapStateToProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;initMapStateToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; options&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; mapDispatchToProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;initMapDispatchToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; options&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; mergeProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;initMergeProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; options&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;NODE_ENV&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;production&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;verifySubselectors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      mapStateToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      mapDispatchToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      mergeProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      options&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;displayName
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; selectorFactory &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; options&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pure
    &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; pureFinalPropsSelectorFactory
    &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; impureFinalPropsSelectorFactory

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;selectorFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    mapStateToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    mapDispatchToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    mergeProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    dispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    options
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面的代码就是&lt;code class=&quot;language-text&quot;&gt;selectorFactory&lt;/code&gt;函数的实现，这里首先调用了由&lt;code class=&quot;language-text&quot;&gt;map&lt;/code&gt;工厂函数生成的函数，返回的函数就是由&lt;code class=&quot;language-text&quot;&gt;wrapMapToPropsFunc&lt;/code&gt;返回的函数，这里我们来看看&lt;code class=&quot;language-text&quot;&gt;wrapMapToPropsFunc&lt;/code&gt;的实现：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wrapMapToPropsFunc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;mapToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; methodName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;initProxySelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;dispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; displayName &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;proxy&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mapToPropsProxy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;stateOrDispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ownProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; proxy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dependsOnOwnProps
        &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; proxy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mapToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;stateOrDispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ownProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; proxy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mapToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;stateOrDispatch&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// allow detectFactoryAndVerify to get ownProps&lt;/span&gt;
    proxy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dependsOnOwnProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;

    proxy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;mapToProps&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;detectFactoryAndVerify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token parameter&quot;&gt;stateOrDispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      ownProps&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      proxy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mapToProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; mapToProps
      proxy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dependsOnOwnProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getDependsOnOwnProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mapToProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; props &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;proxy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;stateOrDispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ownProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; props &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;function&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        proxy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mapToProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; props
        proxy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dependsOnOwnProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getDependsOnOwnProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        props &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;proxy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;stateOrDispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ownProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;NODE_ENV&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;production&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;verifyPlainObject&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; displayName&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; methodName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; props
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; proxy
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里的&lt;code class=&quot;language-text&quot;&gt;wrapMapToPropsFunc&lt;/code&gt;最终返回的是一个&lt;code class=&quot;language-text&quot;&gt;proxy&lt;/code&gt;函数，这个函数的接口是&lt;code class=&quot;language-text&quot;&gt;(dispatchOrState, ownProps) =&amp;gt; {}&lt;/code&gt;，这也我们的&lt;code class=&quot;language-text&quot;&gt;map*&lt;/code&gt;函数的接口相同，这里&lt;code class=&quot;language-text&quot;&gt;proxy&lt;/code&gt;函数主要是处理在第一次运行的时候，如果我们提供的&lt;code class=&quot;language-text&quot;&gt;map*&lt;/code&gt;函数的返回值是&lt;code class=&quot;language-text&quot;&gt;map&lt;/code&gt;函数这种情况，另外就是检测最后我们提供的&lt;code class=&quot;language-text&quot;&gt;map*&lt;/code&gt;函数的返回值是一个&lt;code class=&quot;language-text&quot;&gt;plain object&lt;/code&gt;的情况。&lt;/p&gt;
&lt;p&gt;在拿到真正的&lt;code class=&quot;language-text&quot;&gt;map*&lt;/code&gt;函数后，会判断传入的&lt;code class=&quot;language-text&quot;&gt;options&lt;/code&gt;中&lt;code class=&quot;language-text&quot;&gt;pure&lt;/code&gt;的值来决定使用哪一个&lt;code class=&quot;language-text&quot;&gt;SelectorFactory&lt;/code&gt;函数，默认情况下会使用&lt;code class=&quot;language-text&quot;&gt;pureFinalPropsSelectorFactory&lt;/code&gt;，如果&lt;code class=&quot;language-text&quot;&gt;pure&lt;/code&gt;为&lt;code class=&quot;language-text&quot;&gt;false&lt;/code&gt;的话会使用&lt;code class=&quot;language-text&quot;&gt;impureFinalPropsSelectorFactory&lt;/code&gt;，前一个函数缓存了前一次的&lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;ownProps&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;stateProps&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;dispatchProps&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;mergedProps&lt;/code&gt;，在第一次调用&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;的时候，会设置好缓存，在后续的调用中会比较缓存，如果缓存的引用没变，就不会调用&lt;code class=&quot;language-text&quot;&gt;map*&lt;/code&gt;函数生成新的&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;。具体的实现代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pureFinalPropsSelectorFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token parameter&quot;&gt;mapStateToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  mapDispatchToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  mergeProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  dispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; areStatesEqual&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; areOwnPropsEqual&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; areStatePropsEqual &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; hasRunAtLeastOnce &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; state
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; ownProps
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; stateProps
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; dispatchProps
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; mergedProps

  &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleFirstCall&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;firstState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; firstOwnProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; firstState
    ownProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; firstOwnProps
    stateProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mapStateToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ownProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    dispatchProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mapDispatchToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ownProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    mergedProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mergeProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;stateProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dispatchProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ownProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    hasRunAtLeastOnce &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; mergedProps
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleNewPropsAndNewState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    stateProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mapStateToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ownProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mapDispatchToProps&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dependsOnOwnProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      dispatchProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mapDispatchToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ownProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    mergedProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mergeProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;stateProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dispatchProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ownProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; mergedProps
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleNewProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mapStateToProps&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dependsOnOwnProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      stateProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mapStateToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ownProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mapDispatchToProps&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dependsOnOwnProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      dispatchProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mapDispatchToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ownProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    mergedProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mergeProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;stateProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dispatchProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ownProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; mergedProps
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleNewState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; nextStateProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mapStateToProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ownProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; statePropsChanged &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;areStatePropsEqual&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextStateProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; stateProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    stateProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextStateProps

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;statePropsChanged&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      mergedProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mergeProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;stateProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dispatchProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ownProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; mergedProps
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleSubsequentCalls&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;nextState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nextOwnProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; propsChanged &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;areOwnPropsEqual&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextOwnProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ownProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; stateChanged &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;areStatesEqual&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextState
    ownProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextOwnProps

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;propsChanged &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; stateChanged&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleNewPropsAndNewState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;propsChanged&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleNewProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;stateChanged&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleNewState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; mergedProps
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pureFinalPropsSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;nextState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nextOwnProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; hasRunAtLeastOnce
      &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleSubsequentCalls&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nextOwnProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleFirstCall&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nextOwnProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上是&lt;code class=&quot;language-text&quot;&gt;pureFinalPropsSelectorFactory&lt;/code&gt;的实现，这里在第一次调用的时候产生一份缓存，后续的调用会检查缓存。&lt;/p&gt;
&lt;p&gt;上面的一连串过程就是&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;如何产生，以及&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;的刷新过程。简要的来说，这里的几个不同的&lt;code class=&quot;language-text&quot;&gt;factory&lt;/code&gt;函数，主要的工作是统一接口，校验传进来的参数，函数接口的转换形式如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;dispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; options&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;mapOrDispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ownProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; finalProps&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面就是这几个&lt;code class=&quot;language-text&quot;&gt;factory&lt;/code&gt;函数的主要工作。&lt;/p&gt;
&lt;p&gt;我们继续来看&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;后续的代码的主要工作是返回一个高阶组件来包装我们的组件：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;connectAdvanced&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selectoryFactory&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
	&lt;span class=&quot;token comment&quot;&gt;/*options object*/&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;withConnect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;WrappedComponent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里对这个高阶组件做了几个小的处理，一是对于&lt;code class=&quot;language-text&quot;&gt;forwardRef&lt;/code&gt;的处理，而是对&lt;code class=&quot;language-text&quot;&gt;Context&lt;/code&gt;的处理。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;forwardRef&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; forwarded &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forwardRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;forwardConnectRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;token parameter&quot;&gt;props&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        ref&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Connect wrapperProps&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; forwardedRef&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;ref&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

      forwarded&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;displayName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; displayName
      forwarded&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WrappedComponent &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; WrappedComponent
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;hoistStatics&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;forwarded&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; WrappedComponent&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，如果&lt;code class=&quot;language-text&quot;&gt;forwardRef&lt;/code&gt;为&lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;的时候，这个时候，会讲&lt;code class=&quot;language-text&quot;&gt;ref&lt;/code&gt;挂到&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;包的底层组件上；另外就是对&lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt;的处理了&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; ContextToUse &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Consumer &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
          &lt;span class=&quot;token function&quot;&gt;isContextConsumer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Consumer &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context
            &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Context

        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ContextToUse&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Consumer&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;indirectRenderWrappedComponent&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;ContextToUse&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Consumer&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;的第三个参数支持注入我们自己的&lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt;，如上的代码，如果我们在&lt;code class=&quot;language-text&quot;&gt;mergeProps&lt;/code&gt;中注入了我们自己的&lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt;，会优先使用我们自己的&lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt;，否则就使用&lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt;上提供的&lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt;。在之前讲的到，&lt;code class=&quot;language-text&quot;&gt;selectorFactory&lt;/code&gt;会讲&lt;code class=&quot;language-text&quot;&gt;wrapMapToProps&lt;/code&gt;包装后的函数&lt;code class=&quot;language-text&quot;&gt;(dispatch, options) =&amp;gt; {}&lt;/code&gt; 转换为&lt;code class=&quot;language-text&quot;&gt;(stateOrDispatch, ownProps) =&amp;gt; {}&lt;/code&gt;。在代码里的体现如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; ContextToUse &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Consumer &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
          &lt;span class=&quot;token function&quot;&gt;isContextConsumer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Consumer &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;context
            &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Context

        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ContextToUse&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Consumer&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;indirectRenderWrappedComponent&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;ContextToUse&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Consumer&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;	&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;render&lt;/code&gt;方法中，调用了&lt;code class=&quot;language-text&quot;&gt;this.indirectRenderWrappedComponent&lt;/code&gt;，这个方法实际上就是&lt;code class=&quot;language-text&quot;&gt;makeDerivedPropsSelector&lt;/code&gt;返回的函数，我们来看看这个方法的代码：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;makeDerivedPropsSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; lastProps
      &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; lastState
      &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; lastDerivedProps
      &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; lastStore
      &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; lastSelectorFactoryOptions
      &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; sourceSelector

      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;selectDerivedProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;token parameter&quot;&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        props&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        store&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        selectorFactoryOptions&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pure &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; lastProps &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; props &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; lastState &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; lastDerivedProps
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          store &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; lastStore &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt;
          lastSelectorFactoryOptions &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; selectorFactoryOptions
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          lastStore &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; store
          lastSelectorFactoryOptions &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; selectorFactoryOptions
          sourceSelector &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;selectorFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            store&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            selectorFactoryOptions
          &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        lastProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; props
        lastState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; state

        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; nextProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sourceSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        lastDerivedProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextProps
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; lastDerivedProps
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;可以看到在第一次运行，更换&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;或更换&lt;code class=&quot;language-text&quot;&gt;selectorFactoryOptions&lt;/code&gt;的时候，会重新获取&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;selectorFactoryOptions&lt;/code&gt;，这块函数就是每次&lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt;刷新或者&lt;code class=&quot;language-text&quot;&gt;props change&lt;/code&gt;的时候，调用当前的&lt;code class=&quot;language-text&quot;&gt;map*&lt;/code&gt;函数，生成新的&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;或者是使用旧的&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;。最后调用&lt;code class=&quot;language-text&quot;&gt;makeChildElementSelector&lt;/code&gt;将计算好的props，要渲染的组件，以及要转发的&lt;code class=&quot;language-text&quot;&gt;ref&lt;/code&gt;传进去，可以看到这里的刷新也是有一层缓存的，如果传入的这些东西还是上一次的话，这里还是会返回上一次渲染的组件。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;   &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;makeChildElementSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; lastChildProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; lastForwardRef&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; lastChildElement&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; lastComponent

      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;selectChildElement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;token parameter&quot;&gt;WrappedComponent&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        childProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        forwardRef&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          childProps &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; lastChildProps &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt;
          forwardRef &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; lastForwardRef &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt;
          lastComponent &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; WrappedComponent
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          lastChildProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; childProps
          lastForwardRef &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; forwardRef
          lastComponent &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; WrappedComponent
          lastChildElement &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;WrappedComponent &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;childProps&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; ref&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;forwardRef&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; lastChildElement
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在没有转发&lt;code class=&quot;language-text&quot;&gt;ref&lt;/code&gt;的情况下，&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;组件会返回：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;   &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;hoistStatics&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Connect&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; WrappedComponent&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里的&lt;code class=&quot;language-text&quot;&gt;hoistStatics&lt;/code&gt;函数是为了将&lt;code class=&quot;language-text&quot;&gt;WrapperComponent&lt;/code&gt;上的静态属性复制到&lt;code class=&quot;language-text&quot;&gt;Connect&lt;/code&gt;的组件上；原因在于，如果原始的组件上有一个静态方法，在&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;之后的组件暴露出去用的时候，这个组件实际上是访问不到的，所以要把一些静态属性拷到高阶组件上去。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;兴趣遍地都是，坚持和持之以恒才是稀缺的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[如何使用React—Redux]]></title><description><![CDATA[在构建基于的应用的时候，我们往往需要使用做数据绑定，当中的数据刷新的时候，通知所有用到数据的组建刷新，提供了对组件的订阅发布的能力。 我们为什么需要React-Redux…]]></description><link>http://cuteshilina.com/2019-1-19-HowReactReduxWorks/</link><guid isPermaLink="false">http://cuteshilina.com/2019-1-19-HowReactReduxWorks/</guid><pubDate>Sat, 19 Jan 2019 17:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在构建基于&lt;code class=&quot;language-text&quot;&gt;Redux&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt;应用的时候，我们往往需要使用&lt;code class=&quot;language-text&quot;&gt;React-Redux&lt;/code&gt;做数据绑定，当&lt;code class=&quot;language-text&quot;&gt;Redux&lt;/code&gt;中的数据刷新的时候，通知所有用到数据的组建刷新，&lt;code class=&quot;language-text&quot;&gt;React-Redux&lt;/code&gt;提供了对&lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt;组件的订阅发布的能力。&lt;/p&gt;
&lt;h2 id=&quot;我们为什么需要react-redux&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%88%91%E4%BB%AC%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81react-redux&quot; aria-label=&quot;我们为什么需要react redux permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;我们为什么需要React-Redux&lt;/h2&gt;
&lt;p&gt;如果你熟悉&lt;code class=&quot;language-text&quot;&gt;Redux&lt;/code&gt;的话，我们知道在&lt;code class=&quot;language-text&quot;&gt;Redux&lt;/code&gt;中我们会维护一个全局的&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;中存储了当前&lt;code class=&quot;language-text&quot;&gt;App&lt;/code&gt;中的数据，如果组件需要使用&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;中的数据，有两种办法，第一种是一层一层将&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;传下去，组件从&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;上去取&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;，然后取自己要用到的数据，很显然，这不是一个好的办法，如果存在一个嵌套很深的组件，那么&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;会从最顶层传到最下面，这对于代码的维护和可读性并不是很友好；第二种办法就是使用&lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt;提供的&lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt;，在要使用全局状态的时候，从&lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt;上去取，但是在&lt;code class=&quot;language-text&quot;&gt;React 16.4.0&lt;/code&gt;之前，&lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt;官方是不推荐使用&lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt;的，原因在于，当&lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt;中的值刷新的时候，是从上到下刷新的，如果中间有组件的&lt;code class=&quot;language-text&quot;&gt;shouldComponentUpdate&lt;/code&gt;返回了&lt;code class=&quot;language-text&quot;&gt;false&lt;/code&gt;，这个组件下面的组件就收不到更新后的值；而&lt;code class=&quot;language-text&quot;&gt;React-Redux&lt;/code&gt;实现了订阅发布的模式，保证使用了&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;的组件在数据更新的时候可以得到通知。&lt;/p&gt;
&lt;p&gt;在&lt;code class=&quot;language-text&quot;&gt;React 16.4.0&lt;/code&gt;之后官方将&lt;code class=&quot;language-text&quot;&gt;createContext&lt;/code&gt;暴露出来了，以上的问题不会出现，但是是不是意味着，可以用&lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt;来替代&lt;code class=&quot;language-text&quot;&gt;redux&lt;/code&gt;呢？理论上是可以的，但是并不推荐这样做，因为在&lt;code class=&quot;language-text&quot;&gt;redux&lt;/code&gt;的发展中，其生态系统是非常繁荣的，用&lt;code class=&quot;language-text&quot;&gt;Redux&lt;/code&gt;能避免重复造轮子的窘境。&lt;/p&gt;
&lt;h2 id=&quot;react-redux给我们提供了哪些能力？&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#react-redux%E7%BB%99%E6%88%91%E4%BB%AC%E6%8F%90%E4%BE%9B%E4%BA%86%E5%93%AA%E4%BA%9B%E8%83%BD%E5%8A%9B%EF%BC%9F&quot; aria-label=&quot;react redux给我们提供了哪些能力？ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;React Redux给我们提供了哪些能力？&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Container 组件和Presentational组件&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt;背后的思想是&lt;code class=&quot;language-text&quot;&gt;UI组件&lt;/code&gt;是一个函数，一个大的&lt;code class=&quot;language-text&quot;&gt;Web App&lt;/code&gt;就是一个由不同函数组成的大的函数；在处理这些组件时，我们遵循这样一个原则，根据职责将组件分为&lt;code class=&quot;language-text&quot;&gt;container组件&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;presentational&lt;/code&gt;组件，前者负责提供数据，后者接受数据，只负责展示；对于后者是对&lt;code class=&quot;language-text&quot;&gt;redux&lt;/code&gt;无感的，只负责从&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;上取数据，然后渲染。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;react-redux&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;函数就提供了生成一个&lt;code class=&quot;language-text&quot;&gt;container&lt;/code&gt;组件负责和&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;进行交互，我们自己的组件就只用负责渲染就可以，数据的交互不用操心；&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;将数据的来源抽象出来，使得我们的组件复用性更好。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;React-Redux的性能优化&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;虽然&lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt;在数据更新的时候有着很好的性能，每次&lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt;刷新的时候是从父组件渲染到叶子组件，这里带来的问题就是，在子组件中数据没有发生变化，但是却重复渲染了，这种问题积少成多会导致性能问题，&lt;code class=&quot;language-text&quot;&gt;react redux&lt;/code&gt;在其内部提供了对应的性能优化，当组件的数据没有发生变化的时候，这个组件并不会重新渲染。&lt;/p&gt;
&lt;h2 id=&quot;如何使用react-redux&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8react-redux&quot; aria-label=&quot;如何使用react redux permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;如何使用React Redux&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;react-redux&lt;/code&gt;的核心&lt;code class=&quot;language-text&quot;&gt;API&lt;/code&gt;就三个，经常使用到的就两个，分别是：
- &lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;
- &lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt;
- &lt;code class=&quot;language-text&quot;&gt;ConnectAdvanced&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;这里先来说说&lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt;的用法，简单来说就是&lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt;是一个容器组件，在你需要使用&lt;code class=&quot;language-text&quot;&gt;react redux&lt;/code&gt;管理你的&lt;code class=&quot;language-text&quot;&gt;redux store&lt;/code&gt;的时候，将你的&lt;code class=&quot;language-text&quot;&gt;App&lt;/code&gt;用&lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt;包起来，这样&lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt;下的所有组件都可以通过&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;来获取&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;上存储的数据了。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Component &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; render &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react-dom&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Provider &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react-redux&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Counter &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./demos/reactReduxDemo/counter&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; counterStore &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./demos/reactReduxDemo/configStore&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;App&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Provider store&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;counterStore&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 将store注入到Provider中&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Counter &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Provider&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;App &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;root&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，我们将&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;注入到组件中，当数据发生变化的时候，会通知&lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt;下的所有订阅了&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;的组件更新。&lt;/p&gt;
&lt;p&gt;在我们将&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;注入之后，其下的组件如果需要使用&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;中的数据，就需要使用&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;这个&lt;code class=&quot;language-text&quot;&gt;API&lt;/code&gt;。
&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;其实就是一个高阶组件（传入一个组件，返回一个组件），这里&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;的接口参数如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;	&lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mapStateToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mapDispatchToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mergeProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; options&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里的&lt;code class=&quot;language-text&quot;&gt;mapStateToProps&lt;/code&gt;主要是用来从&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;中获取数据的函数，这里的函数接口如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;	&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;mapStateToProps&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ownProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上这里的&lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;就是&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;，在&lt;code class=&quot;language-text&quot;&gt;mapStateProps&lt;/code&gt;中我们可以拿到整个应用的数据，在&lt;code class=&quot;language-text&quot;&gt;mapStateToProps&lt;/code&gt;中可以拿到我们需要的数据，另外一个参数&lt;code class=&quot;language-text&quot;&gt;ownProps&lt;/code&gt;是父组件传给子组件的&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;。
另外一个函数&lt;code class=&quot;language-text&quot;&gt;mapDispatchToProps&lt;/code&gt;，这里的函数的参数接口如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;	&lt;span class=&quot;token function-variable function&quot;&gt;mapDispatchToProps&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;dispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ownProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上这里的&lt;code class=&quot;language-text&quot;&gt;dispatch&lt;/code&gt;就是&lt;code class=&quot;language-text&quot;&gt;redux&lt;/code&gt;中的&lt;code class=&quot;language-text&quot;&gt;dispatch&lt;/code&gt;，当我们需要改变&lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;的时候，就需要&lt;code class=&quot;language-text&quot;&gt;dispatch action&lt;/code&gt;，在&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;中如果没有传入&lt;code class=&quot;language-text&quot;&gt;mapDispatchToProps&lt;/code&gt;的话，会将&lt;code class=&quot;language-text&quot;&gt;dispatch&lt;/code&gt;作为&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;传入组件；&lt;code class=&quot;language-text&quot;&gt;mapDispatchToProps&lt;/code&gt;的函数的返回值是一个&lt;code class=&quot;language-text&quot;&gt;object&lt;/code&gt;，函数的&lt;code class=&quot;language-text&quot;&gt;value&lt;/code&gt;就是一个&lt;code class=&quot;language-text&quot;&gt;action creator&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;	&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;mapDispatchToProps&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token function-variable function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;myAcion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;payload&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，这里的&lt;code class=&quot;language-text&quot;&gt;foo&lt;/code&gt;在组件中可以通过&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;访问到，这里最好将组件中的&lt;code class=&quot;language-text&quot;&gt;action creator&lt;/code&gt;放在&lt;code class=&quot;language-text&quot;&gt;mapDispatchToProps&lt;/code&gt;中，不要暴露&lt;code class=&quot;language-text&quot;&gt;dispatch&lt;/code&gt;到组件中，避免将&lt;code class=&quot;language-text&quot;&gt;redux&lt;/code&gt;暴露给组件中，这样组件对&lt;code class=&quot;language-text&quot;&gt;redux&lt;/code&gt;是无感的，组件的复用性更高。
如下，如果一个组件需要从&lt;code class=&quot;language-text&quot;&gt;store&lt;/code&gt;上获取数据，使用&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;将组件包起来：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;	&lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MyComponent&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
		mapState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		mergeProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		options&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MyComponent&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上的方式使用&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;MyComponent&lt;/code&gt;中的&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;就可以拿到&lt;code class=&quot;language-text&quot;&gt;dispatch&lt;/code&gt;。
就像上面说的，并不推荐直接将&lt;code class=&quot;language-text&quot;&gt;dispatch&lt;/code&gt;直接传给组件，将&lt;code class=&quot;language-text&quot;&gt;action creator&lt;/code&gt;包装成一个函数传给组件：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;	&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;mapStateToProps&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	
	&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;mapDispatchToProps&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token function-variable function&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;type&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;	INCREASE&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
			&lt;span class=&quot;token function-variable function&quot;&gt;decrement&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;type&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;DESCREASE&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mapStateToProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mapDispatchToProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MyComponent&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ConnectAdvanced&lt;/code&gt;是&lt;code class=&quot;language-text&quot;&gt;react-redux&lt;/code&gt;提供的最后一个&lt;code class=&quot;language-text&quot;&gt;API&lt;/code&gt;，这个&lt;code class=&quot;language-text&quot;&gt;API&lt;/code&gt;是5.0之后提供的，这个方法主要是提供定制化的&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;，由开发者自己实现缓存和&lt;code class=&quot;language-text&quot;&gt;props check&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;内部就是使用&lt;code class=&quot;language-text&quot;&gt;connectAdvanced&lt;/code&gt;实现，它也是一个高阶组件，其函数接口如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;	&lt;span class=&quot;token function&quot;&gt;connectAdvanced&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selectorFactory&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; connectOptions&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，其中的&lt;code class=&quot;language-text&quot;&gt;selectorFactory&lt;/code&gt;就是产生&lt;code class=&quot;language-text&quot;&gt;mapStateToProps + mapDispatchToProps&lt;/code&gt;的工厂函数，起接口及其作用如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;	&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;dispatch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; options&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;nextState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nextOwnProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; nextFinalProps&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;我们会在&lt;code class=&quot;language-text&quot;&gt;(dispatch, options) =&amp;gt; {}&lt;/code&gt;这一层将我们的&lt;code class=&quot;language-text&quot;&gt;action creator&lt;/code&gt;函数以及最终传给组件的&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;对象创建好，在第二层闭包&lt;code class=&quot;language-text&quot;&gt;nextState, nextOwnProps&lt;/code&gt;中会在&lt;code class=&quot;language-text&quot;&gt;redux state&lt;/code&gt;刷新的时候拿到最新的&lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;，在这一层会做缓存的命中，如果最新的&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;中变更的数据影响当前组件，会更新在第一层闭包中缓存好的最终需要传给组件的&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;	&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; actionCreators &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./actionCreators&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; bindActionCreators &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;redux&apos;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;selectorFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; ownProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; actions &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bindActionCreators&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;actionCreators&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dispatch&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;addTodo&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;text&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; actions&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addTodo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ownProps&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; text&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;nextState&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nextOwnProps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; todos &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextState&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;todos&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;nextOwnProps&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;userId&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; nextResult &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;nextOwnProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; todos&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; addTodo &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    ownProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextOwnProps
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;shallowEqual&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nextResult&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextResult
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; result
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;connectAdvanced&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;selectorFactory&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;TodoApp&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;兴趣遍地都是，坚持和持之以恒才是稀缺的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[我是怎样构建自己的时间管理系统的]]></title><description><![CDATA[…]]></description><link>http://cuteshilina.com/2019-1-12-HowToBuildYourOwnTimeSystem/</link><guid isPermaLink="false">http://cuteshilina.com/2019-1-12-HowToBuildYourOwnTimeSystem/</guid><pubDate>Sat, 12 Jan 2019 17:00:00 GMT</pubDate><content:encoded>&lt;p&gt;工作之后，自己的个人时间就变的少了，不像上学的时候那样有很多时间能自由安排，刚参加工作的时候自己的时间管理更是混乱，经常性的就是觉得这个周什么都没干，一个周就过去了，做事学东西也没有一个好的进度和时间的跟踪，在意识到这个问题之后，决定改变这个不好的习惯，自己也建立了一套自己的时间管理系统，很好的改善了当前的情况。这里主要是介绍自己的一些使用的工具，以及如何使用这些应用规划自己的时间。&lt;/p&gt;
&lt;h2 id=&quot;google-calendar&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#google-calendar&quot; aria-label=&quot;google calendar permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Google Calendar&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://zh.wikipedia.org/wiki/Google%E6%97%A5%E6%9B%86&quot;&gt;Google Calendar&lt;/a&gt;是&lt;code class=&quot;language-text&quot;&gt;Google&lt;/code&gt;出品的日历应用，用来管理时间和活动
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 51.35135135135135%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjUlEQVQoz31T2U7DMBDM9/IN/ALfAA8I1AdeoUIcEiWolaBcFVQchUq9L9qmSez4GNZxnKCCsLTajdc7Ozt2PMY4RiuGXsCxYBJaKUipoFIvU+9MZiaEzPPGqAidmUDEFbyYMdwPQ1T7EdrLBJTNAbT+K9Z5nHoy08TU0Qa8RAj7YZa2h93B9diB/corA2r3PDOyzjrojIH6yUDp/xlm3pHxeJIg4AJBohCLYgxXvA5YsCpiTlNy0l0oA8g5jt5mKL0s8Di1GgrX1erwS0/XxGoHlD9W2KrPsd2MDGCC5iTC3TjGIJRwiyfEmm4/ikWhndJ5XmurG6CwV+liY+cVm6V3C+guJaTRr3sBHmYJ2uMQn59T9IerTGNqQpLU+wFuRgyTWOZ1jecpTk7b8K+6dmQhbcEoFNhtjHHwvoLfi1BuzXE54PA7Sxy2FqgNOUpPE+y/LHHRjXDc+sJ5JwbTBfOUoXtHC3qYPgFUqfB2zHHWZbgaMNxkcZ18bUQNaO92wnHRZ6iQBVymcpgf4ht22gO2Vj4FvgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;googleCalendar&quot;
        title=&quot;googleCalendar&quot;
        src=&quot;/static/6fe0ae8640803e18406d22c9d5efec39/fcda8/googleCalendar.png&quot;
        srcset=&quot;/static/6fe0ae8640803e18406d22c9d5efec39/12f09/googleCalendar.png 148w,
/static/6fe0ae8640803e18406d22c9d5efec39/e4a3f/googleCalendar.png 295w,
/static/6fe0ae8640803e18406d22c9d5efec39/fcda8/googleCalendar.png 590w,
/static/6fe0ae8640803e18406d22c9d5efec39/efc66/googleCalendar.png 885w,
/static/6fe0ae8640803e18406d22c9d5efec39/511f0/googleCalendar.png 1172w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
如果你给自己制定了固定的计划，像我每周一周四会去健身房健身，一开始没使用&lt;code class=&quot;language-text&quot;&gt;Google Calendar&lt;/code&gt;的时候，经常性的忘记或者不想去，使用&lt;code class=&quot;language-text&quot;&gt;Google Calendar&lt;/code&gt;将这些活动安排到一个固定的时间，包括一个周哪几天要去健身，跑步从几点开始到几点结束，都可以安排到&lt;code class=&quot;language-text&quot;&gt;Google Calendar&lt;/code&gt;的活动中，我一般是在活动开始的前半小时发消息通知，提前收拾东西出门；但是关键还是自己得执行，将自己的固定的活动安排到&lt;code class=&quot;language-text&quot;&gt;Google Calendar&lt;/code&gt;上，一是为了记录自己的执行情况，二是到了时间点做什么事有&lt;code class=&quot;language-text&quot;&gt;Calendar&lt;/code&gt;督促你，“变相”的提高自己的执行力；另外在周末的时候，头一天晚上或者当天早上可以通过&lt;code class=&quot;language-text&quot;&gt;Google Calendar&lt;/code&gt;安排今天或者明天要干的事，不至于一到周末就在床上躺一天，当然周末如果有聚会的话，我也会考虑在这个时间里，如果是很突然的聚会，和我安排的活动重叠的话，我会优先完成自己安排的活动，拒绝不必要的聚会。&lt;code class=&quot;language-text&quot;&gt;Google Calendar&lt;/code&gt;在我的时间管理系统中承担了“管家”的作用，基本上一些活动和时间安排我都会交给他。&lt;/p&gt;
&lt;h2 id=&quot;ifttt&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ifttt&quot; aria-label=&quot;ifttt permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;IFTTT&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;IFTTT&lt;/code&gt;是一个整合了各种主流应用&lt;code class=&quot;language-text&quot;&gt;Web Service&lt;/code&gt;的应用，主要的用途就是做触发器，怎么理解这个应用的应用场景呢？比如你在&lt;code class=&quot;language-text&quot;&gt;Instgram&lt;/code&gt;上上传了图片，但是重所周知的原因，国内上不了&lt;code class=&quot;language-text&quot;&gt;Ins&lt;/code&gt;，这时候你就得把图片在微博上又发一遍，这其实是个相当低效的操作，那么这时候你就可以使用&lt;code class=&quot;language-text&quot;&gt;IFTTT&lt;/code&gt;来定制你的触发器，当在&lt;code class=&quot;language-text&quot;&gt;Instgram&lt;/code&gt;上发图片之后，&lt;code class=&quot;language-text&quot;&gt;IFTTT&lt;/code&gt;将请求微博提供的对应接口将这个&lt;code class=&quot;language-text&quot;&gt;post&lt;/code&gt;中的图片在你的微博上发一遍。
我用&lt;code class=&quot;language-text&quot;&gt;IFTTT&lt;/code&gt;的主要目的是转发&lt;code class=&quot;language-text&quot;&gt;Google Calendar&lt;/code&gt;上的通知到我手机上，因为&lt;code class=&quot;language-text&quot;&gt;Google Calendar&lt;/code&gt;在不挂梯子的情况下收不到通知。&lt;code class=&quot;language-text&quot;&gt;IFTTT&lt;/code&gt;支持的主流应用还是国外的居多，整体的运行逻辑就是：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;condition &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		then &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; something
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;最好用的是，满足这个触发器的执行条件之后的操作也可以触发其他的触发器，这样就将平时一些流水线的任务串起来，你要做的就是按下开关。&lt;/p&gt;
&lt;h2 id=&quot;trello&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#trello&quot; aria-label=&quot;trello permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Trello&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 45.94594594594595%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABoElEQVQoz52RSy+jURzG3y9BsCAu3QzJrHwPiQ3xBUxiwbi3FjT2YoEQsxgsdMHQkUq1imr0rm+v2rfVMp0Q0UxMwySqnd+cFyESkZiTPP/nLM755XnOkaZMAYzOIzY8Sb67FUzeJPNbIVYcYbbkDJu+YyyBNMsOhVlLhHVvGqPQuieN6fCE1kk7mj4jH3Umarq/IekNTiZXHcxt+pk3H/LF7GdiI8hXWxSDI86KM8WaK8WCXSETi8NVDv4idKcOupYClPeY0Wi3qR20IFUNbFPR/1JVQpXqvu/Byz5bqR/ZJeyNkPt5xPl1jkKhJHhFOheDlPdaadDtUqfdQaoX4y016HaoHbbRNGYnLifIZv0cX6Up3gcs8mlRFkDL0zlJpdZpbTz466oZstEogDFflOypl0z+hFJRAFGBwSfgfcK3QC+Ao3vEZIWLHyESv5Lc3ZZEwIKoLD9Wfifwg0iYcMpcKgcov1NqW7FK/5+wSb9PeM9FxmclfBblJn/N7Z88nQuB9ydUH1sjLrRMe2ib89Ou+oyLjlk3zeN2qoee/+Af/cT0cfPHEncAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;trello&quot;
        title=&quot;trello&quot;
        src=&quot;/static/b4d9dafbfdc16045b0cfddb40c7ac5ef/fcda8/trello.png&quot;
        srcset=&quot;/static/b4d9dafbfdc16045b0cfddb40c7ac5ef/12f09/trello.png 148w,
/static/b4d9dafbfdc16045b0cfddb40c7ac5ef/e4a3f/trello.png 295w,
/static/b4d9dafbfdc16045b0cfddb40c7ac5ef/fcda8/trello.png 590w,
/static/b4d9dafbfdc16045b0cfddb40c7ac5ef/efc66/trello.png 885w,
/static/b4d9dafbfdc16045b0cfddb40c7ac5ef/23592/trello.png 1031w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
&lt;code class=&quot;language-text&quot;&gt;Trello&lt;/code&gt;是一款看板应用，具体的介绍可以看维基百科 &gt;  &lt;a href=&quot;https://zh.wikipedia.org/wiki/Trello&quot;&gt;Trello&lt;/a&gt;，&lt;code class=&quot;language-text&quot;&gt;Trello&lt;/code&gt;的作者这位老哥很厉害，是&lt;code class=&quot;language-text&quot;&gt;StackOverflow&lt;/code&gt;的创始人之一，同时你一定或多或少看到过他的文章，他的博客&lt;a href=&quot;https://www.joelonsoftware.com/&quot;&gt;Joel On Software&lt;/a&gt;的一些文章和观点会被国内的开发人员翻译，不得不说，&lt;code class=&quot;language-text&quot;&gt;Joel&lt;/code&gt;老哥给程序员这个群体树立了一个好的榜样，国内说实话IT这个行业是真的浮躁，动不动毕业生年薪要求大几十万，人工智能火，就一窝蜂的涌去人工智能，区块链火，就去搞区块链，程序员干到30岁就要转行，与其每天去焦虑这些问题，不如做好自己手头上的事。
一般来说我会在月初的时候制定好这个月要完成的事，然后落实到具体每天的时候，会将这些任务拆分成更小的粒度，这里的话只要每个月分配的量合理，基本上这个月能有条不紊的到达自己的目标，其实这套流程也是工作中接触到敏捷开发，将敏捷开发这一套迁移到我自己的学习生活中；另外，在工作中我会使用&lt;code class=&quot;language-text&quot;&gt;Trello&lt;/code&gt;来安排自己工作上的事，现在工作日一般是早上来到公司后，开完晨会，花点时间将今天要做的事拆一下，以日期为&lt;code class=&quot;language-text&quot;&gt;Card&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;Label&lt;/code&gt;，将今天要做的事情做成一个&lt;code class=&quot;language-text&quot;&gt;ToDo List&lt;/code&gt;，完成一项就划掉一项。这样对于完成的工作和未完成的工作有一个记录，最大的作用是在没周发周报的时候就不用痛苦的去回忆上一周干了啥，直接打开&lt;code class=&quot;language-text&quot;&gt;Trello&lt;/code&gt;就知道这周具体完成了哪些，遗留了哪些，也算是变相的省了时间。&lt;/p&gt;
&lt;h2 id=&quot;番茄钟&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%95%AA%E8%8C%84%E9%92%9F&quot; aria-label=&quot;番茄钟 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;番茄钟&lt;/h2&gt;
&lt;p&gt;前段时间读了&lt;a href=&quot;https://book.douban.com/subject/26835090/&quot;&gt;软技能&lt;/a&gt;这本书，中间提到了番茄管理法，以前也听过这个，但是并没有深入的去了解这个东西，自己认为是属于那种理想很美好，现实很骨感的东西，后面读完这本书，作者在谈到自己和自己朋友使用番茄工作法，如何以番茄钟来计算自己每天的工作量，同时像学习和编码这种需要很强专注力的工作的时候，如何提高和改善自己的专注力，也是一个技术活；一个番茄钟是25分钟，每一个番茄钟之后有5分钟的休息时间，四个番茄钟之后是一个长的&lt;code class=&quot;language-text&quot;&gt;break&lt;/code&gt;15分钟，这是番茄工作法的原则；我没有找到理论依据，但是在实践了一段时间之后，自己做事的效率确实有一定的提高；同时对于工作安排的时间也不像以前一样，想着大不了加班搞搞，刚入职的时候抱着这种心态，没有少加班，就是因为想着大不了加加班，工作时间内搞的时候不专注，寄希望于加班，一般来说我给自己规定每天工作时间是6到8个番茄钟，在这几个番茄钟专注的去做事情，效率有很大的提高。
番茄钟的应用很多，手机上的就不推荐了，自己去应用商店找一个自己喜欢的，最好电脑上也装一个，这里我推荐可以用用&lt;a href=&quot;https://chrome.google.com/webstore/detail/cherry-tomato/cghomilbbfdmgfidkdinillpmdpdjgmm&quot;&gt;Cherry Tomato&lt;/a&gt;，做的不错的一个应用，&lt;code class=&quot;language-text&quot;&gt;Chrome&lt;/code&gt;的扩展应用，免安装。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;兴趣遍地都是，坚持和持之以恒才是稀缺的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[如何使用Reselect做性能优化]]></title><description><![CDATA[TL;DR; 在、的应用中，使用来做性能优化是常见的优化手段 默认只有一份，命中的策略是浅比较，引用改变了会导致失效 支持定制函数和命中策略 在开发前端应用的时候，我们经常会使用做状态管理，但是随着前端代码的复杂度的上升，会引入作为性能优化的手段之一，这篇文章就Reselect…]]></description><link>http://cuteshilina.com/2018-12-29-Reselect/</link><guid isPermaLink="false">http://cuteshilina.com/2018-12-29-Reselect/</guid><pubDate>Sat, 29 Dec 2018 17:00:00 GMT</pubDate><content:encoded>&lt;p&gt;TL;DR;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在&lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;Redux&lt;/code&gt;的应用中，使用&lt;code class=&quot;language-text&quot;&gt;Reselect&lt;/code&gt;来做性能优化是常见的优化手段&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Reselect&lt;/code&gt;默认只有一份&lt;code class=&quot;language-text&quot;&gt;cache&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;cache&lt;/code&gt;命中的策略是浅比较，引用改变了会导致&lt;code class=&quot;language-text&quot;&gt;cache&lt;/code&gt;失效&lt;/li&gt;
&lt;li&gt;
&lt;h2 id=&quot;code-classlanguage-textreselectcode支持定制code-classlanguage-textmemeoizecode函数和code-classlanguage-textcachecode命中策略&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#code-classlanguage-textreselectcode%E6%94%AF%E6%8C%81%E5%AE%9A%E5%88%B6code-classlanguage-textmemeoizecode%E5%87%BD%E6%95%B0%E5%92%8Ccode-classlanguage-textcachecode%E5%91%BD%E4%B8%AD%E7%AD%96%E7%95%A5&quot; aria-label=&quot;code classlanguage textreselectcode支持定制code classlanguage textmemeoizecode函数和code classlanguage textcachecode命中策略 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;Reselect&lt;/code&gt;支持定制&lt;code class=&quot;language-text&quot;&gt;memeoize&lt;/code&gt;函数和&lt;code class=&quot;language-text&quot;&gt;cache&lt;/code&gt;命中策略&lt;/h2&gt;
&lt;p&gt;在开发&lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt;前端应用的时候，我们经常会使用&lt;code class=&quot;language-text&quot;&gt;Redux&lt;/code&gt;做状态管理，但是随着前端代码的复杂度的上升，会引入&lt;code class=&quot;language-text&quot;&gt;Reselect&lt;/code&gt;作为性能优化的手段之一，这篇文章就Reselect的一些应用场景作一些介绍。&lt;/p&gt;
&lt;h2 id=&quot;什么是selector&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BB%80%E4%B9%88%E6%98%AFselector&quot; aria-label=&quot;什么是selector permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;什么是Selector&lt;/h2&gt;
&lt;p&gt;在介绍&lt;code class=&quot;language-text&quot;&gt;Reselect&lt;/code&gt;的之前，我们首先要知道&lt;code class=&quot;language-text&quot;&gt;Selector&lt;/code&gt;这个概念，那么什么是&lt;code class=&quot;language-text&quot;&gt;Selector&lt;/code&gt;呢？
&lt;code class=&quot;language-text&quot;&gt;Selector&lt;/code&gt;这个概念并不是&lt;code class=&quot;language-text&quot;&gt;Javascrip&lt;/code&gt;t或者&lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;Redux&lt;/code&gt;的一个概念。想象一下你去便利店买可乐，你给店员说要可口可可，这时候店员就去给你拿一罐可口可乐，这时候，店员其实就是充当了&lt;code class=&quot;language-text&quot;&gt;Selector&lt;/code&gt;的角色，店员知道如何从各种商品里拿到你要的可口可乐，具体来说&lt;code class=&quot;language-text&quot;&gt;Selctor&lt;/code&gt;有以下特点：&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Selector&lt;/code&gt;知道从哪里，以及如何去获取数据的子集&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Selector&lt;/code&gt;会返回数据的子集
用代码来表示就是：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;getCoke&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;shop&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;items&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;coke&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;为什么我们需要selector？&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81selector%EF%BC%9F&quot; aria-label=&quot;为什么我们需要selector？ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;为什么我们需要Selector？&lt;/h2&gt;
&lt;p&gt;简单来说&lt;code class=&quot;language-text&quot;&gt;Selector&lt;/code&gt;就是从一个大的&lt;code class=&quot;language-text&quot;&gt;State&lt;/code&gt;上去获取子数据的函数，其实就是从一个大的&lt;code class=&quot;language-text&quot;&gt;Object&lt;/code&gt;，根据指定的&lt;code class=&quot;language-text&quot;&gt;path&lt;/code&gt;去取数据，如果自己不写&lt;code class=&quot;language-text&quot;&gt;Selector&lt;/code&gt;，也可以在用的地方从&lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;上去取，但是这样存在的一个问题是，如果有多个地方都需要同一份数据，你不得不在多个地方加同样的代码，如果&lt;code class=&quot;language-text&quot;&gt;State&lt;/code&gt;的结构变了，那么这样就会取修改多个文件的代码，可维护性并不高，所以从可维护性的角度来说，&lt;code class=&quot;language-text&quot;&gt;Selector&lt;/code&gt;是很有必要的。
同样随着项目复杂度的提升，我们会有很多个&lt;code class=&quot;language-text&quot;&gt;Selector&lt;/code&gt;，针对于获取数据粒度，不同的&lt;code class=&quot;language-text&quot;&gt;Selector&lt;/code&gt;是可以组合成更复杂的`Selector&lt;code class=&quot;language-text&quot;&gt;&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&quot;为什么要在项目中引入reselector&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%BC%95%E5%85%A5reselector&quot; aria-label=&quot;为什么要在项目中引入reselector permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;为什么要在项目中引入Reselector&lt;/h2&gt;
&lt;p&gt;简单来说就是为了性能，因为&lt;code class=&quot;language-text&quot;&gt;Reselector&lt;/code&gt;给&lt;code class=&quot;language-text&quot;&gt;Selector&lt;/code&gt;提供了缓存的能力，避免了重复计算；在一个复杂的&lt;code class=&quot;language-text&quot;&gt;Redux&lt;/code&gt;的Web App中，在&lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;发生变化的时候，会依次调用所有的&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;，从理论上来说我们只应该去刷新和变化数据相关的组件，但是可能会存在这种情况，某些&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;中要获取的数据虽然没变，但是如果每次connect每次都返回一个新的引用，那么就会导致无谓的重刷；还存在的问题是，在&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;中回去数据的逻辑是很耗时的操作，导致性能瓶颈。这两个问题字实际的开发中，是很常见的问题，&lt;code class=&quot;language-text&quot;&gt;Reselect&lt;/code&gt;可以在一定程度上解决这些意外的问题。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;如何使用reselector&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8reselector&quot; aria-label=&quot;如何使用reselector permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;如何使用Reselector&lt;/h2&gt;
&lt;p&gt;我们通过一个例子来看看，来看看&lt;code class=&quot;language-text&quot;&gt;Reselect&lt;/code&gt;是如何提升性能的。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Component &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; connect &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react-redux&apos;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;countReducer&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; action&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;action&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;type&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;INCREASE_1&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        demo_1&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          count&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;demo_1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;INCREASE_2&apos;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        demo_2&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          count&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;demo_2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        demo_1&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          count&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        demo_2&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          count&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;increase_1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  type&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;INCREASE_1&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;increase_2&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  type&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;INCREASE_2&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;mapStateToProps1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; demo1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;demo_1 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    demoData&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; demo1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;//demoDataSelector(state, &apos;demo_1&apos;),&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;mapStateToProps2&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; demo2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;demo_2 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    demoData&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; demo2&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CardView1&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;...render cardview1&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div className&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;card&quot;&lt;/span&gt; style&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      backgroundColor&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;red&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      width&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;150px&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      height&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;50px&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      display&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;inline-block&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      color&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;white&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;Cardview1 CurrentView: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;demoData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CardView2&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;...render cardview2&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div className&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;card&quot;&lt;/span&gt;style&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      backgroundColor&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;blue&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      width&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;150px&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      height&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;50px&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      display&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;inline-block&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      marginLeft&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;10px&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      color&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;white&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;Cardview2 CurrentView: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;demoData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; connected &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  CardView1&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mapStateToProps1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;CardView1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  CardView2&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mapStateToProps2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;CardView2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Counter&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;app-container&quot;&lt;/span&gt; style&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        textAlign&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;center&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;h1&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;button className&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;count1&quot;&lt;/span&gt; onClick&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;increase_1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Increase Card &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;button&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;button className&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;count2&quot;&lt;/span&gt; onClick&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;increase_2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Increase Card &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;button&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;h1&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;connected&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CardView1&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;connected&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CardView2&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Counter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在上面的代码中，&lt;code class=&quot;language-text&quot;&gt;Cardview1&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;CardView2&lt;/code&gt;每次会从&lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt;上取出数据，然后放到一个新的&lt;code class=&quot;language-text&quot;&gt;Object&lt;/code&gt;上去，导致每次都会产生一个新的引用，那么这里会导致的问题是，在我们更新&lt;code class=&quot;language-text&quot;&gt;demo_1&lt;/code&gt;的数据的时候理当只刷新&lt;code class=&quot;language-text&quot;&gt;Cardview1&lt;/code&gt;，但是在上面代码的情况下，刷新&lt;code class=&quot;language-text&quot;&gt;Cardview1&lt;/code&gt;的时候也会刷新&lt;code class=&quot;language-text&quot;&gt;Cardview2&lt;/code&gt;，反之亦然；当我点击
这里存在的问题是，在&lt;code class=&quot;language-text&quot;&gt;mapStateToProps&lt;/code&gt;中，每次都返回了一个新的引用，所以导致虽然和组件中无关的属性更新了，但是仍然刷新了；这里我们使用&lt;code class=&quot;language-text&quot;&gt;Reselect&lt;/code&gt;将&lt;code class=&quot;language-text&quot;&gt;mapStateToProps&lt;/code&gt;中的&lt;code class=&quot;language-text&quot;&gt;Selector&lt;/code&gt;包一下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;getDemoData&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; demoDataSelector &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;getDemoData&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;mapStateToProps1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    demoData&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;demoDataSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;demo_1&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;mapStateToProps2&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    demoData&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;demoDataSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;demo_2&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里的话使用&lt;code class=&quot;language-text&quot;&gt;Reselect&lt;/code&gt;来解决这个问题，这里虽然这个例子不大合适，但是这里仅仅是以这个为例子来讲解&lt;code class=&quot;language-text&quot;&gt;Reselect&lt;/code&gt;的用法。&lt;/p&gt;
&lt;h2 id=&quot;如何在复用的组件中使用reselect？&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%A6%82%E4%BD%95%E5%9C%A8%E5%A4%8D%E7%94%A8%E7%9A%84%E7%BB%84%E4%BB%B6%E4%B8%AD%E4%BD%BF%E7%94%A8reselect%EF%BC%9F&quot; aria-label=&quot;如何在复用的组件中使用reselect？ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;如何在复用的组件中使用Reselect？&lt;/h2&gt;
&lt;p&gt;如果一个使用了&lt;code class=&quot;language-text&quot;&gt;Reselect&lt;/code&gt;的组件在多个地方使用，那么其实这个组件的优化是无意义的，因为在生成下一个组件的实例的时候会将上一个组件的&lt;code class=&quot;language-text&quot;&gt;cache&lt;/code&gt;冲掉，如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; ShopItems &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./components/shopitems&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Shop&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
		&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ShopItems category&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;belts&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
		&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ShopItems category&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;dresses&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
		&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ShopItems category&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;pants&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; connect &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;react-redux&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; createSelector &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;reselect&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;getItemsByCategory&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;items&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;category&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; getItemsSelector &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;getItemsByCategory&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;items&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; items&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;ShopItems&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;items&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;getItemsSelector&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ShopItems&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，这里复用了&lt;code class=&quot;language-text&quot;&gt;ShopItems&lt;/code&gt;这个组件，这个组件使用的&lt;code class=&quot;language-text&quot;&gt;Selector&lt;/code&gt;使用了&lt;code class=&quot;language-text&quot;&gt;Reselect&lt;/code&gt;，但是这里的优化是没什么卵用的，因为对于&lt;code class=&quot;language-text&quot;&gt;Selector&lt;/code&gt;来说每次的参数都变化了，&lt;code class=&quot;language-text&quot;&gt;cache&lt;/code&gt;并不会命中，所有我们需要在&lt;strong&gt;每一次实例化组件的时候，为每一个组件生成一份&lt;code class=&quot;language-text&quot;&gt;cache&lt;/code&gt;&lt;/strong&gt;，如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;makeGetItemsSelector&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;getItemsByCategory&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;items&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; items&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;makeMapStateToProps&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; getItems &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;makeGetItemsSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;mapStateToProps&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			items&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getItems&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;makeMapStateToProps&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ShopItems&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，这里会为每一个组件生成一个私有的&lt;code class=&quot;language-text&quot;&gt;Selector&lt;/code&gt;，就可以避免在复用组件的时候，&lt;code class=&quot;language-text&quot;&gt;cache&lt;/code&gt;没有做对的问题。&lt;/p&gt;
&lt;h2 id=&quot;使用reselect生成结构化的数据&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8reselect%E7%94%9F%E6%88%90%E7%BB%93%E6%9E%84%E5%8C%96%E7%9A%84%E6%95%B0%E6%8D%AE&quot; aria-label=&quot;使用reselect生成结构化的数据 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用Reselect生成结构化的数据&lt;/h2&gt;
&lt;p&gt;考虑下面的代码：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;mySelectorA&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;state&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;a
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;mySelectorB&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;state&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;b

&lt;span class=&quot;token comment&quot;&gt;// The result function in the following selector&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// is simply building an object from the input selectors&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; structuredSelector &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
   mySelectorA&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   mySelectorB&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   mySelectorC&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; c&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
     a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
     b&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
     c
   &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里最后需要生成一个结构化的数据，这种情况下，&lt;code class=&quot;language-text&quot;&gt;Reselect&lt;/code&gt;提供了生成结构化的数据的&lt;code class=&quot;language-text&quot;&gt;API&lt;/code&gt;—&gt; &lt;code class=&quot;language-text&quot;&gt;createStructuredSelector&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;mySelectorA&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;state&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;a
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;mySelectorB&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;state&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; state&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;b

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; structuredSelector &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createStructuredSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  x&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; mySelectorA&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  y&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; mySelectorB
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;structuredSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; a&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// will produce { x: 1, y: 2 }&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;定制createselector&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%9A%E5%88%B6createselector&quot; aria-label=&quot;定制createselector permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;定制createSelector&lt;/h2&gt;
&lt;p&gt;因为默认的&lt;code class=&quot;language-text&quot;&gt;createSelector&lt;/code&gt;的只提供了一份&lt;code class=&quot;language-text&quot;&gt;cache&lt;/code&gt;，在很多情况下并不满足我们的需求，另外&lt;code class=&quot;language-text&quot;&gt;cache&lt;/code&gt;的命中策略是浅比较，在一些情况下并不适用我们的使用场景，所以&lt;code class=&quot;language-text&quot;&gt;Reselect&lt;/code&gt;提供了定制&lt;code class=&quot;language-text&quot;&gt;createSelector&lt;/code&gt;的能力 —&gt;&lt;code class=&quot;language-text&quot;&gt;createSelectorCreator(memoize, ...memoizeOptions)&lt;/code&gt;。如下，我们使用&lt;code class=&quot;language-text&quot;&gt;lodash&lt;/code&gt;生成一个一个无限&lt;code class=&quot;language-text&quot;&gt;cache&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;createSelector&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; mySelectorCreator &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createSelectorCreator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;memoize&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，我们就拥有了一个无限&lt;code class=&quot;language-text&quot;&gt;cache&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;selectorCreator&lt;/code&gt;。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;兴趣遍地都是，坚持和持之以恒才是稀缺的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Tree Shaking]]></title><description><![CDATA[TL;DR; 前端打包中会将多个module打包成一个bundle发给客户端，但是各个module中存在并不会使用到的东西，dead code elimination是一种可以消除这些代码的技术 Tree Shaking是Dead code elimination（简称DCE…]]></description><link>http://cuteshilina.com/2018-12-22-TreeShaking/</link><guid isPermaLink="false">http://cuteshilina.com/2018-12-22-TreeShaking/</guid><pubDate>Sat, 22 Dec 2018 17:00:00 GMT</pubDate><content:encoded>&lt;h2 id=&quot;tldr&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#tldr&quot; aria-label=&quot;tldr permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;TL;DR;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;前端打包中会将多个module打包成一个bundle发给客户端，但是各个module中存在并不会使用到的东西，dead code elimination是一种可以消除这些代码的技术&lt;/li&gt;
&lt;li&gt;Tree Shaking是Dead code elimination（简称DCE）的一种实现&lt;/li&gt;
&lt;li&gt;Webpack中的tree shaking需要es6的&lt;code class=&quot;language-text&quot;&gt;import/export&lt;/code&gt;的支持&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Webpack中的tree shaking仅仅能作用与顶层函数、顶层变量、顶层对象，如果定义一个函数集合的Object，如果仅仅只使用了一部分函数，其他的函数仍然会被打进去&lt;/p&gt;
&lt;h2 id=&quot;什么是tree-shaking&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BB%80%E4%B9%88%E6%98%AFtree-shaking&quot; aria-label=&quot;什么是tree shaking permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;什么是Tree Shaking&lt;/h2&gt;
&lt;p&gt;在前端开发的过程中，一般整个代码会分散在项目的各个模块中，但是在最后在发送给客户端的时候，往往是一个大的bundle文件，各个模块的文件打包成一个JS文件，但是伴随而来的问题就是，某些永远跑不到的代码也会打到最后的bundle文件中，这就无形中增加了bundle的size。
&lt;code class=&quot;language-text&quot;&gt;Dead code elimination（简称DCE）&lt;/code&gt;是一种可以消除最后编译产物中无用的代码的技术，就以上出现的问题DCE技术可以移除无用的不相关的代码，以达到减小产物size的作用。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; c &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; m &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// unreachable code&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; m&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; c &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// unreachable code&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// do something&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;以上的代码就是一个典型的可以通过&lt;code class=&quot;language-text&quot;&gt;DCE&lt;/code&gt;消除掉的例子，但是在前端&lt;code class=&quot;language-text&quot;&gt;webpack&lt;/code&gt;中可以消除掉这些永远跑不到的代码，但是存在一个问题就是如果你&lt;code class=&quot;language-text&quot;&gt;import&lt;/code&gt;了一个模块，这个模块暴露出了两个函数，你在运行时只使用了其中一个，那么在最后打包的时候另外一个函数也会被打进去，代码如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// helper.js&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;foo&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;bar&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// main.js&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;foo&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./helpers&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上在这种情况下，我们只使用了&lt;code class=&quot;language-text&quot;&gt;foo&lt;/code&gt;函数，没有使用&lt;code class=&quot;language-text&quot;&gt;bar&lt;/code&gt;函数，最后使用&lt;code class=&quot;language-text&quot;&gt;webpack&lt;/code&gt;打包之后，我们不需要&lt;code class=&quot;language-text&quot;&gt;bar&lt;/code&gt;函数的代码，因为没人去调用它，但是&lt;code class=&quot;language-text&quot;&gt;webpack&lt;/code&gt;如果没有配置&lt;code class=&quot;language-text&quot;&gt;tree shaking&lt;/code&gt;的话，&lt;code class=&quot;language-text&quot;&gt;bar&lt;/code&gt;还是会被打进最后的&lt;code class=&quot;language-text&quot;&gt;bundle&lt;/code&gt;。
&lt;code class=&quot;language-text&quot;&gt;tree shaking&lt;/code&gt;就是一种&lt;code class=&quot;language-text&quot;&gt;DCE&lt;/code&gt;技术，发源于&lt;code class=&quot;language-text&quot;&gt;Lisp&lt;/code&gt;，最早在JS中是在&lt;code class=&quot;language-text&quot;&gt;google closure&lt;/code&gt;中使用，后来&lt;code class=&quot;language-text&quot;&gt;rollup&lt;/code&gt;的作者在&lt;code class=&quot;language-text&quot;&gt;rollup&lt;/code&gt;中引入了&lt;code class=&quot;language-text&quot;&gt;tree shaking&lt;/code&gt;这个技术，同时在&lt;code class=&quot;language-text&quot;&gt;webpack4&lt;/code&gt;中也实现了相应的功能。&lt;/p&gt;
&lt;h2 id=&quot;tree-shaking的限制&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#tree-shaking%E7%9A%84%E9%99%90%E5%88%B6&quot; aria-label=&quot;tree shaking的限制 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Tree Shaking的限制&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Tree Shaking&lt;/code&gt;的原理简单来说，就是程序的执行能够被一颗由函数调用组成的树表示，如果一个函数没有被调用到，那么这个函数就可以被消除掉；但是在&lt;code class=&quot;language-text&quot;&gt;commonJS&lt;/code&gt;中，&lt;code class=&quot;language-text&quot;&gt;module&lt;/code&gt;的加载不是静态的，这时候去做静态语法分析是比较困难的，但是&lt;code class=&quot;language-text&quot;&gt;es6 moudle&lt;/code&gt;的出现，使得这个问题变简单了，所以&lt;code class=&quot;language-text&quot;&gt;tree shaking&lt;/code&gt;的先决条件是你的&lt;code class=&quot;language-text&quot;&gt;module&lt;/code&gt;使用的是&lt;code class=&quot;language-text&quot;&gt;es6&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;import/export&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&quot;tree-shaking在webpack中的使用&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#tree-shaking%E5%9C%A8webpack%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8&quot; aria-label=&quot;tree shaking在webpack中的使用 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Tree Shaking在Webpack中的使用&lt;/h2&gt;
&lt;p&gt;配置&lt;code class=&quot;language-text&quot;&gt;webpack babel loader&lt;/code&gt;的插件：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
         loader&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;babel-loader&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
         test&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; dir_js&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
         query&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
         &lt;span class=&quot;token comment&quot;&gt;// presets: [&apos;es2015&apos;],&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// All of the plugins of babel-preset-es2015,&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// minus babel-plugin-transform-es2015-modules-commonjs&lt;/span&gt;
        plugins&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
          &lt;span class=&quot;token comment&quot;&gt;// &apos;babel-plugin-transform-es2015-modules-commonjs&apos;,&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&apos;transform-es2015-template-literals&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&apos;transform-es2015-literals&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&apos;transform-es2015-function-name&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&apos;transform-es2015-arrow-functions&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&apos;transform-es2015-block-scoped-functions&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&apos;transform-es2015-classes&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&apos;transform-es2015-object-super&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&apos;transform-es2015-shorthand-properties&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&apos;transform-es2015-computed-properties&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&apos;transform-es2015-for-of&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&apos;transform-es2015-sticky-regex&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&apos;transform-es2015-unicode-regex&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&apos;check-es2015-constants&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&apos;transform-es2015-spread&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&apos;transform-es2015-parameters&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&apos;transform-es2015-destructuring&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&apos;transform-es2015-block-scoping&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&apos;transform-es2015-typeof-symbol&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;transform-regenerator&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; async&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; asyncGenerators&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   		&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果要让&lt;code class=&quot;language-text&quot;&gt;tree shaking&lt;/code&gt;起作用，那么将es6插件中的&lt;code class=&quot;language-text&quot;&gt;babel-plugin-transform-es2015-modules-commonjs&lt;/code&gt;去掉，避免打成&lt;code class=&quot;language-text&quot;&gt;commonJS&lt;/code&gt;的包，不然&lt;code class=&quot;language-text&quot;&gt;tree shaking&lt;/code&gt;没用。&lt;/p&gt;
&lt;p&gt;如下我们有以下代码，我们使用&lt;code class=&quot;language-text&quot;&gt;webpack&lt;/code&gt;来编译它们，来看看使用&lt;code class=&quot;language-text&quot;&gt;tree shaking&lt;/code&gt;和不使用的区别：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;	&lt;span class=&quot;token comment&quot;&gt;// helper.js&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;unreachable code&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;foo&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;bar&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// main.js&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;foo&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./helpers&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; elem &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;output&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;test&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;foo&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
elem&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;innerHTML &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;Output: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;使用&lt;code class=&quot;language-text&quot;&gt;webpack&lt;/code&gt;编译后的部分代码：&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 549px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.621621621621614%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABGUlEQVQoz5WSWY7CMBBEuf8ZZwMCSUy8xXa8p2gPAoGEBqYl/3ipftXljTEGzjlwwRF8RH/k4OMEyWfEXFBLQat1XX/Xq9o0wYUER8Yw6xnicw/x3YFtDzgNDD7Gm+A7tbHWwloDRoKtLOOQX0ewDxLcd3BS/J/QOQspJQrZCyEi+YRgA6L3iES/3gk+W/cOboTDOKK99Nph7miOOw7NTghavqS6J78JTtOEWgvYiRGtAp84zXAA6wdwTuLaIKeERHc93YlKUogepdZHwqtlISRtViiyfux7bHc/GAcBpS4NnVuQc0ZeFsRZI9MoUkwEUZ9YNpdQ2lnX9egPB5h5QX0v2EfL12/TLJdChEpDK4UYWvf1zzCehXIGBRS+WVHhyioAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;tree shaking webpack0&quot;
        title=&quot;tree shaking webpack0&quot;
        src=&quot;/static/86bd028fa895e0175a630e158eb530d6/928ea/tree-shaking-webpack0.png&quot;
        srcset=&quot;/static/86bd028fa895e0175a630e158eb530d6/12f09/tree-shaking-webpack0.png 148w,
/static/86bd028fa895e0175a630e158eb530d6/e4a3f/tree-shaking-webpack0.png 295w,
/static/86bd028fa895e0175a630e158eb530d6/928ea/tree-shaking-webpack0.png 549w&quot;
        sizes=&quot;(max-width: 549px) 100vw, 549px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;如上图是在没有启用&lt;code class=&quot;language-text&quot;&gt;tree-shaking&lt;/code&gt;的时候打包之后的&lt;code class=&quot;language-text&quot;&gt;bundle&lt;/code&gt;，这里在最后的&lt;code class=&quot;language-text&quot;&gt;bundle&lt;/code&gt;文件中有没有使用的&lt;code class=&quot;language-text&quot;&gt;bar&lt;/code&gt;函数，下图是使用了&lt;code class=&quot;language-text&quot;&gt;tree shaking&lt;/code&gt;之后打包后的代码：&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 380px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 29.054054054054056%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAzElEQVQY04WP3Y7CIBBGff8H3OgmpkRKxUoLVH4sBT6hUbN7oT0JyVwMJ2d2jDFYZyH7AcdDh+b3hLHtwNgAqQyWkGCth3MOKSVUcs74xO585lBaYbwIiH2L8cghyuNMoBcK/DLgOk64GYMY47awFr64Tw63vkh+KHRbCnsJSQk0Pb13vslWYdOQdVhCgClnVYKdcTceaYmI3mHWGjnlt/BrIef8KVzQdVcQQjApCe9nxPT/41bdKqS0nFcKKikmhFJaa+v8qvlbtSV9AGmM1CMoykW1AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;tree shaking webpack1&quot;
        title=&quot;tree shaking webpack1&quot;
        src=&quot;/static/3c16a6a29d64fc4b34e873b704d99c2b/3f520/tree-shaking-webpack1.png&quot;
        srcset=&quot;/static/3c16a6a29d64fc4b34e873b704d99c2b/12f09/tree-shaking-webpack1.png 148w,
/static/3c16a6a29d64fc4b34e873b704d99c2b/e4a3f/tree-shaking-webpack1.png 295w,
/static/3c16a6a29d64fc4b34e873b704d99c2b/3f520/tree-shaking-webpack1.png 380w&quot;
        sizes=&quot;(max-width: 380px) 100vw, 380px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;可以看到在没有&lt;code class=&quot;language-text&quot;&gt;tree shaking&lt;/code&gt;的情况下没有使用的&lt;code class=&quot;language-text&quot;&gt;bar&lt;/code&gt;函数的代码也被打进了最后的&lt;code class=&quot;language-text&quot;&gt;bundle&lt;/code&gt;中，使用了&lt;code class=&quot;language-text&quot;&gt;tree shaking&lt;/code&gt;的将没有使用到的函数消除掉了。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;tree-shaking真的很美好吗？&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#tree-shaking%E7%9C%9F%E7%9A%84%E5%BE%88%E7%BE%8E%E5%A5%BD%E5%90%97%EF%BC%9F&quot; aria-label=&quot;tree shaking真的很美好吗？ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Tree Shaking真的很美好吗？&lt;/h2&gt;
&lt;p&gt;  看到这里你可能觉得&lt;code class=&quot;language-text&quot;&gt;tree shaking&lt;/code&gt;真的很美好，能够帮你把一切在运行时没有使用到的代码消除掉，但是遗憾的是，在实际情况下并没有这么美好，看看下面的例子：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;	&lt;span class=&quot;token comment&quot;&gt;// helper.js&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// top level function&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      	console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;unreachable code&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;    
  	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;foo&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;bar&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	
  &lt;span class=&quot;token comment&quot;&gt;// top level object&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; MyObject &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  	&lt;span class=&quot;token function-variable function&quot;&gt;fooFuncInObj&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;foo in obj&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  	&lt;span class=&quot;token function-variable function&quot;&gt;barFuncInObj&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;bar in obj&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	
  
	&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; MyObject1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  	&lt;span class=&quot;token function-variable function&quot;&gt;fooFuncInObj&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;foo in obj&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  	&lt;span class=&quot;token function-variable function&quot;&gt;barFuncInObj&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;bar in obj&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;    
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	
  &lt;span class=&quot;token comment&quot;&gt;// top level variable&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; fooVar &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;I&apos;m top level variable foo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; barVar &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;I&apos;m top level variable bar&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; varObj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  	foo&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;variable foo in varObj&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      barVar&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;variable bar in varObj&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; foo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; MyObject&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; fooVar&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; varObj &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./helpers&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; elem &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;output&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
elem&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;innerHTML &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;Output0: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; \n Output1: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;MyObject&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fooFuncInObj&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; \n Output2: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;fooVar&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;\n Output1: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;varObj&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;foo&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;  如果&lt;code class=&quot;language-text&quot;&gt;tree shaking&lt;/code&gt;足够聪明，那么我们这里仅仅调用了&lt;code class=&quot;language-text&quot;&gt;MyObject&lt;/code&gt;下的一个函数，另外一个函数没有使用，同样的我们只使用了&lt;code class=&quot;language-text&quot;&gt;varObj&lt;/code&gt;下的一个变量，另外的变量不应该打到最后的&lt;code class=&quot;language-text&quot;&gt;bundle&lt;/code&gt;里面去，遗憾的是现实情况并不是这样，下图是&lt;code class=&quot;language-text&quot;&gt;webpack&lt;/code&gt;打出来的包：&lt;/p&gt;
&lt;p&gt;  &lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 443px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 116.89189189189189%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAADDUlEQVQ4y51VyXKbQBTU/1eqcohzcDlH55Cc8h9J2RVrQxiDJBaxbwPDTucN8oIsyXEyVQNIJfW8ft39mERxhMgJEaj2sJ2NC9eN4AcxwoihKDjE6vt+2H9bk+GHbYsy5UiNAJ68Q2hHCLcaijB4BsMj4Bj41AGTrutQVhUY58jzDEVeoKlbgA5p6/oA5DXYWcCmamFvdrAsB0kQIGH8TVoD2DnKLQF2DVVT1AgITFpK0BQNq4UE9UEB80JEGwfR2oa3NqmvEUQRZym3RO1plVWJtumQeylyn6GmFnDHQZMxcNdBEfgHQGcBh+/pYpomDNOC63kwDB0720aZl2BuQgekSPwYcZK8v8I8z8ESBufBhK1aCAwD6XZLFQeI1TWSrY66bY5UH4MPotR1hbIs0TQN/meNK52IR5amkCQJtuPCItq6bmC72UDTtIG6rpvIeUV9tJGQUJlloCSPZlmGJ4bPFe572FN1NdYEcHt7i183N3S/gSzfY2f6iGP6o3CD8GZZoCXxOmIjGB1RHvdwralYrWRYmg51rsDXPZgURaH+W7E7oNy2L31LibpISrL1kWw8xKRsQQkS1fd99yhCN3o+3hPhgJq8xzJO4nT/Lshx9CKUmYWdugDnDkpmkIHVYZe+gsKTkdtLVPEaubUA294hd2VUlUd+DKmqwz3p6h/gyTWUxRXu5UvIiwusZhdY/P6Iu58foMw/Q11ekqm/gu+uEE4/EegXsOgaaXxNQ+Q7uvob+sdNPXyhKSwzn88xoz2dTaEbFhybYsibE0KAKuyPaD/bRiz14WGwiqXo2MxU+KSwtbXBi3wft4N0jO0yEmVsm6Igj9EszEV2nYRiWGB/YPdqHp5+HgDFhZM1PNcjleuBSv+OqJ2b3JOOPpTkPW9jIwzZMGCrnKOjKd5QKkQ6+q4dklHTGBNT/Bz4EWWRFImS4pM4bK0hWkwRSUtkpoFYXiJR7pFQtrnnkp3c4bCTrwDxZmMsG8ZXRBOZ0b2lCSQqKumtKAZtxdKhuobaI74rwpCG8T7LfffS4z/8XPNWuWpoJwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;tree shaking webpack2&quot;
        title=&quot;tree shaking webpack2&quot;
        src=&quot;/static/f62125eb43456fc624e4d2f525a142c2/a120c/tree-shaking-webpack2.png&quot;
        srcset=&quot;/static/f62125eb43456fc624e4d2f525a142c2/12f09/tree-shaking-webpack2.png 148w,
/static/f62125eb43456fc624e4d2f525a142c2/e4a3f/tree-shaking-webpack2.png 295w,
/static/f62125eb43456fc624e4d2f525a142c2/a120c/tree-shaking-webpack2.png 443w&quot;
        sizes=&quot;(max-width: 443px) 100vw, 443px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;  从上面的代码我们可以有这样的结论，&lt;code class=&quot;language-text&quot;&gt;webpack&lt;/code&gt;的&lt;code class=&quot;language-text&quot;&gt;tree shaking&lt;/code&gt;对顶层函数、顶层变量和顶层对象有作用。&lt;/p&gt;
&lt;h2 id=&quot;reference&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#reference&quot; aria-label=&quot;reference permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Reference&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Tree_shaking&quot;&gt;https://en.wikipedia.org/wiki/Tree_shaking&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/rauschma/tree-shaking-demo&quot;&gt;https://github.com/rauschma/tree-shaking-demo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://2ality.com/2015/12/webpack-tree-shaking.html&quot;&gt;http://2ality.com/2015/12/webpack-tree-shaking.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;兴趣遍地都是，坚持和持之以恒才是稀缺的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[集成SonarQube到你的项目中]]></title><description><![CDATA[在整个项目的开发过程中，开发人员在编写代码之前，往往会制定相关的代码规范，虽然写完代码之后有code review的过程，但是难免会有code review发现不了的问题，往往一些潜在的bug…]]></description><link>http://cuteshilina.com/2018-12-15-集成Sonarqube到项目/</link><guid isPermaLink="false">http://cuteshilina.com/2018-12-15-集成Sonarqube到项目/</guid><pubDate>Sat, 15 Dec 2018 17:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在整个项目的开发过程中，开发人员在编写代码之前，往往会制定相关的代码规范，虽然写完代码之后有code review的过程，但是难免会有code review发现不了的问题，往往一些潜在的bug或者坏味道的代码会出现在项目中,这时候如果有一个自动检查代码规范的工具，就能有效的避免一些问题，SonarQube就是提供了这样一个能力的工具，刚好前段时间我负责集成SonarQube的服务到我们项目中，集成的时候遇见的一些问题，在这里做一个回顾和总结。&lt;/p&gt;
&lt;h2 id=&quot;sonarqube是什么？&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#sonarqube%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F&quot; aria-label=&quot;sonarqube是什么？ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;SonarQube是什么？&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;SonarQube（曾用名Sonar（声纳）[1]）是一个开源的代码质量管理系统。—维基百科&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;上面是维基百科的介绍，看SonarQube官网的介绍，SonarQube就是一个代码质量的检查工具，能够将代码中潜在的bug、坏味道的代码、代码存在的安全漏洞检查出来；SonarQube对主流编程语言的的支持还是不错的，官方称支持20+的编程语言，如果不是使用太冷门的语言都是可以使用SonarQube的；并且SonarQube完全可以集成进你的持续集成工具中，提供了完全自动化的分析。&lt;/p&gt;
&lt;h2 id=&quot;sonarqube的架构&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#sonarqube%E7%9A%84%08%08%E6%9E%B6%E6%9E%84&quot; aria-label=&quot;sonarqube的架构 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;SonarQube的架构&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 58.10810810810811%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACG0lEQVQoz3VSSW7bQBDkb+Ln5DM6BPADZAFxEESwhdx9yAMC5wP2ITdLEBzF2kjJpEgOF3HncCl3j01FFpAGBuQsXd1dVVrmz5AYdyhlhrKQSLIMQl9hs3jCwrCwcwQMQ4fn+cjoLs9zFEWBspS0SrV43zQNVqsVNM8YwPz9EbJwkKY5UkpKPIEsCrG29wiiDL7vKaAkSSi5RBQFCHwXVVXhOJbLJbTS+wn9YYBob2FPiyOnqkmaUkcpotAnwEAB1nWt7qWMEQQ7us8JPKK9VOez2QzadrujhFgdcNscbdvif1GWBWzHhbBtCOsZj7M/MNY6yqTEeDyGdnb2AcPhN4RhiGdjg9AwVOJkMka/38eXy8/4dH6Oy6vvqGSluhTCxc724LgBvZtAX69R1Q0eGLDX6+HHzQ1x4quxmjde+OFwOMRodI2LwQW+Xo2Iv/zQve9bMM0N0RQhjmN1rkbmTUJgKX1ZxZR4Y+AoitV4XTS1RExCsWgsXhgyhwz0j6LFYgHtmB8piR97rqzgeR5c14HwXLg0IisshFDF2rY55DBYB6jrOjT+bUmMUyFSUpnHMU0DlvWkfLezHfLkXypkKPtQ5jvANXGpHVd5Xc1bt1IZlh+5rqu6Zt+xeLzngl1u5475fP5+5ONgMB7v9vYX7u7vFVjdvPqQlT419QGw64STu8V7NqxPYm23WxrbJCMHisfTd10uF5hOp3gB2K2KBhDwFfEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;SonarQube Architecture&quot;
        title=&quot;SonarQube Architecture&quot;
        src=&quot;/static/cc7b0bfec7e88e244c829fd464e36ed8/fcda8/architecture-integrate.png&quot;
        srcset=&quot;/static/cc7b0bfec7e88e244c829fd464e36ed8/12f09/architecture-integrate.png 148w,
/static/cc7b0bfec7e88e244c829fd464e36ed8/e4a3f/architecture-integrate.png 295w,
/static/cc7b0bfec7e88e244c829fd464e36ed8/fcda8/architecture-integrate.png 590w,
/static/cc7b0bfec7e88e244c829fd464e36ed8/efc66/architecture-integrate.png 885w,
/static/cc7b0bfec7e88e244c829fd464e36ed8/1cfc2/architecture-integrate.png 900w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
如上是SonarQube各个部分的组件，其实如果要搭建一个完整的SonarQube服务，从整体上来看分成两个大的部分，一个部分是Sonar Scanner，一个是SonarQube Server；SonarQube Scanner负责从SonarQube拉取规则，扫墓工程目录下的代码，将扫描结果回写给SonarQube Server，Scanner和Server不一定在同一台机器上。如上SonarQube Server在运行时主要由三个主要的进程组成：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Web Server是负责代码质量的报告在UI上的展现，以及在用户界面上对SonarQube实例的配置&lt;/li&gt;
&lt;li&gt;Search Server是依赖于Elasticsearch，提供搜索的能力&lt;/li&gt;
&lt;li&gt;Compute Engine负责处理代码分析的报告，以及将相关数据存入数据库的操作&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;SonarQube Server上的数据库存储了SonarQube的配置信息（插件、安全设置等信息），以及每一次分析报告的快照；从这里可以看出，SonarQube Server其实就是一个配置管理、结果分析查询的服务，SonarQube本身并不参与到项目代码的扫描分析中，扫描分析这一部分的工作是Sonar Scanner负责的，一般是集成到项目中的持续集成工具中的。&lt;/p&gt;
&lt;h2 id=&quot;安装sonarqube-server&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85sonarqube-server&quot; aria-label=&quot;安装sonarqube server permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装SonarQube Server&lt;/h2&gt;
&lt;p&gt;安装SonarQube Server到Ubuntu，按照&lt;a href=&quot;https://www.vultr.com/docs/how-to-install-sonarqube-on-ubuntu-16-04&quot;&gt;How to Install SonarQube on Ubuntu 16.04&lt;/a&gt;这个链接的步骤，即可安装成功，这里要注意的是，以上链接提供的方式存在一个问题就是，如果你安装的SonarQube版本是6.7+(推荐装6.7 LTS的版本)，并且你以root权限启动服务，在6.7的&lt;a href=&quot;https://docs.sonarqube.org/display/SONARQUBE67/Release+6.6+Upgrade+Notes&quot;&gt;更新&lt;/a&gt;中，出于安全的考虑，不能以root权限启动，这里切成其他非root权限启动即可，但是在切换用户之后，需要将temp目录下的root文件清除掉。&lt;/p&gt;
&lt;h2 id=&quot;集成sonarqube到项目中&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%9B%86%E6%88%90sonarqube%E5%88%B0%E9%A1%B9%E7%9B%AE%08%E4%B8%AD&quot; aria-label=&quot;集成sonarqube到项目中 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;集成SonarQube到项目中&lt;/h2&gt;
&lt;p&gt;在搭建好SonarQube Server之后，我们需要将其集成到我们的工程目录中，如下图是在整个项目中，SonarQube是怎样工作的：
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 58.10810810810811%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACG0lEQVQoz3VSSW7bQBDkb+Ln5DM6BPADZAFxEESwhdx9yAMC5wP2ITdLEBzF2kjJpEgOF3HncCl3j01FFpAGBuQsXd1dVVrmz5AYdyhlhrKQSLIMQl9hs3jCwrCwcwQMQ4fn+cjoLs9zFEWBspS0SrV43zQNVqsVNM8YwPz9EbJwkKY5UkpKPIEsCrG29wiiDL7vKaAkSSi5RBQFCHwXVVXhOJbLJbTS+wn9YYBob2FPiyOnqkmaUkcpotAnwEAB1nWt7qWMEQQ7us8JPKK9VOez2QzadrujhFgdcNscbdvif1GWBWzHhbBtCOsZj7M/MNY6yqTEeDyGdnb2AcPhN4RhiGdjg9AwVOJkMka/38eXy8/4dH6Oy6vvqGSluhTCxc724LgBvZtAX69R1Q0eGLDX6+HHzQ1x4quxmjde+OFwOMRodI2LwQW+Xo2Iv/zQve9bMM0N0RQhjmN1rkbmTUJgKX1ZxZR4Y+AoitV4XTS1RExCsWgsXhgyhwz0j6LFYgHtmB8piR97rqzgeR5c14HwXLg0IisshFDF2rY55DBYB6jrOjT+bUmMUyFSUpnHMU0DlvWkfLezHfLkXypkKPtQ5jvANXGpHVd5Xc1bt1IZlh+5rqu6Zt+xeLzngl1u5475fP5+5ONgMB7v9vYX7u7vFVjdvPqQlT419QGw64STu8V7NqxPYm23WxrbJCMHisfTd10uF5hOp3gB2K2KBhDwFfEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Integrate SonarQube&quot;
        title=&quot;Integrate SonarQube&quot;
        src=&quot;/static/cc7b0bfec7e88e244c829fd464e36ed8/fcda8/architecture-integrate.png&quot;
        srcset=&quot;/static/cc7b0bfec7e88e244c829fd464e36ed8/12f09/architecture-integrate.png 148w,
/static/cc7b0bfec7e88e244c829fd464e36ed8/e4a3f/architecture-integrate.png 295w,
/static/cc7b0bfec7e88e244c829fd464e36ed8/fcda8/architecture-integrate.png 590w,
/static/cc7b0bfec7e88e244c829fd464e36ed8/efc66/architecture-integrate.png 885w,
/static/cc7b0bfec7e88e244c829fd464e36ed8/1cfc2/architecture-integrate.png 900w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在客户端装上Sonarlint，Sonarlint会在你写代码的时候，应用Sonarlint的规则，检查你当前打开文件&lt;/li&gt;
&lt;li&gt;在你将代码push到SCM上之后，你需要在你的持续集成工具上安装Sonar Scanner，然后在项目根目录下运行Scanner&lt;/li&gt;
&lt;li&gt;Scanner分析完代码之后，将分析结果写会到SonarQube Server（在项目根目录下需要放置Sonar的配置文件），如下：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;    # must be unique in a given SonarQube instance
    sonar.projectKey=#SonarQube项目的key
    # this is the name and version displayed in the SonarQube UI. Was mandatory prior to SonarQube 6.1.
    sonar.projectName=#SonarQube项目名
    # sonar.projectVersion=1.0
    sonar.host.url=#SonarQube搭建的地址
    # Path is relative to the sonar-project.properties file. Replace &amp;quot;\&amp;quot; by &amp;quot;/&amp;quot; on Windows.
    # This property is optional if sonar.modules is set. 
    sonar.sources=#需要分析的代码目录
    sonar.login=#在Sonarqube中生成sha5码，让Sonar Scanner有访问权限
    
    # Encoding of the source code. Default is default system encoding
    sonar.sourceEncoding=UTF-8 # 编码格式&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上在项目根目录下新建一个名为&lt;code class=&quot;language-text&quot;&gt;sonar-project.properties&lt;/code&gt;的文件，按照以上的配置即可。&lt;/p&gt;
&lt;h2 id=&quot;集成sonarqube到bitbucket&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%9B%86%E6%88%90%08sonarqube%E5%88%B0bitbucket&quot; aria-label=&quot;集成sonarqube到bitbucket permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;集成SonarQube到Bitbucket&lt;/h2&gt;
&lt;p&gt;在以上的集成中，存在一个问题就是每次SonarQube分析完之后，开发人员需要自己去SonarQube网站上去查看分析结果，但是如果这次的代码的提交并没有导致问题，那么这次查看明显是浪费时间，如果每次对于新提交的代码，仅仅在出了问题之后才通知开发，这样能够减少开发人员频繁的去查看SonarQube报告。&lt;/p&gt;
&lt;p&gt;我们组里使用的是Bitbucket Cloud做源码的托管，这里有一个&lt;a href=&quot;https://github.com/mibexsoftware/sonar-bitbucket-plugin&quot;&gt;插件&lt;/a&gt;，在你发pull request后，SonarQube分析完结果，如果扫描出问题，会将有问题的代码及原因以comments的形式写到对应的comments上去，非常方便，如果使用Bitbucket的话可以使用这个插件。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;兴趣遍地都是，坚持和持之以恒才是稀缺的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[My Year Of 2018]]></title><description><![CDATA[2018就这样过去了，从参加工作到现在，也工作也一年多了，现在自己也不再像刚毕业一样，在面对工作生活中的出现的一些麻烦问题慌张，不知所措，但是同时也要面对更复杂和麻烦的问题；2018年初的时候自己定过一些目标，虽然并没有10…]]></description><link>http://cuteshilina.com/2018-1-05-MyYearOf2018/</link><guid isPermaLink="false">http://cuteshilina.com/2018-1-05-MyYearOf2018/</guid><pubDate>Fri, 05 Jan 2018 17:00:00 GMT</pubDate><content:encoded>&lt;p&gt;2018就这样过去了，从参加工作到现在，也工作也一年多了，现在自己也不再像刚毕业一样，在面对工作生活中的出现的一些麻烦问题慌张，不知所措，但是同时也要面对更复杂和麻烦的问题；2018年初的时候自己定过一些目标，虽然并没有100%都完成掉，但是主线都是在向这个目标靠近；在这一年里自己也有很多对工作、生活、学习的思考。&lt;/p&gt;
&lt;h2 id=&quot;2018的目标完成了多少？&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2018%E7%9A%84%E7%9B%AE%E6%A0%87%E5%AE%8C%E6%88%90%E4%BA%86%E5%A4%9A%E5%B0%91%EF%BC%9F&quot; aria-label=&quot;2018的目标完成了多少？ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2018的目标完成了多少？&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 37.16216216216216%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABHUlEQVQoz5VRyXKCUBDk/38sVtAKIKEqCriwqCwqIIssdmYGsZLccuiaN3tPP6UsC5imgdnsDZZlwljq8H0PSRzhfq/Rts2/oHBTmsY0ZI/t1sVq9YXDIURR5FLQdfcXpqafsSk+LVeSJBKGlvWJzcZFTMzGprGorktU1Y1sJT6jaSqJT7bvWzwePYahg8JOEHhQ1XcsFnMYhg5N+3jBttdYkgyc03VN8upcJRJLiXMfS+R5OxyP4Tgwjk9wid149uYJF65r0zIfjrOWhv1+B5+wJV/eVM+WCYVhIHMU1oDPdhxbBrBln3G5pLhez/SOEUVH5EWG7JwgSyPSOMPtlostSRJgGE+eRBbBnxpxgsHsBUP7x+/Q9b8/ZvqUb+LND40LROLvAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;2018goals&quot;
        title=&quot;2018goals&quot;
        src=&quot;/static/db69ff27877996fd28bc9b1757c13484/fcda8/2018goals.png&quot;
        srcset=&quot;/static/db69ff27877996fd28bc9b1757c13484/12f09/2018goals.png 148w,
/static/db69ff27877996fd28bc9b1757c13484/e4a3f/2018goals.png 295w,
/static/db69ff27877996fd28bc9b1757c13484/fcda8/2018goals.png 590w,
/static/db69ff27877996fd28bc9b1757c13484/30d16/2018goals.png 672w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;
上图是当时在18年初定的目标，先说一说年初的时候为什么要定这些目标，第一个目标是每周做饭3次，这个当时主要是在工作后，一是觉得外卖难吃卫生情况很差，二是自己对做饭感兴趣，当时坚持过一段时间，周末基本上都会自己做一些吃的，但是每次开火做饭，后面切菜炒菜洗碗很费时间，后面就图方便自己做一些水果沙拉吃，基本上不吃外卖了，要么去店里吃，要么自己做一些沙拉吃；这个目标完成的其实不错。
第二个目标是当时的生活作息很差，晚上基本是都是1，2点睡，经常熬夜。对第二天影响很大，同时自己身体上也开始抗议，以前从来不长痘的，现在脸上也开始长痘，每天想23点30之前上床睡觉，其实对于现在来说挑战很大，基本上躺床上玩会儿手机，很快的就过了12点，在这一年里在睡觉前尽量把手机放在伸手拿不到的地方，玩手机的情况有很大改善。综合一年来平均来看，一般在晚上12点左右睡觉，平均睡眠时间在6个半小时左右；这里的话还是自己的自控力不好，但是看完《睡眠革命》之后，也改变了自己对睡眠的一些认识，这个在后面的文章会谈到。&lt;/p&gt;
&lt;p&gt;第三个目标和工作息息相关，现在的工作集中在前端这块，项目组使用的前端技术栈是&lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt;，工作以后从事前端开发之后，才觉得以前对前端的认识实在太幼稚了，觉得前端不就是写写页面，没有什么技术含量，在学校的时候，很看不上前端，现在做了前端才发现，前端对于开发人员的学习能力、审美、沟通能力都有很高的要求，而且现在&lt;code class=&quot;language-text&quot;&gt;Web&lt;/code&gt;前端这块不再像我认识中的写写页面，更多的是在朝&lt;code class=&quot;language-text&quot;&gt;Web App&lt;/code&gt;发展，很多后端的业务逻辑放在了前端来做，前端这块承载的业务越来越重要。
&lt;code class=&quot;language-text&quot;&gt;Jeff Atwood&lt;/code&gt;是&lt;code class=&quot;language-text&quot;&gt;StackOverflow&lt;/code&gt;的创始人，在他的这篇博客&lt;a href=&quot;https://blog.codinghorror.com/the-principle-of-least-power/&quot;&gt;The Principle of Least Power&lt;/a&gt;中自己提出了了一个&lt;strong&gt;Atwood’s Law&lt;/strong&gt; —&gt; &lt;code class=&quot;language-text&quot;&gt;any application that can be written in JavaScript, will eventually be written in JavaScript.&lt;/code&gt;，在自己入了前端的坑之后，感叹现在&lt;code class=&quot;language-text&quot;&gt;Javascript&lt;/code&gt;的社区的繁荣，基本上在浏览器里JS是绝对的王者，同时&lt;code class=&quot;language-text&quot;&gt;electron&lt;/code&gt;让JS有了编写桌面应用的能力，同时服务端的&lt;code class=&quot;language-text&quot;&gt;Node.js&lt;/code&gt;，移动端的&lt;code class=&quot;language-text&quot;&gt;React Native&lt;/code&gt;，看完这些，真的是倒吸一口凉气，真的想说学不动了。。。&lt;/p&gt;
&lt;p&gt;在上面的目标中基本都是基于自己工作上用到的东西去学习，大致上来说在这一块的完成情况不错，阅读了&lt;code class=&quot;language-text&quot;&gt;React&lt;/code&gt;的事件系统和&lt;code class=&quot;language-text&quot;&gt;fiber&lt;/code&gt;相关的代码，自己也参照网上的资料实现了简单的&lt;code class=&quot;language-text&quot;&gt;Virtual Dom&lt;/code&gt;—&gt;&lt;a href=&quot;https://github.com/Soyn/virtualDOM%EF%BC%8C%60CSS%60%E8%BF%99%E4%B8%80%E5%9D%97%E6%98%AF%E5%BC%B1%E9%A1%B9%EF%BC%8C%60CSS%60%E7%9B%B8%E6%AF%94%E4%BA%8E%60JS%60%EF%BC%8C%E6%9B%B4%E5%8A%A0%E4%B8%8D%E8%AE%B2%E2%80%9C%E9%81%93%E7%90%86%E2%80%9D%EF%BC%8C%E5%BE%88%E5%A4%9A%E5%9D%91%E8%A6%81%E8%B8%A9%E4%BA%86%E4%B9%8B%E5%90%8E%E6%89%8D%E8%83%BD%E7%9F%A5%E9%81%93%E5%92%8C%E7%90%86%E8%A7%A3%EF%BC%8C%E8%BF%99%E4%B8%80%E5%9D%97%E5%9F%BA%E6%9C%AC%E6%98%AF%E7%8E%B0%E5%9C%A8%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%9F%BA%E6%9C%AC%E6%98%AF%E6%98%AF%E5%86%99%E5%A4%A7%E9%87%8F%E7%9A%84%60JS%60%EF%BC%8C%E8%BF%99%E4%B8%80%E5%9D%97%E8%99%BD%E7%84%B6%E8%AF%BB%E4%BA%86%E7%9B%AE%E6%A0%87%E4%B8%AD%E7%9A%84%E4%B8%A4%E6%9C%AC%E4%B9%A6%EF%BC%8C%E4%BD%86%E6%98%AF%E8%AF%B4%E5%AE%9E%E8%AF%9D%EF%BC%8C%E5%AF%B9%E4%BA%8E%60CSS%60%E7%9A%84%E6%8E%8C%E6%8F%A1%E5%B9%B6%E4%B8%8D%E5%A5%BD%EF%BC%8C%E8%BF%99%E4%B8%80%E7%82%B9%E5%BE%97%E8%87%AA%E5%B7%B1%E5%A4%9A%E5%AE%9E%E8%B7%B5%EF%BC%8C%E5%A4%9A%E7%A0%94%E7%A9%B6%EF%BC%9B%60JS%E9%AB%98%E7%A8%8B%60%E4%BB%8A%E5%B9%B4%E5%89%8D%E5%89%8D%E5%90%8E%E5%90%8E%E8%AF%BB%E4%BA%86%E4%B8%A4%E9%81%8D%EF%BC%8C%E4%B8%8D%E5%BE%97%E4%B8%8D%E8%AF%B4%EF%BC%8C%60JS%E9%AB%98%E7%A8%8B%60%E8%BF%99%E6%9C%AC%E4%B9%A6%E5%BA%94%E8%AF%A5%E6%AF%8F%E5%B9%B4%E6%8B%BF%E5%87%BA%E6%9D%A5%E8%AF%BB%E4%B8%AA%E4%B8%80%E4%B8%A4%E9%81%8D%EF%BC%9B%60HTTP%60%E8%BF%99%E4%B8%80%E5%9D%97%E6%AD%A3%E5%9C%A8%E5%AD%A6%E4%B9%A0%EF%BC%8C%E6%8C%89%E7%85%A7%E8%87%AA%E5%B7%B1%E7%9A%84%E8%A7%84%E5%88%92%E5%9C%A8%E8%B5%B0%EF%BC%9B%E5%89%8D%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%60Webpack%60%E3%80%81%60Gulp%60%E3%80%81%60Grunt%60%E8%BF%99%E4%B8%80%E5%9D%97%EF%BC%8C%E5%BD%93%E6%97%B6%E6%98%AF%E5%9B%A0%E4%B8%BA%E8%87%AA%E5%B7%B1%E5%9C%A8%E7%BB%84%E9%87%8C%E8%B4%9F%E8%B4%A3%E6%9E%84%E5%BB%BA%E8%BF%99%E4%B8%80%E5%9D%97%EF%BC%8C%E5%90%8C%E6%97%B6%E4%B9%9F%E5%81%9A%E4%BA%86%E4%B8%80%E4%BA%9B%E4%BC%98%E5%8C%96%E7%9A%84%E5%B7%A5%E4%BD%9C%EF%BC%8C%E5%BD%93%E6%97%B6%E5%AF%B9%E8%BF%99%E4%B8%80%E5%9D%97%E6%83%B3%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0%E4%B8%80%E4%B8%8B%EF%BC%8C%E4%BD%86%E6%98%AF%E4%BB%8E%E6%88%91%E8%87%AA%E8%BA%AB%E7%9B%AE%E5%89%8D%E7%9A%84%E6%83%85%E5%86%B5%E6%9D%A5%E8%AF%B4%EF%BC%8C%E7%8E%B0%E9%98%B6%E6%AE%B5%E5%AD%A6%E4%B9%A0%E8%BF%99%E4%BA%9B%E5%B9%B6%E4%B8%8D%E6%98%AF%E4%B8%80%E4%B8%AA%E6%8A%95%E5%85%A5%E4%BA%A7%E5%87%BA%E6%AF%94%E9%AB%98%E7%9A%84%E4%BA%8B%E6%83%85%EF%BC%8C%E6%89%80%E4%BB%A5%E5%9F%BA%E6%9C%AC%E4%B8%8A%E8%BF%99%E4%B8%80%E5%9D%97%E6%B2%A1%E6%9C%89%E6%B7%B1%E5%85%A5%E7%9A%84%E5%AD%A6%E4%B9%A0%E3%80%82&quot;&gt;https://github.com/Soyn/virtualDOM，`CSS`这一块是弱项，`CSS`相比于`JS`，更加不讲“道理”，很多坑要踩了之后才能知道和理解，这一块基本是现在的工作基本是是写大量的`JS`，这一块虽然读了目标中的两本书，但是说实话，对于`CSS`的掌握并不好，这一点得自己多实践，多研究；`JS高程`今年前前后后读了两遍，不得不说，`JS高程`这本书应该每年拿出来读个一两遍；`HTTP`这一块正在学习，按照自己的规划在走；前端构建工具`Webpack`、`Gulp`、`Grunt`这一块，当时是因为自己在组里负责构建这一块，同时也做了一些优化的工作，当时对这一块想深入学习一下，但是从我自身目前的情况来说，现阶段学习这些并不是一个投入产出比高的事情，所以基本上这一块没有深入的学习。&lt;/a&gt;

上面基本上是自己在年初对自己的一些期望，总体来说完成度在70%左右，整体来说18年定的这些目标并不是什么完成难度很大的目标，但是并没有100%完成，刚好一年过去了，自己复盘一下。&lt;/p&gt;
&lt;p&gt;一般来说我下班时间在18点半左右，回到家吃完饭大概在19点半左右，基本上我会在22点左右去洗漱，22点30左右上床睡觉，中间会有两个半小时的空闲时间，但是一般吃完饭，想着工作了一天，得犒劳一下自己，我一般会上&lt;code class=&quot;language-text&quot;&gt;Youtube&lt;/code&gt;看看我关注的博主的视频，然而得益于&lt;code class=&quot;language-text&quot;&gt;Youtube&lt;/code&gt;牛逼的推荐算法，我一般20点30或者21点，才能真正的投入到学习上，虽然每次知道自己在浪费时间，但是自己停不下来，白白的浪费一个半小时在无用的消遣上；这一块自己也在改进，慢慢的将时间压缩在30分钟左右；原来对自己定的计划是每天早上7点起来，想着可以在上班一个小时前，看一些书，但是基本上起不来；&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 562px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 10.135135135135135%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAe0lEQVQI1zWMQQqDMBREvf/lXEihWHcubI3GREyC/ye+2kAXwwxvhmkWt/JeZ9qupXs++FiDcQsxRWKMjONI3/es1qIqpJQ4z7NqNobXMDBNU93KzZqrXHcQnHPsfkdFuUpBRMg5E0KonapW/fnP7bbhvcfcx8cRKCXzBfBVmQrfipDwAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;waste time&quot;
        title=&quot;waste time&quot;
        src=&quot;/static/5c4fb450c9ec10ca141c10e50192f823/6e88f/waste_time.png&quot;
        srcset=&quot;/static/5c4fb450c9ec10ca141c10e50192f823/12f09/waste_time.png 148w,
/static/5c4fb450c9ec10ca141c10e50192f823/e4a3f/waste_time.png 295w,
/static/5c4fb450c9ec10ca141c10e50192f823/6e88f/waste_time.png 562w&quot;
        sizes=&quot;(max-width: 562px) 100vw, 562px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;如上图的数据，基本上每周会浪费掉12.5个小时左右，一年浪费了600个小时，换算成天来算的话，是25天，平时觉得没什么，其实仔细一算，浪费了不少时间，如果能有效的利用起来，其实能干好不少事；但是合理的消遣还是有些必要的，也许你会说，为什么把自己搞的这么累？工作了一天，休息不是很正常，emmmmm，其实我并不排斥休息娱乐，只是对于我来说过度了而已，本质上来说是自制力不够，同时，自己定目标也是为了提高自己的自制力，人类和动物最大的区别不是人会使用工具，而是人类懂得控制自己；个人有个人不同的看法，对于我自己来说，现在这个年龄是精力最好、学习能力最强的时候，娱乐和享受，是个人都很乐意，但是这些东西适度就好了，自己要懂得掌握这个度，如果定了目标，不管遇见什么样的困难，自己要尽力去完成，并且在做事的时候，不仅仅满足于完成，要把这件事做好，这是我自己对我自己的基本要求。&lt;/p&gt;
&lt;h2 id=&quot;2018我的生活有哪些改变？&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2018%E6%88%91%E7%9A%84%E7%94%9F%E6%B4%BB%E6%9C%89%E5%93%AA%E4%BA%9B%E6%94%B9%E5%8F%98%EF%BC%9F&quot; aria-label=&quot;2018我的生活有哪些改变？ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2018我的生活有哪些改变？&lt;/h2&gt;
&lt;p&gt;2018生活上比较大的一个的改变就是在下半年的时候，重新做回了单身狗，自己的感情的私事就不谈了；但是当自己回头再来审视这段感情的时候，其实感情这回事没有谁对谁错，只有合适不合适；也重新开始思考爱情和婚姻，其实从概率上来讲，全球70亿人左右，中国人口在14亿左右，你找到所谓的Mr/Mrs.Right的概率基本上是不可能的，所以我不再抱期望于能够遇见那个对的人。&lt;/p&gt;
&lt;p&gt;另外的改变当然就是收入上升了，基本上在现在的城市里，不买房（也买不起）能够过的很爽，基本上自己喜欢的东西，不是特别贵的话的话自己也能很随意了，虽然比不上土豪，但是自己用自己挣的钱，能买自己喜欢的东西，养自己的爱好的感觉还是很爽的。&lt;/p&gt;
&lt;p&gt;我今年觉得最大的改变是，我开始重新审视自己，从旁观者的角度去看自己，不再以自我的视角去认知这个世界，以前做事为人都是自己先入为主，把自己的视角带入进去，其实现在看来，这是很不对的，本身每个人都不是一座孤岛，在合作做事情、社交上，多去聆听他人不同的想法，不急于反驳，本身目的是把事情做好，并不是要去争个高低，而且每个人的知识都是有边界，思考问题难免有疏忽和遗漏的地方，其实承认自己错了，并没有那么难。&lt;/p&gt;
&lt;p&gt;在工作和生活中，这一年里我发现自己对情绪的管理做的并不好，本质上来说，就是是好面子，不愿面对自己的无知和不足，这里只有提高自己的知识水平，对于不同或者更好的东西要善于学习和接纳，负面情绪其实对于解决问题来说起不上任何作用，但是是个人都会有情绪，这也是人相比于机器来说的一大缺陷，人的产出和效率在不同的情绪下会有很大的差别，但是情绪是可以管理的，一方面提高自己的能力，一方面学习管理和控制自己的情绪。&lt;/p&gt;
&lt;h2 id=&quot;2018我看了哪些书？&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2018%E6%88%91%E7%9C%8B%E4%BA%86%E5%93%AA%E4%BA%9B%E4%B9%A6%EF%BC%9F&quot; aria-label=&quot;2018我看了哪些书？ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2018我看了哪些书？&lt;/h2&gt;
&lt;p&gt;2018年看的书主要还是集中在技术方面，这里是自己的安身立命的本钱，另外看了一些技术以外的几本书，技术书我就不说了，在看过的几本非技术的书，我在这里介绍一下。&lt;/p&gt;
&lt;p&gt;先说一下我挑选书的习惯，一般来说，对于书的选择，我会参考豆瓣的书评和豆瓣的推荐，同时在知乎上有很多推荐书的答案，从这些里面去阅读自己感兴趣的书，剩下的挑选原则就是，去世的作家的评分高书&gt;评分高的书，这里很有趣的点是，为什么优先选择去世的作家，因为从人类历史上来说，各种书多如牛毛，那些不优秀的作家的作品，早就淹没在历史中，留下的，大部分是经过很多人阅读，才能传到现在，时间其实给了你最好的挑选标准。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://book.douban.com/subject/3151575/&quot;&gt;《激荡三十年》&lt;/a&gt;这本书是我在知乎上的某个答案上推荐的，本身我们90后其实对改革开放这个话题是没有这么敏感的，只记得初高中的历史课本上讲过，这本书从78年讲到08年，时间跨度30年，这里主要是以企业家、集体企业这个角度来讲述这段历史，其实短短的30年，中国在这段时间里发生着巨大的变革，从共产主义的理想到黑猫白猫抓到老鼠就是好猫，我们90后其实是改革开放的受益者，我们上一辈人，无不被这段历史的洪流裹挟着行走，也感叹上一代人的勤劳和艰苦奋斗，如果换做是我会到那个动荡的年代，我是不是能做的比他们好？&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://book.douban.com/subject/26835090/&quot;&gt;《软技能—代码以外的生存指南》&lt;/a&gt;这本书是通过豆瓣的推荐看到的，作者是&lt;code class=&quot;language-text&quot;&gt;John Sonmez&lt;/code&gt;，记得很早以前在&lt;code class=&quot;language-text&quot;&gt;Youtube&lt;/code&gt;上订阅过这个人的&lt;code class=&quot;language-text&quot;&gt;channel&lt;/code&gt;，但是基本上没看过，后面才发现这本书的作者和这个&lt;code class=&quot;language-text&quot;&gt;channel&lt;/code&gt;是同一个人，这本书怎么说呢，对于软件从业人员，我认为有价值的观点在于，软件开发人员要有从技术上跳出来的自觉，懂得营销自己，&lt;code class=&quot;language-text&quot;&gt;talk&lt;/code&gt;并不&lt;code class=&quot;language-text&quot;&gt;cheap&lt;/code&gt;，另外就是如果你是一个水平在行业平均水平的从业人员，在现今的行业待遇下，你注定会有一个不错的收入，但是要懂得如何管理自己这笔财富，而不是挥霍；另外作者对于工作的看法，也值得一读，我们大多数是在为雇主工作，很多人仅仅作为一个打工者的态度去做事，我以前也是这种想法，读完这本书之后，开始重新审视自己的这份工作，从作者的角度来看，要有为自己工作的态度去对待工作，想象一下你是你自己开的公司一件产品，雇主使用你公司的产品，你要做的是，打磨自己的产品，给雇主提供好的服务；另外就是作者对于退休的看法很有趣，也改变了我对财务自由的看法，作者认为如果你每个月的支出是3000，如果你除了工作之外的所得超过了3000，那么你就可以进入退休生活，辞掉你那&lt;code class=&quot;language-text&quot;&gt;fucking job&lt;/code&gt;，走向财务自由之路；看完这本书，还是增长了自己对工作、金钱、生活的看法，人总归要为自己而工作，具体怎样到达这个目标，我也在寻找和探索。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://book.douban.com/subject/27023900/&quot;&gt;睡眠革命&lt;/a&gt;这本书是在知乎上看睡眠相关的答案发现的，不得不说，改变了我以前对8小时睡眠的看法，用科学的手段去调整自己睡眠，作者提出了&lt;code class=&quot;language-text&quot;&gt;R90&lt;/code&gt;的概念，就是以90分钟为周期来安排你的睡眠，每个人每天至少保证4周期的睡眠，最好每天是5个周期的睡眠，比如你想6点30起床，那么你得23点进入睡眠状态，那么往前推你最好22点30上床，保证在23点能够进入睡眠，如果你超过了23点睡，那么就推迟到下一个周期00:30睡，这里我自己也在实践这个做法，确实有效，同时也不在计较每天睡了几个小时，而是以周期来计算自己的睡眠，同时还有其他对睡眠有帮助的做法，如果你想改变自己的作息习惯，推荐阅读和实践。&lt;/p&gt;
&lt;p&gt;以上是我从非技术书中挑选出的几本我觉得值得读的书，总体来说18年并没有阅读很多技术以外的书，其实阅读这个习惯越早培养越好，特别是现在互联网的发展，让阅读触手可及，但是我不是指网络小说、爽文这些，这些对某些人来说有意义，对我而言我不会去阅读这些，阅读的时候其实也是跟着作者在思考自己、思考生活，如果有时间刷抖音、逛淘宝、追脑残剧，为什么不能腾些时间来阅读呢？说白了，阅读好的东西，并不能及时的给你有效的反馈，通常那些对你马上有正反馈，短效而无用的东西，我一贯保持远离的态度。&lt;/p&gt;
&lt;h2 id=&quot;2018有哪些推荐的东西？&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2018%E6%9C%89%E5%93%AA%E4%BA%9B%E6%8E%A8%E8%8D%90%E7%9A%84%E4%B8%9C%E8%A5%BF%EF%BC%9F&quot; aria-label=&quot;2018有哪些推荐的东西？ permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2018有哪些推荐的东西？&lt;/h2&gt;
&lt;p&gt;这里主要推荐我今年发现的一些不错的东西：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;今年开始在听一些播客，在谷歌的不错的中文播客的时候偶然发现了&lt;code class=&quot;language-text&quot;&gt;得意忘形&lt;/code&gt;这个播客，作者是张潇雨，人大毕业，华尔街高盛出身，经常和另一个斯坦福的何峰一起做节目，基本上一期在一个小时左右，我一般在跑步的时候听，作者和作者的朋友，基本上都是有很好的东西方教育背景的，如果有听播客的习惯可以关注一下这个节目，听听世人眼中的投行精英、牛逼闪闪的名校的人是怎样的态度去对待这个世界：&lt;a href=&quot;https://zhuanlan.zhihu.com/p/24925951&quot;&gt;得意忘形&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;今年还发现了一些很厉害的的视频博主，这两年视频自媒体很火，Vlog也属于这一种，自己对摄影视频这块也有兴趣，经常看一些博主拍的视频，下面是值得推荐的一些博主：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://space.bilibili.com/87866439/&quot;&gt;Sandyflare&lt;/a&gt;B站up主Sandyflare，辞职做自媒体，视频的故事性，剪辑，调色都不错，像他自己的B站介绍一样，&lt;code class=&quot;language-text&quot;&gt;一个知道自己在做什么的人&lt;/code&gt;，没有什么比这个更酷的东西了。&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://luolei.org/&quot;&gt;罗磊的博客&lt;/a&gt;这个是我大四的时候一直关注的博主，以前是阅文集团的前端开发，大学读的是文科，自学的前端，骑行过西藏，前段时间阅文上市，好像期权兑现了，辞职创业，现在全职做自媒体。&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://space.bilibili.com/946974?from=search&amp;#x26;seid=490623181869776322&quot;&gt;影视飓风&lt;/a&gt;和&lt;a href=&quot;https://space.bilibili.com/110974&quot;&gt;视频大拍档&lt;/a&gt;这两个是搞自媒体的大佬，主要是讲视频拍摄的一些tips，对拍摄视频感兴趣的可以看一看&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Peter McKinnon&lt;/code&gt;是&lt;code class=&quot;language-text&quot;&gt;Youtube&lt;/code&gt;上非常厉害的视频博主，每次视频开头就是一句“PWhat’up everybody”， 视频的质感和节奏都很好，B站上好像有从&lt;code class=&quot;language-text&quot;&gt;Youtube&lt;/code&gt;搬运过来的。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;每天在工作之前，我推荐使用&lt;code class=&quot;language-text&quot;&gt;Trello&lt;/code&gt;看板工具来管理自己每天要干的事情，将每天做的事记录下来，这样每周写周报也有得写；同时其他的工作之外的活动，可以使用&lt;code class=&quot;language-text&quot;&gt;google calendar&lt;/code&gt;，用来安排自己每天要做的事，周末的时候用&lt;code class=&quot;language-text&quot;&gt;google calendar&lt;/code&gt;安排活动，每周或者每月都可以看到自己的时间花费，便于调整和重构自己的计划。&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;我每年都会对前一年做总结，不是矫情，只是自己要对自己负责，经常复盘，发现自己的问题，及时修正，同时写文章也是在创作，写作的过程也是和自己交流的过程；上次听得意忘形说到死亡的话题，谈到作家博尔赫斯在他的小说《永生》中写道，&lt;code class=&quot;language-text&quot;&gt;死了，就像水消失在水中&lt;/code&gt;，人们对生命的延续，一般来说有三种形式，第一种是认为神会来救赎你；第二个是浪漫主义，认为爱会让生命永恒；第三种就是创作作品，即使你人已经消失，但是你的作品会留下。

新的一年，对自己也有不同的期待，以前看过一个电影影评《降临》（原著小说《你一生的故事》），科学家和外星人交流，科学家试图弄懂外星人的文字的含义，当她精通了外星人的语言之后，她从女儿的出生看到了女儿未来的每一天直到死去，如果换做是你，你能提前知道结局，你会怎样去选择？或者是你还有选择吗？&lt;/p&gt;
&lt;p&gt;如果是我的话，我会选择不去知道结局，现在的你是过去的你成就的，未来交给时间。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;兴趣遍地都是，坚持和持之以恒才是稀缺的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[在21岁的时候写给25岁的自己]]></title><description><![CDATA[偶然的一个机会了解到V2EX这个网站，顺手搜了一下V站创始人的信息，Livid（刘昕）是谁？，Livid中文名刘昕，V2EX论坛作者。顺道看了一下Livid的一篇文章 26岁写给18岁的自己 我知道现在的自己是再也回不去的了。可是倘若有机会，我是多么希望能让 1…]]></description><link>http://cuteshilina.com/2016-11-26-写给25岁的自己/</link><guid isPermaLink="false">http://cuteshilina.com/2016-11-26-写给25岁的自己/</guid><pubDate>Sat, 26 Nov 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;  偶然的一个机会了解到V2EX这个网站，顺手搜了一下V站创始人的信息，&lt;a href=&quot;https://www.zhihu.com/question/19577697&quot;&gt;Livid（刘昕）是谁？&lt;/a&gt;，Livid中文名刘昕，V2EX论坛作者。顺道看了一下Livid的一篇文章&lt;/p&gt;
&lt;blockquote&gt;
&lt;h1 id=&quot;26岁写给18岁的自己&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#26%E5%B2%81%E5%86%99%E7%BB%9918%E5%B2%81%E7%9A%84%E8%87%AA%E5%B7%B1&quot; aria-label=&quot;26岁写给18岁的自己 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;26岁写给18岁的自己&lt;/h1&gt;
&lt;p&gt;我知道现在的自己是再也回不去的了。可是倘若有机会，我是多么希望能让 18 岁的你在一个晴朗的，没有负担的午后读到这封信，并且多么希望你能够将它读上好多遍。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;这样的场景或许只会发生在奇幻电影中，26 岁的我坐在这里一字一字写下给 18 岁的你的文字，当文字就这么不停地落下，周遭的景致便不停变化，有的记忆会消失，有的记忆会莫名浮起，不知处在什么年岁的夹在中间的我，就像是芝诺悖论中的阿喀琉斯或那只乌龟，不知道谁会最终超过谁。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;而此时此刻，在这个世界上，还有无数的像你一样 18 岁的少年，他们绝对无法知道在他们人生未来的岁月里将会发生的。有一天他们也会到 26 岁，那个时候他们会希望未来的自己游回这 8 年的时间河流，和青春的自己长谈么？&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;这些文字恐怕不可避免地会带有说教的意味，并非是现在的自己觉得那时的你做的不好。只是，你所做的每一件事，都会基于你当时所掌握的所有信息量。如果信息量发生改变，你所做的决定和之后的实际行动也就会必然发生改变。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;h3 id=&quot;身体&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%BA%AB%E4%BD%93&quot; aria-label=&quot;身体 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;身体&lt;/h3&gt;
&lt;p&gt;你的身体是你最宝贵的、首要的一切。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;未来你所拥有的最有创造力的时间是固定的，你最有想象力的那些创造需要的是彻底不被打扰的时间，而保有完美的身体，将会始终保证你能够将你的最好的时光都用在最美好的事情上。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;不要挑食，你需要每天都均衡地摄入各种食物，那些能够让你健康的食物，不要太多，也不要太少。你需要学会为自己的所有事情做计划，你会先根据直觉，为自己设定一个健康的食谱，然后再逐渐调整它。你的所有计划需要放在一个你能够经常看到的地方。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;随着你脑中的事情越来越多，你可能会越来越忽略自己的身体。所以你不仅需要的是对于保护身体的持续提醒，你更需要的是良好的习惯。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;每天睡觉之前，和睡醒之后，一定要记得刷牙，并且要用牙线，只是不要用力过猛。用完牙线之后，记得用漱口水，一定要含足 30 秒之后再吐掉。只用李施德林牌的漱口水，具有强烈刺激性的味道，没准可以启发你的灵感。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;在你的人生中，你可能不可避免地会有一段时间必须在夜深人静的时候才能完成自己的想法。不要让这样的生活方式成为常态。你应该每天晨跑，还记得 15 岁中考前为了拿体育满分的每日晨跑么？晨跑是一件会上瘾的，对你的一切都有好处的事情。为了提醒自己养成这个良好习惯，用一个专门的本子记下自己每个月跑的公里数，每页一个月，每行一天，那么在 30 岁时，你就会有一本写满了跑步公里数的 144 页的本子，这只是半本中文版《一九八四》的厚度。而 12 年间，你会至少跑过 10000 公里。这不是一件这个世界上的所有人都能做到的事情，但是如果你做到了，那么在你试着去完成别的事情的过程中，这件事情会给你信心。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;另外就是，不要喝任何太甜的饮料，尤其是碳酸饮料。不过，在你头痛的时候，你或许可以稍微喝一点点可口可乐，这东西对缓解头痛确实有点效果。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;h3 id=&quot;精神&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%B2%BE%E7%A5%9E&quot; aria-label=&quot;精神 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;精神&lt;/h3&gt;
&lt;p&gt;读《圣经》。找到一个轻便的版本，放进你随身的包里。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;在你高兴的时候，痛苦的时候，困惑的时候，想到里面的句子，打开它，静静地读。和你爱的人分享你从阅读《圣经》中所体会的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;你要相信，这个世界上存在着一种最高的道德和标准，你知道这样的存在却并不知道其具体的面貌，只是，在你面临选择的时候，想到书中的那些话，想想自己要如何做会让他高兴和认可。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;每个月至少读一本和自己专业无关的书，为自己读过的书写下一点什么。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;看你能找到的所有电影，从 IMDB TOP 250 开始看，记下喜欢的导演的名字，去 Wikipedia 看他的人生经历，找他的其他电影来看。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;这个世界会将很多的音乐推入你的耳朵，而有些特别的音乐需要你自己去寻找。找到巴赫的所有音乐去听，不要错过 GEB 这本书，这会是一本你在人生不同的阶段用自己不同的信息量去读的一本书。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;h3 id=&quot;朋友&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%9C%8B%E5%8F%8B&quot; aria-label=&quot;朋友 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;朋友&lt;/h3&gt;
&lt;p&gt;在你的人生中，你不可避免地会遇到很多人。而越往后，你所遇到的人对你而言的情况就越复杂，恐怕你们也就越难成为一生的好朋友。而那些你很早就遇到，现在却依然在你身边的人，你需要付出努力让他们能够一直在你身边，他们是你一生的朋友。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;这些努力包括：&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;不要简单地觉得别人错了，很多时候可能是因为自己没有仔细读说明书或是往来邮件。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;忘掉你为朋友做的事情 。&lt;/li&gt;
&lt;li&gt;当你有负面情绪的时候，不要把任何人想成坏人。转移注意力，用音乐和电影去挤掉脑中的负面情绪，一天，两天，一周，两周，一年，两年后，你会看到别人在变，或者你已忘记。&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;h3 id=&quot;整理&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%95%B4%E7%90%86&quot; aria-label=&quot;整理 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;整理&lt;/h3&gt;
&lt;p&gt;你需要持续地整理自己周遭的一切。因为你处在的这个世界所指向的趋势是无序的。如果你自身不做足够多的努力，你就会被这样的无序性所吞噬。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;暴露在空气中的食物在一个星期之后就会变坏，沙滩上堆砌的小城堡会被风和海浪还原成沙子，这一切都是因为我们所处在的这个世界的熵在升高。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;而生命的诞生、发展和存在的过程却是与此相反的，虽然生命的最终结局是熵到达最大值时吞噬一切意义，但是那个时刻离现在的我们还有几十年的时间。而在这几十年里，你需要持续整理你周遭的一切。这或许可以理解为一种对抗，也可以被认为这就是生命的意义。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;h3 id=&quot;积累&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%A7%AF%E7%B4%AF&quot; aria-label=&quot;积累 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;积累&lt;/h3&gt;
&lt;p&gt;整理的结果，就是你的积累。而你能对这个世界所产生的有益贡献，就是你以自己的方式所积累的。而你从这个世界所获得回报，由你所积累的质量决定。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;所以，在你 18 岁，甚至更早的时候，你就应该已然找到一个你能够积累的方向，也可以说成是兴趣的。然后你接下来所做的，就是让这个方向上所有的信息都尽可能多的汇聚到你的大脑中，你的记忆或者说潜意识就像一片大海一样当然是能够装下这一切的。然后，想象你从 20000 米的高空俯瞰大地，大地上是你日复一日所积累的信息，然后你将他们分类，合并，丢弃那些质量低劣的。你见得越多，你就越明白什么算是质量低劣的，也就必然丢得越多。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;积累某个方向上的信息量是你一辈子的工作的本质。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;你所积累的信息量，最终需要传递到别人那里去。当有越多的人需要你所积累的信息时，这个世界也就会自然给你越丰厚的回报。所以，你需要时不时的问问自己，自己现在在积累的这些信息，由这些信息所创造的现实存在，究竟能够帮助到多少人，又被多少人所必需。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;而这一切或许不会在积累之初便看得很清楚。但是，当你在做正确的事情时，你就会自然从这个世界的各个角落听到对于你所做的事情的讨论乃至感谢。这一切或许会需要时间，但是你不要觉得自己是在等待什么，你只是在持续地，习惯性地积累自己所爱的方向上的信息量。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;  看完之后能够感受到Livid对生活的理解，很多事情要经历了才能感同深受，但是每个人的受到自身的活动范围、社会环境的限制，并不能够一一经历，但人类聪明的一点就是能够从别人的经历中去学习，不论是他人成功或失败的经历，阅读是获取这些知识的有效途径，有些人说旅行才是，这里我不敢苟同，但是也不否认旅行确实有作用，但就好像很多人说的一辈子一定要去一趟西藏一样，好像你真的去了一趟西藏，你的心灵就真的能够净化一样，心是龌龊的，不管你去了哪里，还是龌龊的。&lt;/p&gt;
&lt;p&gt;  最近在知乎的timeline上出现了&lt;a href=&quot;https://www.zhihu.com/question/52178718&quot;&gt;25 岁做什么，可以在 5 年后受益匪浅？
&lt;/a&gt;，看了几个答主的答案，我想如果我到了25岁，我会不会问自己同样的问题，感谢知乎，让我看到了更大的世界，也意识到了，有时候人与人之间的差距，比人和狗还大，大二的时候看到知乎，然后每天花费2～3个小时泡在上面，慢慢的也意识到了，你在网络上看到的，只是他们想让你看到的样子，无论是知乎、微博、微信、豆瓣，天天看心灵鸡汤，泡在网络上是没有什么用的，真正的知识在书本上，与其临渊羡鱼，不如退而结网。慢慢的我也要从学校过渡到社会，我想在21岁的时候，写给25岁的时候的自己，希望那时的自己能不辜负21岁的我。&lt;/p&gt;
&lt;blockquote&gt;
&lt;h2 id=&quot;在21岁的时候写给25岁的自己&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%9C%A821%E5%B2%81%E7%9A%84%E6%97%B6%E5%80%99%E5%86%99%E7%BB%9925%E5%B2%81%E7%9A%84%E8%87%AA%E5%B7%B1&quot; aria-label=&quot;在21岁的时候写给25岁的自己 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;在21岁的时候写给25岁的自己&lt;/h2&gt;
&lt;p&gt;  首先感谢你能在繁忙的工作或者学习中打开了这篇文章，也许是在深夜，也许是在某个清晨，或是在某个失意的时刻，这个时候当你看到当年写下的文字，心里无论是感到可笑，还是感到幼稚，请好好的生活，不要辜负了21岁的你对你的期望。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;  25岁的你不出意外如果还在工作而没有选择继续上学，国内的话应该还是会在北上广深杭这几个城市，面对高昂的房价，是选择留下还是离开，这永远是个烦人的问题，其实没有必要这么着急，你20岁想要的超出你能力的东西，等你到30岁的时候那些东西也不过如此，当所有人都在劝你离开的时候，你要看一看这群人是不是比你更厉害，是不是比你更聪明，你要听一听自己内心的声音，也许离开了，就再也不会回来了，他们会给你说租房租不了一辈子，会给你说你要结婚没房子怎么办，没有户口孩子上学怎么办，房子虽然是租的，但是生活不是，你肯定会找到一个即使你在一线城市没有房子也愿意和你结婚的姑娘，如果现在没有，那再等等，她可能会迟到，但是不会不来。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;h3 id=&quot;身体-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%BA%AB%E4%BD%93-1&quot; aria-label=&quot;身体 1 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;身体&lt;/h3&gt;
&lt;p&gt;  在新闻和网络上看到了不少程序员加班猝死的新闻，这时候的你也许正在加班，或者是在刚加完班回家的路上，但是记住，公司离开了你照样挣钱，地球没了你照样转，而你家人朋友只有你一个。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;  如果可以的话，我希望这时候的你已经有了健身的习惯，不要求八块腹肌，也不要求能够卧推多少公斤，只希望你能够每天坚持跑步，不要有隆起的啤酒肚，不要因为工作压力大、或者是感情不顺而开始抽烟。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;  不要熬夜打游戏或者看电影，请尽量早起，能慢慢学会做饭，保证营养，不要天天叫外卖，每天早餐一定要吃，碳酸饮料尽量不要喝。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;h3 id=&quot;工作&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%B7%A5%E4%BD%9C&quot; aria-label=&quot;工作 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;工作&lt;/h3&gt;
&lt;p&gt;  这时候的你已经有了一点工作经验，如果不考虑跳槽的问题，不是太差劲，那么肯定是组里的中坚力量了，也许这个时候也开始带一个和当年21岁的你一样的程序员了，希望你能好好引导，做个好师傅。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;  身边的同事不论你是否喜欢，请一定不要把这种情绪带到工作上来，你领公司发的薪水，把工作做好是你分内的事情，不要因为个人的情绪影响工作，也不要想着和同事能成为特别好的朋友，不要一开始就把自己的所有暴露给一个你并不了解的人，有时候人心并没有你想的那么好。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;  如果这个时候你已经能够游刃有余的处理好工作上的事情了，请也不要停止学习，不要满足，你干的行业更新迭代本来就快，停止学习，迟早会被淘汰。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;  这个时候你可能会对领导感到不满，骂领导傻逼，如果没有充分的理由或者数据，或者证据，请闭嘴，如果你眼中所谓的傻逼，能拿你几倍的工资，请你自己想想到底谁是傻逼，多做少说，别听别人瞎逼逼，说认真干活没用，你活干不出来，就算你长十张嘴，又有什么用。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;h3 id=&quot;学习&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AD%A6%E4%B9%A0&quot; aria-label=&quot;学习 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;学习&lt;/h3&gt;
&lt;p&gt;  这个时候技术上的东西，自己也已经知道自己缺啥，自己也知道该学啥了，希望这时候的你能有除了编程以外的爱好。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;  请不要放弃写作和阅读，读更多的好书，坚持写博客，就算只是是吐槽。每年能抽出时间去旅行，去不一样的地方看看，读万卷书的同时行万里路才是旅行的意义。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;h3 id=&quot;生活&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%94%9F%E6%B4%BB&quot; aria-label=&quot;生活 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;生活&lt;/h3&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;  这时候希望你能有一段稳定的感情，有能够理解和支持你的女朋友，但是如果没有，也不要失望，就算是一个人，也要过的很有趣。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;  这时候希望你能有一定的积蓄，至少能够保证你即使一年不工作，原有的生活质量不会受影响，如果可以的话，最好能投资一点理财产品。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;  要尽量变得内敛、隐忍，记住不是所有人都值得你真诚相待；一直陪在你身边的朋友，一定要好好维持和珍惜，但是这种朋友，有一两个就好。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;  这时候要有一定承受风险的能力，包括家人突如其来的疾病、突然失业，或者其他的一些问题的出现，固定的投资收益往往能够抵御掉这些风险，银行的利率永远赶不上通货膨胀，如果自己没有投资理财的思维，或者没有时间去研究这些东西，花钱去找专业的咨询是更划算的，这时候，往往时间比钱更重要。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;  希望这时候的你已经能够很好的照顾自己和他人，不让家人为你操心，也能让你成为家人的依靠，学会爱人爱己。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;  最后，想给25岁的你说，即使以上说的所有事你都没有办到，请你也不要失望和灰心，21岁的你最近爱听的一首歌叫《成都》，里面一句歌词说到“直到所有的灯都熄灭了也不停留”，如果你这时候感到失望、沮丧，请你打开手机再听一次，人生就是不断的move on。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;兴趣遍地都是，坚持和持之以恒才是稀缺的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[愿路途不再往复]]></title><description><![CDATA[找工作的事情总算是告一段落，在资本寒冬来临的时候，自己也是十分好运的搭上了互联网的末班车，比起身边其他人，我找工作的过程也没有多艰辛，暑期的时候同学内推了现在的公司，然后视频面试，两轮技术面，一轮hr面，9月初的时候拿到了意向offer，…]]></description><link>http://cuteshilina.com/2016-10-02-愿路途不再往复，愿无岁月可回头/</link><guid isPermaLink="false">http://cuteshilina.com/2016-10-02-愿路途不再往复，愿无岁月可回头/</guid><pubDate>Sun, 02 Oct 2016 17:00:00 GMT</pubDate><content:encoded>&lt;p&gt;  找工作的事情总算是告一段落，在资本寒冬来临的时候，自己也是十分好运的搭上了互联网的末班车，比起身边其他人，我找工作的过程也没有多艰辛，暑期的时候同学内推了现在的公司，然后视频面试，两轮技术面，一轮hr面，9月初的时候拿到了意向offer，9月底的时候拿到了正式的聘用书，拿到意向offer后基本上就没跑过招聘会，但是等到9月底的时候实在是等到崩溃了，在学校笔试了几个公司，去西电笔试了一场，基本上都拿到面试机会了，奇怪的是笔试我觉得我答的可以的没有过，笔试答的不好的，反而拿到面试，始终搞不明白改卷子的人的评判标准，找工作时候如果招聘会有现场笔试尽量参加，现场笔试往往当天晚上或者第二天就出结果，网上笔试我觉得是最难的，我网测反正是没有一家笔过了的，不论我感觉做的好或者不好，最好找熟人内推，当然对于某些发内推码做宣传的公司，还有内推还有笔试的公司我实在是被恶心到了。（仅代表个人意见，巨巨请随意）。&lt;/p&gt;
&lt;p&gt;  也有一些同学问我找工作的经验，其实真的很难和这些人说，我写程序写了三年了，你学了一个月两个月，我很难给出建议，校招和社招毕竟不一样，校招注重的是基础，社招注重的是经验，身边很多人去上了个培训班，写了个网站，写了个App以为就够了，面试笔试的时候不会问你API，你写个网站我问你TCP的一些基本知识，TCP为了实现可靠协议做了那些工作都说不出来，我很难让你这轮面试过；你写App我问进程和线程的关系你答不出来，问你进程间通信的方式你一摊手说不会，说没教过。我觉得这些人根本不适合干这一行，如果是一开始是为了薪资待遇来干这一行的人请你先做好加班和终身学习的准备，钱从来都不是那么好挣的。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://octh00z8u.bkt.clouddn.com/IMG_0019.JPG&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;
&lt;p&gt;  上面这段文字是我2016年1月1号跨年的时候写的，现在回头去看我的2015年，身边的人来来往往，有离开的，有留下的，无论你们给我留下的回忆是痛苦或者开心，谢谢你们。要说这半年我有什么变化，最大的变化是总算是遇上了那个我觉得对的人，遇上了自己想拼尽全力对她好的那个人，还有就是心态上变得比以前更平和一些，但是感觉为人处事还是不够成熟，虽然很多人我都不care，我经常给娜娜说，有些人我真的不是很想交流，不是性格处不来，是真的段位差别大，很难交流，我好好给你说话，你说装逼，话说的重一点，你说我在嘲讽你，我不知道这些人是哪里来的玻璃心，现在的我倒是好多了，我没必要去关心别人的的生活和未来，我过的始终是我的生活。&lt;/p&gt;
&lt;p&gt;  偶然的一个机会知道了学校的一个很牛逼的学长，现在在twitter，做Linux内核开发，给Linux内核打了三百多个补丁，真的是强到爆炸，看了他博客里面一些文章（技术文章讲kernel的，大多看不懂，看了一些碎碎念），特别是这篇&lt;a href=&quot;http://wangcong.org/2014/01/30/-e6-88-91-e7-9a-842013-ef-bc-9a-e6-88-91-e6-9d-a5-e5-88-b0-e4-ba-86-e7-be-8e-e5-9b-bd/&quot;&gt;我的2013：我来到了美国&lt;/a&gt;，这位学长是08年毕业的，毕业之后去葡萄牙工作了一段时间，然后回北京红帽工作了一段时间，在北京红帽工作的时候在大理远程办公了一段时间，然后带着妹子肉身翻了墙，看学长twitter上的tweet，养了只柯基，在加州的日子很爽，上面提到的那篇博客里面我很认同一点的是我自己的事情，为什么要受到父母亲戚朋友的束缚，孝顺固然重要，但是我要过我自己的人生，过的好或者坏，我自己能够承担，暑假的时候身边有同学在准备出国，他是西安本地人，以前的他是准备学点Java在西安找个工作，后面学校有一个去美国交流的项目，去了两个月回来之后，感觉他彻底变了一个人，努力的学习英语，考雅思，说想去更大的世界看看，很多人说国外未必有国内好，但是你问这批人，到底哪里不好，哪里好，他多半说不出来，因为这些人多半没有出去过，没有一个国家是完美的，包括美国也不是尽善尽美的，但是如果有个国家吹着自由的风，我相信那肯定不是中国，不仅仅是那座让google、facebook进不来的墙，更多的是国人心中那道墙，也许有那么一天，当打开google的时候不再是404，当人们心中那道墙倒塌的时候，也许我们可以闻到自由的味道。&lt;/p&gt;
&lt;p&gt;  “打柴的和放羊的遇见了，两个人在一起闲聊，到了下午太阳落山了，人家的羊吃完草，高高兴兴回家了，你的柴开始砍了吗？”为什么同样是一个学校，一个专业，一个班级出来的人最后千差万别，都是成年人，自己要学会对自己干的事负责，别退缩，别回避，说句俗的话，自己的锅自己背，自己的粪自己掏。不要最后只看到了别人的结果，没有看到别人的努力，如果现在手上还有把刀，请好好砍你的柴，最害怕的是那些连刀都丢了的人。&lt;/p&gt;
&lt;p&gt;  再过几个月就要离开学校步入社会，告别学生生涯了，以后的生活，我想去看看更大的世界，我想带着我心爱的那个她一起走过山川大河，希望到时候的我不会惶恐和害怕，也愿路途不再往复，愿无岁月可回头。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;兴趣遍地都是，坚持和持之以恒才是稀缺的&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;</content:encoded></item></channel></rss>